<!DOCTYPE html>

<html>
<head>
  <title>chap02.spec.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>chap02.spec.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="-2-">第2章 なぜ関数型プログラミングが重要か</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'expect.js'</span>);

<span class="hljs-keyword">var</span> compose = (f,g) =&gt; {
  <span class="hljs-keyword">return</span> (arg) =&gt; {
    <span class="hljs-keyword">return</span> f(g(arg));
  };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="2-2-">2.2 関数型プログラミングの特徴</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'関数型プログラミングの特徴'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3 id="-">ファーストクラスオブジェクトとしての関数</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'ファーストクラスオブジェクトとしての関数'</span>, () =&gt; {
    it(<span class="hljs-string">'数値はファーストクラスオブジェクトである'</span>, (next) =&gt; {
      <span class="hljs-comment">/*  #@range_begin(number_as_first_class_citizen) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>値を変数にバインドする</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> zero = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">var</span> name = <span class="hljs-string">"Haskell Curry"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>値をデータ構造に埋めこむ</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> birthday = {
        year: <span class="hljs-number">1999</span>,
        month: <span class="hljs-number">1</span>,
        day: <span class="hljs-number">12</span>
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>関数から値を返す</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> birthYear = (birthdayObject) =&gt; {
        <span class="hljs-keyword">return</span> birthdayObject.year;
      };
      <span class="hljs-comment">/* #@range_end(number_as_first_class_citizen) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>値を関数に渡す</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      expect(
        <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-number">1</span>)
      ).to.eql(
        <span class="hljs-number">1</span>
      );
      expect(
        birthYear(birthday)
      ).to.eql(
        <span class="hljs-number">1999</span>
      );
      next();
    });
    it(<span class="hljs-string">'関数は変数にバインドできる'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(function_bound_to_variable) */</span>
      <span class="hljs-keyword">var</span> succ = (n) =&gt; {
        <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>;
      };
      <span class="hljs-comment">/* #@range_end(function_bound_to_variable) */</span>
      expect(
        succ(<span class="hljs-number">1</span>) <span class="hljs-comment">// 変数succを用いてλ式を呼びだす</span>
      ).to.eql(
        <span class="hljs-number">2</span>
      );
      next();
    });
    it(<span class="hljs-string">'関数をオブジェクトに埋めこむ'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(function_embedded_in_object) */</span>
      <span class="hljs-keyword">var</span> math = {
        add: (n,m) =&gt; {
          <span class="hljs-keyword">return</span> n + m;
        }
      };
      expect(
        math.add(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)
      ).to.eql(
        <span class="hljs-number">3</span>
      );
      <span class="hljs-comment">/* #@range_end(function_embedded_in_object) */</span>
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3 id="-">高階関数</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'高階関数'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>forEach文によるsumの定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      it(<span class="hljs-string">'forEach文によるsumの定義'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(sum_forEach) */</span>
        <span class="hljs-keyword">var</span> sum = (array) =&gt; {
          <span class="hljs-keyword">var</span> result = <span class="hljs-number">0</span>;
          array.forEach((item) =&gt; { <span class="hljs-comment">// forEachに関数を渡す</span>
            result = result + item;
          });
          <span class="hljs-keyword">return</span> result;
        };
        <span class="hljs-comment">/* #@range_end(sum_forEach)  */</span>
        expect(
          sum([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
        ).to.eql(
          <span class="hljs-number">10</span>
        );
        next();
      });
      describe(<span class="hljs-string">'関数を返す'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>adderを定義する</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        it(<span class="hljs-string">'adderを定義する'</span>, (next) =&gt; {
          <span class="hljs-comment">/* #@range_begin(adder_definition) */</span>
          <span class="hljs-keyword">var</span> adder = (n) =&gt; {
            <span class="hljs-keyword">return</span> (m) =&gt; { <span class="hljs-comment">// 関数を返す</span>
              <span class="hljs-keyword">return</span> n + m;
            };
          };
          <span class="hljs-comment">/* #@range_end(adder_definition) */</span>
          <span class="hljs-keyword">var</span> succ = adder(<span class="hljs-number">1</span>);
          expect(
            succ(<span class="hljs-number">0</span>)
          ).to.eql(
            <span class="hljs-number">1</span>
          );
          next();
        });
        it(<span class="hljs-string">'reduceを定義する'</span>, (next) =&gt; {
          <span class="hljs-comment">/* #@range_begin(reduce_definition) */</span>
          <span class="hljs-keyword">var</span> reduce = (init,glue) =&gt; {
            <span class="hljs-keyword">return</span> (array) =&gt; { <span class="hljs-comment">// 関数が返る</span>
              <span class="hljs-keyword">if</span>(array.length === <span class="hljs-number">0</span>){
                <span class="hljs-keyword">return</span> init;
              } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> accumulator = glue(array[<span class="hljs-number">0</span>], init);
                <span class="hljs-keyword">var</span> tail = array.slice(<span class="hljs-number">1</span>,array.length);
                <span class="hljs-keyword">return</span> reduce(accumulator,glue)(tail);
              }
            };
          };
          <span class="hljs-comment">/* #@range_end(reduce_definition) */</span>
          <span class="hljs-comment">/* #@range_begin(function_returning_function_test) */</span>
          <span class="hljs-keyword">var</span> adder = (x,y) =&gt; {
            <span class="hljs-keyword">return</span> x + y;
          };
          <span class="hljs-keyword">var</span> sum = reduce(<span class="hljs-number">0</span>,adder);
          expect(
            sum([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
          ).to.eql(
            <span class="hljs-number">10</span>
          );
          <span class="hljs-comment">/* #@range_end(function_returning_function_test) */</span>
          next();
        });
      });
    });
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="-">参照透過性</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'参照透過性'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h3 id="-">参照透明性が成立する場面</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'参照透明性が成立する場面'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h4 id="-">値の参照透過性</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'値の参照透過性'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(number_has_referential_transparency) */</span>
      expect(
        <span class="hljs-number">2</span>
      ).to.eql(
        <span class="hljs-number">2</span>
      );
      <span class="hljs-comment">/* #@range_end(number_has_referential_transparency) */</span>
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h4 id="-">変数の参照透過性</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'変数の参照透明性'</span>, () =&gt; {
      it(<span class="hljs-string">'変数が参照透明性を持つ場合'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(variable_is_referential_transparent) */</span>
        <span class="hljs-keyword">var</span> x = <span class="hljs-number">1</span>;
        expect(
          x 
        ).to.eql(
          x
        );
        <span class="hljs-keyword">var</span> y = x;
        expect(
          y
        ).to.eql(
          <span class="hljs-number">1</span>
        );
        <span class="hljs-comment">/* #@range_end(variable_is_referential_transparent) */</span>
        next();
      });
      it(<span class="hljs-string">'変数は参照透明性を持つとは限らない'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(variable_isnt_referential_transparent) */</span>
        <span class="hljs-keyword">var</span> foo = <span class="hljs-number">2</span>;
        <span class="hljs-keyword">var</span> bar = foo;
        foo = <span class="hljs-number">3</span>;
        expect(
          foo
        ).to.not.eql(
          bar
        );
        <span class="hljs-comment">/* #@range_end(variable_isnt_referential_transparent) */</span>
        next();
      });
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h4 id="-">関数の参照透過性</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'関数の参照透明性'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>succ関数は参照透明性を持つ</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      it(<span class="hljs-string">'succ関数は参照透明性を持つ'</span>, (next) =&gt; {
        <span class="hljs-keyword">var</span> succ = (x) =&gt; {
          <span class="hljs-keyword">return</span> x + <span class="hljs-number">1</span>;
        };
        expect(
          succ(<span class="hljs-number">1</span>)
        ).to.eql(
          succ(<span class="hljs-number">1</span>)
        );
        expect(
          succ(<span class="hljs-number">1</span>) <span class="hljs-comment">// 1回目の実行</span>
        ).to.eql(
          <span class="hljs-number">2</span>
        );
        expect(
          succ(<span class="hljs-number">1</span>) <span class="hljs-comment">// 2回目の実行</span>
        ).to.eql(
          <span class="hljs-number">2</span>
        );
        next();
      });
    });
    describe(<span class="hljs-string">'参照透明な関数では同値なものは置換可能である'</span>, () =&gt; {
      it(<span class="hljs-string">'同じ引数のsquare関数は置換可能である'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(equals_replacement)  */</span>
        <span class="hljs-keyword">var</span> square = (n) =&gt; {
          <span class="hljs-keyword">return</span> n * n;
        };
        <span class="hljs-keyword">var</span> b = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">var</span> a = b;
        expect(
          square(a)
        ).to.eql(
          square(b)
        );
        expect(
          square(b)
        ).to.eql(
          square(a)
        );
        expect(
          square(a)
        ).to.eql(
          square(a)
        );
        expect(
          square(b)
        ).to.eql(
          square(b)
        );
        <span class="hljs-comment">/* #@range_end(equals_replacement)  */</span>
        next();
      });
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h3 id="-">参照透過性を破壊するもの</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'参照透過性を破壊するもの'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>可変なデータは参照透明性を破壊する</p>
<pre><code>node&gt; <span class="hljs-keyword">var</span> array = [<span class="hljs-number">1</span>];
node&gt; array
[ <span class="hljs-number">1</span> ]
node&gt; array.push(<span class="hljs-number">2</span>);
<span class="hljs-number">2</span>
node&gt; array
[ <span class="hljs-number">1</span>, <span class="hljs-number">2</span> ]
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'可変なデータは参照透明性を破壊する'</span>, (next) =&gt; {
      <span class="hljs-keyword">var</span> array = [<span class="hljs-number">1</span>];
      expect(
        array
      ).to.eql(
        [<span class="hljs-number">1</span>]
      );
      array.push(<span class="hljs-number">2</span>);
      expect(
        array
      ).to.eql(
        [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]
      );
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>代入操作は参照透明性を破壊する</p>
<pre><code>node&gt; <span class="hljs-keyword">var</span> one = <span class="hljs-number">1</span>;
node&gt; <span class="hljs-keyword">var</span> ichi = one;
node&gt; ichi === one;
<span class="hljs-literal">true</span>
node&gt; one = <span class="hljs-number">2</span>;
<span class="hljs-number">2</span>
node&gt; ichi === one;
<span class="hljs-literal">false</span>
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'代入操作は参照透明性を破壊する'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(assignment_breaks_referential_transparency) */</span>
      <span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">var</span> add = (y) =&gt; {
        x = x + <span class="hljs-number">1</span>; <span class="hljs-comment">// 代入で変数を更新する</span>
        <span class="hljs-keyword">return</span> x + y;
      };
      <span class="hljs-comment">/* #@range_end(assignment_breaks_referential_transparency)  */</span>
      expect(
        add(<span class="hljs-number">1</span>)
      ).to.eql(
        <span class="hljs-number">2</span>
      );
      next();
    });
    it(<span class="hljs-string">'参照不透明な関数では同値なものは置換できない'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(unequals_replacement)  */</span>
      <span class="hljs-keyword">var</span> wrapper = (f) =&gt; {
        <span class="hljs-keyword">return</span> (args) =&gt; {
          <span class="hljs-keyword">return</span> f.call(f, args);
        };
      };
      <span class="hljs-keyword">var</span> now = (_) =&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Date</span>.now();
      };
      <span class="hljs-keyword">var</span> b = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">var</span> a = b;
      <span class="hljs-keyword">var</span> aResult = wrapper(now)(a);
      <span class="hljs-comment">/* #@range_end(unequals_replacement)  */</span>
      next();
    });
    it(<span class="hljs-string">'Date.now関数は参照透明性を持たない'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(datenow_is_not_transparent) */</span>
      <span class="hljs-keyword">var</span> a = <span class="hljs-built_in">Date</span>.now();
      <span class="hljs-comment">/* 時間を1秒進める */</span>
      <span class="hljs-keyword">var</span> sleep = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sleep-async'</span>)();
      sleep.sleep(<span class="hljs-number">2000</span>, () =&gt; {
        expect(
          a
        ).to.not.eql( <span class="hljs-comment">/* 等しくないことをテストしている */</span>
          <span class="hljs-built_in">Date</span>.now()
        );
      });
      <span class="hljs-comment">/* #@range_end(datenow_is_not_transparent) */</span>
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>命令型な階乗関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'命令型な階乗関数'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(imperative_factorial) */</span>
      <span class="hljs-keyword">var</span> factorial = (n) =&gt; {
        <span class="hljs-comment">/* 変数resultに結果が入る */</span>
        <span class="hljs-keyword">var</span> result = <span class="hljs-number">1</span>;             
        <span class="hljs-comment">/* 変数timesは反復の回数を数える */</span>
        <span class="hljs-keyword">var</span> times = <span class="hljs-number">1</span>;              
        <span class="hljs-comment">/* while文は反復を処理する */</span>
        <span class="hljs-keyword">while</span>(times &lt; n + <span class="hljs-number">1</span>) {      
          <span class="hljs-comment">/* 変数resultを代入で更新する */</span>
          result = result * times;  
          <span class="hljs-comment">/* 変数timesを代入で更新する */</span>
          times = times + <span class="hljs-number">1</span>;        
        }
        <span class="hljs-keyword">return</span> result;
      };
      <span class="hljs-comment">/* #@range_end(imperative_factorial) */</span>
      expect(
        factorial(<span class="hljs-number">2</span>)
      ).to.eql(
        <span class="hljs-number">2</span>
      );
      expect(
        factorial(<span class="hljs-number">3</span>)
      ).to.eql(
        <span class="hljs-number">6</span>
      );
      expect(
        factorial(<span class="hljs-number">4</span>)
      ).to.eql(
        <span class="hljs-number">24</span>
      );
      next();
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>副作用と入出力</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'副作用と入出力'</span>, () =&gt; {
    it(<span class="hljs-string">'ファイル入出力が参照透明性を破壊する例'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(fileio_breaks_referential_transparency)  */</span>
      <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
      <span class="hljs-keyword">var</span> read = (path) =&gt; {
        <span class="hljs-keyword">var</span> readValue = fs.readFileSync(path);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(readValue);
      };
      <span class="hljs-keyword">var</span> write = (path, n) =&gt; {
        fs.writeFileSync(path, n);
        <span class="hljs-keyword">return</span> n;
      };
      <span class="hljs-comment">/* #@range_end(fileio_breaks_referential_transparency)  */</span>
      write(<span class="hljs-string">'test/resources/io.txt'</span>, <span class="hljs-number">1</span>);
      expect(
        read(<span class="hljs-string">'test/resources/io.txt'</span>)
      ).to.eql(
        <span class="hljs-number">1</span>
      );
      write(<span class="hljs-string">'test/resources/io.txt'</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// ここでファイルに値を書きこむ</span>
      expect(
        read(<span class="hljs-string">'test/resources/io.txt'</span>)
      ).to.eql(
        <span class="hljs-number">2</span>
      );
      next();
    });
  });
  describe(<span class="hljs-string">'副作用の種類'</span>, () =&gt; {
    describe(<span class="hljs-string">'副作用としての代入'</span>, () =&gt; {
      it(<span class="hljs-string">'配列は参照透明性を破壊する'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(array_destroys_referential_transparency) */</span>
        <span class="hljs-keyword">var</span> array = [];
        array.push(<span class="hljs-number">1</span>);
        expect(
          array.pop()
        ).to.eql(
          <span class="hljs-number">1</span>
        );
        array.push(<span class="hljs-number">2</span>);
        expect(
          array.pop()
        ).to.eql(
          <span class="hljs-number">2</span>
        );
        <span class="hljs-comment">/* #@range_end(array_destroys_referential_transparency) */</span>
        next();
      });
      it(<span class="hljs-string">'配列の状態を表示する'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(array_destroys_referential_transparency_log) */</span>
        <span class="hljs-keyword">var</span> add = (n,m) =&gt; {
          <span class="hljs-keyword">return</span> n + m;
        };
        <span class="hljs-keyword">var</span> array = [];
        array.push(<span class="hljs-number">1</span>);
        <span class="hljs-built_in">console</span>.log(array); <span class="hljs-comment">// [ 1 ]</span>
        expect(
          add(array.pop(),<span class="hljs-number">2</span>)
        ).to.eql(
          <span class="hljs-number">3</span>
        );
        array.push(<span class="hljs-number">2</span>);
        <span class="hljs-built_in">console</span>.log(array); <span class="hljs-comment">// [ 2 ]</span>
        expect(
          add(array.pop(),<span class="hljs-number">2</span>)
        ).to.eql(
          <span class="hljs-number">4</span>
        );
        <span class="hljs-comment">/* #@range_end(array_destroys_referential_transparency_log) */</span>
        next();
      });
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h3 id="-">参照透明性を保証する</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'参照透明性を保証する'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h4 id="-">値の参照透過性を保証する（可変なデータの排除）</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'値の参照透過性を保証する（可変なデータの排除）'</span>, () =&gt;  {
      it(<span class="hljs-string">'不変なデータ型'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(immutable_datatype) */</span>
        <span class="hljs-keyword">var</span> empty =  (_) =&gt; {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        };
        <span class="hljs-keyword">var</span> get = (key, obj) =&gt; {
          <span class="hljs-keyword">return</span> obj(key);
        };
        <span class="hljs-keyword">var</span> set = (key, value, obj) =&gt; {
          <span class="hljs-keyword">return</span> (key2) =&gt; {
            <span class="hljs-keyword">if</span>(key === key2) {
              <span class="hljs-keyword">return</span> value;
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> get(key2,obj);
            }
          };
        };
        <span class="hljs-comment">/* #@range_end(immutable_datatype) */</span>
        next();
      });
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="-">変数の参照透過性を保証する(代入の排除)</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'変数の参照透過性を保証する(代入の排除)'</span>, () =&gt; {
      it(<span class="hljs-string">'命令型プログラミングによる乗算'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(imperative_addition) */</span>
        <span class="hljs-keyword">var</span> add = (x,y) =&gt; {
          <span class="hljs-keyword">var</span> times = <span class="hljs-number">0</span>;          
          <span class="hljs-keyword">var</span> result = x;         

          <span class="hljs-comment">/* while文で反復を処理する */</span>
          <span class="hljs-keyword">while</span>(times &lt; y){       
            result = result + <span class="hljs-number">1</span>;
            times = times + <span class="hljs-number">1</span>;    
          };
          <span class="hljs-keyword">return</span> result;
        };
        <span class="hljs-comment">/* #@range_end(imperative_addition) */</span>
        expect(
          add(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)
        ).to.eql(
          <span class="hljs-number">5</span>
        );
        <span class="hljs-keyword">var</span> x = <span class="hljs-number">4</span>;
        <span class="hljs-keyword">var</span> y = <span class="hljs-number">5</span>;
        expect(
          add(x,y)
        ).to.eql(
          <span class="hljs-number">9</span>
        );
        expect(
          x
        ).to.eql(
          <span class="hljs-number">4</span>
        );
        next();
      });
      it(<span class="hljs-string">'関数型プログラミングによる乗算'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(functional_addition) */</span>
        <span class="hljs-keyword">var</span> add = (x,y) =&gt; {
          <span class="hljs-keyword">if</span>(y &lt; <span class="hljs-number">1</span>){
            <span class="hljs-keyword">return</span> x;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">/* 新しい引数でadd関数を再帰的に呼び出す */</span>
            <span class="hljs-keyword">return</span> add(x + <span class="hljs-number">1</span>, y - <span class="hljs-number">1</span>); 
          }
        };
        <span class="hljs-comment">/* #@range_end(functional_addition) */</span>
        expect(add(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)).to.eql(<span class="hljs-number">3</span>);
        expect(add(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)).to.eql(<span class="hljs-number">4</span>);
        expect(add(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>)).to.eql(<span class="hljs-number">5</span>);
        expect(add(<span class="hljs-number">12</span>,<span class="hljs-number">5</span>)).to.eql(<span class="hljs-number">17</span>);
        next();
      });
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h4 id="-">関数の参照透過性を保証する（副作用の分離）</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'関数の参照透過性を保証する（副作用の分離）'</span>, () =&gt;  {
      it(<span class="hljs-string">'副作用が分離されていないコード'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(age_sideeffect) */</span>
        <span class="hljs-keyword">var</span> age = (birthYear) =&gt; {
          <span class="hljs-comment">/* todayは現時点の日付データ */</span>
          <span class="hljs-keyword">var</span> today = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
          <span class="hljs-comment">/* getFullYear関数は日付データにもとづいて現時点の西暦を返す */</span>
          <span class="hljs-keyword">var</span> thisYear = today.getFullYear(); 
          <span class="hljs-keyword">return</span> thisYear - birthYear;
        };
        <span class="hljs-comment">/* #@range_end(age_sideeffect) */</span>
        next();
      });
      it(<span class="hljs-string">'副作用が分離されているコード'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(age_without_sideeffect) */</span>
        <span class="hljs-keyword">var</span> age = (birthYear, thisYear) =&gt; {
          <span class="hljs-keyword">return</span> thisYear - birthYear;
        };
        <span class="hljs-comment">/* #@range_end(age_without_sideeffect) */</span>
        next();
      });
      it(<span class="hljs-string">'画面出力を分離する'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(tap_console_log) */</span>
        <span class="hljs-keyword">var</span> tap = (target, sideEffect) =&gt; {
          sideEffect(target);
          <span class="hljs-keyword">return</span> target;
        };
        <span class="hljs-keyword">var</span> logger = (value) =&gt;{
          <span class="hljs-built_in">console</span>.log(value);
        };
        <span class="hljs-comment">/* #@range_end(tap_console_log) */</span>
        next();
      });
      describe(<span class="hljs-string">'副作用を関数のスコープに閉じこめる'</span>, () =&gt; {
        <span class="hljs-comment">/* #@range_begin(action) */</span>
        <span class="hljs-keyword">var</span> action = (io) =&gt; {
          <span class="hljs-keyword">return</span> (_) =&gt; { <span class="hljs-comment">// 入出力を関数で包み込む</span>
            <span class="hljs-keyword">return</span> io;
          };
        };
        <span class="hljs-comment">/* #@range_end(action) */</span>
        <span class="hljs-comment">/* #@range_begin(reader_and_writer) */</span>
        <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>); <span class="hljs-comment">// ファイルを操作するライブラリーfsをロードする</span>
        <span class="hljs-keyword">var</span> read = (path) =&gt; { <span class="hljs-comment">// ファイルを読み込む操作を関数で包みこむ</span>
          <span class="hljs-keyword">return</span> fs.readFileSync(path, <span class="hljs-string">'utf8'</span>);
        };
        <span class="hljs-keyword">var</span> write = (path, content) =&gt; { <span class="hljs-comment">// ファイルを書き込む操作を関数で包みこむ</span>
          <span class="hljs-keyword">return</span> fs.writeFileSync(path,content);
        };
        <span class="hljs-keyword">var</span> reader = (path) =&gt; { <span class="hljs-comment">// ファイルを読み込む操作を関数で包みこむ</span>
          <span class="hljs-keyword">return</span> action(fs.readFileSync(path, <span class="hljs-string">'utf8'</span>));
        };
        <span class="hljs-keyword">var</span> writer = (path, content) =&gt; { <span class="hljs-comment">// ファイルを書き込む操作を関数で包みこむ</span>
          <span class="hljs-keyword">return</span> action(fs.writeFileSync(path,content));
        };
        <span class="hljs-comment">/* #@range_end(reader_and_writer) */</span>
        <span class="hljs-comment">/* #@range_begin(fileio_actions) */</span>
        <span class="hljs-keyword">var</span> fileio_actions = () =&gt; {
          write(<span class="hljs-string">'test/resources/test.txt'</span>, <span class="hljs-number">1</span>);
          read(<span class="hljs-string">'test/resources/test.txt'</span>);
          write(<span class="hljs-string">'test/resources/test.txt'</span>, <span class="hljs-number">2</span>);
          <span class="hljs-keyword">return</span> read(<span class="hljs-string">'test/resources/test.txt'</span>);
        };
        <span class="hljs-comment">/* #@range_end(fileio_actions) */</span>
        expect(
          fileio_actions()
        ).to.eql(
          <span class="hljs-number">2</span>
        );
        expect(
          fileio_actions()
        ).to.eql(
          <span class="hljs-number">2</span>
        );
      });
    });
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h2 id="-">関数型プログラミングの利点</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'関数型プログラミングの利点'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h3 id="-">高いモジュール性</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'モジュール性とは何か'</span>, () =&gt; {
    it(<span class="hljs-string">'名前空間としてのモジュール'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(module_as_namespace) */</span>
      <span class="hljs-comment">/* 数値計算のモジュール */</span>
      <span class="hljs-keyword">var</span> math = {
        add: (n, m) =&gt; { <span class="hljs-comment">// 数値の足し算</span>
          <span class="hljs-keyword">return</span> n + m;
        },
        multiply: (n, m) =&gt; {
          <span class="hljs-keyword">return</span> n * m;
        }
      };
      <span class="hljs-comment">/* 文字列操作のモジュール */</span>
      <span class="hljs-keyword">var</span> string = {
        add: (strL, strR) =&gt; { <span class="hljs-comment">// 文字列の連結</span>
          <span class="hljs-keyword">return</span> strL.concat(strR);
        },
        multiply: (str, nTimes) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>        }
      };
      <span class="hljs-comment">/* #@range_end(module_as_namespace) */</span>
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h4 id="-">部品の独立性</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'部品の独立性'</span>, () =&gt; {
      <span class="hljs-keyword">var</span> not = (predicate) =&gt; {
        <span class="hljs-keyword">return</span> (arg) =&gt; {
          <span class="hljs-keyword">return</span> ! predicate(arg);
        };
      };
      <span class="hljs-keyword">var</span> array = {
        cons: (head, tail) =&gt; {
          <span class="hljs-keyword">return</span> [head].concat(tail);
        },
        empty: (_) =&gt; {
          <span class="hljs-keyword">return</span> [];
        },
        head: (anArray) =&gt; {
          <span class="hljs-keyword">return</span> anArray[<span class="hljs-number">0</span>];
        },
        tail: (anArray) =&gt; {
          <span class="hljs-keyword">return</span> anArray.slice(<span class="hljs-number">1</span>,array.length(anArray));
        },
        length: (anArray) =&gt; {
          <span class="hljs-keyword">return</span> anArray.length;
        },
        isEmpty: (anArray) =&gt; {
          <span class="hljs-keyword">return</span> array.length(anArray) === <span class="hljs-number">0</span>;
        },
        fromString: (str) =&gt; {
          <span class="hljs-keyword">if</span>(string.isEmpty(str)) {
            <span class="hljs-keyword">return</span> array.empty();
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> array.cons(string.head(str), 
                              array.fromString(string.tail(str)));
          }
        },
        takeWhile: (anArray) =&gt; {
          <span class="hljs-keyword">return</span> (predicate) =&gt; {
            <span class="hljs-keyword">if</span>(array.isEmpty(anArray)){
              <span class="hljs-keyword">return</span> array.empty(); 
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">var</span> head = array.head(anArray);
              <span class="hljs-keyword">var</span> tail = array.tail(anArray);
              <span class="hljs-keyword">if</span>(predicate(head) === <span class="hljs-literal">true</span>) {
                <span class="hljs-keyword">return</span> array.cons(head,
                                  array.takeWhile(tail)(predicate));
              } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> array.empty();
              }
            }
          };
        },
        dropWhile: (anArray) =&gt; {
          <span class="hljs-keyword">return</span> (predicate) =&gt; {
            <span class="hljs-keyword">if</span>(array.isEmpty(anArray)){
              <span class="hljs-keyword">return</span> [];
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">var</span> head = array.head(anArray);
              <span class="hljs-keyword">var</span> tail = array.tail(anArray);
              <span class="hljs-keyword">if</span>(predicate(head) === <span class="hljs-literal">true</span>) {
                <span class="hljs-keyword">return</span> array.dropWhile(tail)(predicate);
              } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> anArray;
              }
            };
          };
        },
        span: (anArray) =&gt; {
          <span class="hljs-keyword">return</span> (predicate) =&gt; {
            <span class="hljs-keyword">if</span>(array.isEmpty(anArray)){
              <span class="hljs-keyword">return</span> [];
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">var</span> head = array.head(anArray);
              <span class="hljs-keyword">var</span> tail = array.tail(anArray);
              <span class="hljs-keyword">return</span> [array.takeWhile(anArray)(predicate),
                      array.dropWhile(anArray)(predicate)];
            };
          };
        },
        <span class="hljs-keyword">break</span>: (anArray) =&gt; {
          <span class="hljs-keyword">return</span> (predicate) =&gt; {
            <span class="hljs-keyword">return</span> array.span(anArray)(not(predicate));
          };
        },  
        lines: (xs) =&gt; {
          <span class="hljs-keyword">var</span> isNewline = (ch) =&gt; {
            <span class="hljs-keyword">return</span> ch === <span class="hljs-string">'\n'</span>;
          };
          <span class="hljs-keyword">var</span> apair = array.break(xs)(isNewline);
          <span class="hljs-keyword">var</span> ys = apair[<span class="hljs-number">0</span>];
          <span class="hljs-keyword">var</span> zs = apair[<span class="hljs-number">1</span>];

          <span class="hljs-keyword">if</span>(array.isEmpty(zs)){
            <span class="hljs-keyword">return</span> [ys];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> head = array.head(zs);
            <span class="hljs-keyword">var</span> tail = array.tail(zs);
            <span class="hljs-keyword">return</span> array.cons(ys, array.lines(tail));
          };
        }
      };
      <span class="hljs-keyword">var</span> string = {
        head: (str) =&gt; {
          <span class="hljs-keyword">return</span> str[<span class="hljs-number">0</span>];
        },
        tail: (str) =&gt; {
          <span class="hljs-keyword">return</span> str.substring(<span class="hljs-number">1</span>);
        },
        isEmpty: (str) =&gt; {
          <span class="hljs-keyword">return</span> str.length === <span class="hljs-number">0</span>;
        },
        add: (strL, strR) =&gt; {
          <span class="hljs-keyword">return</span> strL + strR;
        },
        toArray: (str) =&gt; {
          <span class="hljs-keyword">if</span>(string.isEmpty(str)) {
            <span class="hljs-keyword">return</span> [];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> array.cons(string.head(str),
                              string.toArray(string.tail(str)));
          }
        },
        fromArray: (anArray) =&gt; {
          <span class="hljs-keyword">return</span> anArray.reduce((accumulator, item) =&gt; {
            <span class="hljs-keyword">return</span> string.add(accumulator, item);
          }, <span class="hljs-string">""</span>);
        },
        lines: (str) =&gt; {
          <span class="hljs-keyword">var</span> isNewline = (ch) =&gt; {
            <span class="hljs-keyword">return</span> ch === <span class="hljs-string">'\n'</span>;
          };
          <span class="hljs-keyword">var</span> apair = array.break(array.fromString(str))(isNewline);
          <span class="hljs-keyword">var</span> ys = apair[<span class="hljs-number">0</span>];
          <span class="hljs-keyword">var</span> zs = apair[<span class="hljs-number">1</span>];

          <span class="hljs-keyword">if</span>(array.isEmpty(zs)){
            <span class="hljs-keyword">return</span> [string.fromArray(ys)];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> tail = array.tail(zs);
            <span class="hljs-keyword">return</span> array.cons(string.fromArray(ys), 
                              string.lines(string.fromArray(tail)));
          };
        }
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>describe(‘array’, () =&gt; {
  it(‘array#head’, (next) =&gt; {
    expect(
      array.head([0,1,2])
    ).to.eql(
      0
    );
    next();
  });
  it(‘array#tail’, (next) =&gt; {
    expect(
      array.tail([0,1,2])
    ).to.eql(
      [1,2]
    );
    next();
  });
  it(‘array#cons’, (next) =&gt; {
    expect(
      array.cons(0,[1,2])
    ).to.eql(
      [0,1,2]
    );
    next();
  });
  it(‘array#fromString’, (next) =&gt; {
    expect(
      array.fromString(“123”)
    ).to.eql(
      [1,2,3]
    );
    next();
  });
  it(‘array#takeWhile’, (next) =&gt; {
    var theArray = [1,2,3]; 
    var even = (n) =&gt; {
      return 0 === (n % 2);
    };
    var odd = not(even);
    expect(
      array.takeWhile(theArray)(odd)
    ).to.eql(
      [1]
    );
    next();
  });
  it(‘array#dropWhile’, (next) =&gt; {
    var theArray = [1,2,3]; 
    var even = (n) =&gt; {
      return 0 === (n % 2);
    };
    var odd = not(even);
    expect(
      array.dropWhile(theArray)(odd)
    ).to.eql(
      [2,3]
    );
    next();
  });
  it(‘array#span’, (next) =&gt; {
    var theArray = [1,2,3]; 
    var even = (n) =&gt; {
      return 0 === (n % 2);
    };
    expect(
      array.span(theArray)(even)
    ).to.eql(
      [[],[1,2,3]]
    );
    var odd = not(even);
    expect(
      array.span(theArray)(odd)
    ).to.eql(
      [[1],[2,3]]
    );
    next();
  });
  it(‘array#break’, (next) =&gt; {
    var theArray = [1,2,3]; 
    var even = (n) =&gt; {
      return 0 === (n % 2);
    };
    expect(
      array.break(theArray)(even)
    ).to.eql(
      [[1],[2,3]]
    );
    var odd = not(even);
    expect(
      array.break(theArray)(odd)
    ).to.eql(
      [[],[1,2,3]]
    );
    var isNewline = (ch) =&gt; {
      return ch === ‘\n’;
    };
    expect(
      array.break([‘a’,’b’,’c’,’\n’,’d’,’e’,’f’])(isNewline)
    ).to.eql(
      [[‘a’,’b’,’c’],[‘\n’,’d’,’e’,’f’]]
    );
    next();
  });
  it(‘array#lines’, (next) =&gt; {
    var theArray = array.fromString(“abc\ndef”); 
    expect(
      array.lines(theArray)
    ).to.eql(
      [ [ ‘a’, ‘b’, ‘c’ ], [ ‘d’, ‘e’, ‘f’ ] ]
    );
    next();
  });
});</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      describe(<span class="hljs-string">'string'</span>, () =&gt; {
        it(<span class="hljs-string">'string#head'</span>, (next) =&gt; {
          expect(
            string.head(<span class="hljs-string">"abc"</span>)
          ).to.eql(
            <span class="hljs-string">'a'</span>
          );
          next();
        });
        it(<span class="hljs-string">'string#tail'</span>, (next) =&gt; {
          expect(
            string.tail(<span class="hljs-string">"abc"</span>)
          ).to.eql(
            <span class="hljs-string">"bc"</span>
          );
          next();
        });
        it(<span class="hljs-string">'string#fromArray'</span>, (next) =&gt; {
          expect(
            string.fromArray([<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>])
          ).to.eql(
            <span class="hljs-string">"abc"</span>
          );
          next();
        });
        it(<span class="hljs-string">'string#toArray'</span>, (next) =&gt; {
          expect(
            string.toArray(<span class="hljs-string">"abc"</span>)
          ).to.eql(
            [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>]
          );
          next();
        });
        it(<span class="hljs-string">'string#lines'</span>, (next) =&gt; {
          expect(
            string.lines(<span class="hljs-string">"abc\ndef"</span>)
          ).to.eql(
            [ <span class="hljs-string">'abc'</span>, <span class="hljs-string">'def'</span> ]
          );
          next();
        });
      });
    });
    it(<span class="hljs-string">'統一的なインターフェイス'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(books_as_array) */</span>
      <span class="hljs-keyword">var</span> books = [
        {name: <span class="hljs-string">"こころ"</span>, author: [<span class="hljs-string">"夏目漱石"</span>], genre: <span class="hljs-string">"文学"</span>},
        {name: <span class="hljs-string">"夢十夜"</span>, author: [<span class="hljs-string">"夏目漱石"</span>], genre: <span class="hljs-string">"文学"</span>},
        {name: <span class="hljs-string">"ソクラテスの弁明"</span>, author: [<span class="hljs-string">"プラトン"</span>], genre: <span class="hljs-string">"哲学"</span>},
        {name: <span class="hljs-string">"国家"</span>, author: [<span class="hljs-string">"プラトン"</span>], genre: <span class="hljs-string">"哲学"</span>},
        {name: <span class="hljs-string">"プログラミング言語C"</span>, author: [<span class="hljs-string">"カーニハン"</span>,<span class="hljs-string">"リッチー"</span>], genre: <span class="hljs-string">"コンピュータ"</span>},

        {name: <span class="hljs-string">"計算機プログラムの構造と解釈"</span>, author: [<span class="hljs-string">"サスマン"</span>,<span class="hljs-string">"エイベルソン"</span>], genre: <span class="hljs-string">"コンピュータ"</span>},
      ];
      <span class="hljs-comment">/* #@range_end(books_as_array) */</span>
      <span class="hljs-keyword">var</span> get = (object) =&gt; {
        <span class="hljs-keyword">return</span> (key) =&gt; {
          <span class="hljs-keyword">return</span> object[key];
        };
      };
      <span class="hljs-comment">/* #@range_begin(pluck) */</span>
      <span class="hljs-keyword">var</span> pluck = (key) =&gt; {
        <span class="hljs-keyword">return</span> (object) =&gt; {
          <span class="hljs-keyword">return</span> object[key];
        };
      };
      <span class="hljs-comment">/* #@range_end(pluck) */</span>
      <span class="hljs-comment">/* #@range_begin(mapWith) */</span>
      <span class="hljs-keyword">var</span> mapWith = (func) =&gt; {
        <span class="hljs-keyword">return</span> (array) =&gt; {
          <span class="hljs-keyword">return</span> array.map(func);
        };
      };
      <span class="hljs-comment">/* #@range_end(mapWith) */</span>
      <span class="hljs-keyword">var</span> multiplier = (n) =&gt; {
        <span class="hljs-keyword">return</span> (m) =&gt; {
          <span class="hljs-keyword">return</span> n * m;
        };
      };
      <span class="hljs-keyword">var</span> square = (n) =&gt; {
        <span class="hljs-keyword">return</span> multiplier(n)(n);
      };
      expect(
        mapWith(square)([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
      ).to.eql(
        [<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">9</span>]
      );
      expect(
        <span class="hljs-comment">/* #@range_begin(mapWith_pluck) */</span>
        mapWith(pluck(<span class="hljs-string">"name"</span>))(books)
        <span class="hljs-comment">/* #@range_end(mapWith_pluck) */</span>
      ).to.eql(
        [<span class="hljs-string">'こころ'</span>,<span class="hljs-string">'夢十夜'</span>,<span class="hljs-string">'ソクラテスの弁明'</span>,<span class="hljs-string">'国家'</span>,<span class="hljs-string">'プログラミング言語C'</span>,<span class="hljs-string">'計算機プログラムの構造と解釈'</span>]
      );
      <span class="hljs-comment">/* #@range_begin(filterWith) */</span>
      <span class="hljs-keyword">var</span> filterWith = (predicate) =&gt; {
        <span class="hljs-keyword">return</span> (array) =&gt; {
          <span class="hljs-keyword">return</span> array.filter(predicate);
        };
      };
      <span class="hljs-comment">/* #@range_end(filterWith) */</span>
      <span class="hljs-keyword">var</span> isEqual = (a,b) =&gt; {
        <span class="hljs-keyword">return</span> a === b;
      };
      expect(
        <span class="hljs-comment">/* #@range_begin(filterWith_pluck) */</span>
        filterWith((book) =&gt; { 
          <span class="hljs-keyword">return</span> pluck(<span class="hljs-string">"genre"</span>)(book) ===  <span class="hljs-string">"文学"</span>;
        })(books)
        <span class="hljs-comment">/* #@range_end(filterWith_pluck) */</span>
      ).to.eql(
        <span class="hljs-comment">/* #@range_begin(filterWith_pluck_result) */</span>
        [
          {name: <span class="hljs-string">"こころ"</span>, author: [<span class="hljs-string">"夏目漱石"</span>], genre: <span class="hljs-string">"文学"</span>},
          {name: <span class="hljs-string">"夢十夜"</span>, author: [<span class="hljs-string">"夏目漱石"</span>], genre: <span class="hljs-string">"文学"</span>},
        ]
        <span class="hljs-comment">/* #@range_end(filterWith_pluck_result) */</span>
      );
      expect(
        <span class="hljs-comment">/* #@range_begin(map_filter) */</span>
        mapWith(pluck(<span class="hljs-string">"name"</span>))(filterWith((book) =&gt; { 
          <span class="hljs-keyword">return</span> pluck(<span class="hljs-string">"genre"</span>)(book) ===  <span class="hljs-string">"哲学"</span>;
        })(books))
        <span class="hljs-comment">/* #@range_end(map_filter) */</span>
      ).to.eql(
        <span class="hljs-comment">/* #@range_begin(map_filter_result) */</span>
        [<span class="hljs-string">"ソクラテスの弁明"</span>, <span class="hljs-string">"国家"</span>]
        <span class="hljs-comment">/* #@range_end(map_filter_result) */</span>
      );
      
      <span class="hljs-comment">/* #@range_begin(doesContain) */</span>
      <span class="hljs-keyword">var</span> doesContain = (value) =&gt; {
        <span class="hljs-keyword">return</span> (array) =&gt; {
          <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
            <span class="hljs-keyword">return</span> accumulator || (item === value);
          },<span class="hljs-literal">false</span>);
        };
      };
      <span class="hljs-comment">/* #@range_end(doesContain) */</span>
      <span class="hljs-keyword">var</span> doesMatch = (predicate) =&gt; {
        <span class="hljs-keyword">return</span> (array) =&gt; {
          <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
            <span class="hljs-keyword">return</span> accumulator || predicate(item);
          },<span class="hljs-literal">false</span>);
        };
      };
      expect(
        <span class="hljs-comment">/* #@range_begin(filterWith_doesContain) */</span>
        filterWith((book) =&gt; { 
          <span class="hljs-keyword">return</span> doesContain(<span class="hljs-string">"カーニハン"</span>)(pluck(<span class="hljs-string">"author"</span>)(book));
        })(books)
        <span class="hljs-comment">/* #@range_end(filterWith_doesContain) */</span>
      ).to.eql(
        <span class="hljs-comment">/* #@range_begin(filterWith_doesContain_result) */</span>
        [
          {name: <span class="hljs-string">"プログラミング言語C"</span>, author: [<span class="hljs-string">"カーニハン"</span>,<span class="hljs-string">"リッチー"</span>], genre: <span class="hljs-string">"コンピュータ"</span>},
        ]
        <span class="hljs-comment">/* #@range_end(filterWith_doesContain_result) */</span>
      );
      <span class="hljs-comment">/* #@range_begin(findWith) */</span>
      <span class="hljs-keyword">var</span> findWith = (predicate) =&gt; {
        <span class="hljs-keyword">return</span> (array) =&gt; {
          <span class="hljs-keyword">return</span> array.filter(predicate)[<span class="hljs-number">0</span>];
        };
      };
      <span class="hljs-comment">/* #@range_end(findWith) */</span>
      expect(
        findWith((book) =&gt; { 
          <span class="hljs-keyword">return</span> pluck(<span class="hljs-string">"genre"</span>)(book) === <span class="hljs-string">"哲学"</span>;
        })(books)
      ).to.eql(
        {name: <span class="hljs-string">"ソクラテスの弁明"</span>, author: [<span class="hljs-string">"プラトン"</span>], genre: <span class="hljs-string">"哲学"</span>}
      );
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h4 id="-">部品の汎用性</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'部品の汎用性'</span>, () =&gt; {
      describe(<span class="hljs-string">'reduceによる反復処理の汎用化'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>forEachメソッドによるsumの定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        it(<span class="hljs-string">'forEachメソッドによるsumの定義'</span>, (next) =&gt; {
          <span class="hljs-comment">/* #@range_begin(sum_in_array_while) */</span>
          <span class="hljs-keyword">var</span> sum = (array) =&gt; {
            <span class="hljs-comment">/* 結果を格納する変数 */</span>
            <span class="hljs-keyword">var</span> result = <span class="hljs-number">0</span>;
            <span class="hljs-comment">/* 反復した回数を格納する変数 */</span>
            <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>; 
            <span class="hljs-keyword">while</span>(index &lt; array.length) {
              <span class="hljs-comment">/* 変数resultを代入で更新する */</span>
              result = result + array[index];
              <span class="hljs-comment">/* 反復回数を更新する */</span>
              index = index + <span class="hljs-number">1</span>;
            }
            <span class="hljs-keyword">return</span> result;
          };
          <span class="hljs-comment">/* #@range_end(sum_in_array_while)  */</span>
          expect(
            sum([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
          ).to.eql(
            <span class="hljs-number">10</span>
          );
          expect(
            sum([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
          ).to.eql(
            <span class="hljs-number">10</span>
          );
          next();
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>reduceメソッドによるsumの定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        it(<span class="hljs-string">'reduceメソッドによるsumの定義'</span>, (next) =&gt; {
          <span class="hljs-comment">/* #@range_begin(sum_in_array_reduce) */</span>
          <span class="hljs-keyword">var</span> sum = (array) =&gt; {
            <span class="hljs-keyword">return</span> array.reduce(<span class="hljs-comment">/* 第1引数に関数を渡す */</span>
              (accumulator, item) =&gt; { 
                <span class="hljs-keyword">return</span> accumulator + item; <span class="hljs-comment">/* 足し算を実行する */</span>
              },<span class="hljs-number">0</span>); <span class="hljs-comment">// 第2引数には、蓄積変数の初期値として0を渡す </span>
          };
          <span class="hljs-comment">/* #@range_end(sum_in_array_reduce)  */</span>
          expect(
            sum([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
          ).to.eql(
            <span class="hljs-number">10</span>
          );
          next();
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>product関数の定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        it(<span class="hljs-string">'product関数の定義'</span>, (next) =&gt; {
          <span class="hljs-comment">/* #@range_begin(product_in_array_reduce) */</span>
          <span class="hljs-keyword">var</span> product = (array) =&gt; {
            <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
              <span class="hljs-keyword">return</span> accumulator * item; <span class="hljs-comment">/* かけ算を実行する */</span>
            }, <span class="hljs-number">1</span>); <span class="hljs-comment">// 第2引数には、蓄積変数の初期値として1を渡す </span>
          };
          <span class="hljs-comment">/* #@range_end(product_in_array_reduce)  */</span>
          <span class="hljs-comment">/* #@range_begin(product_in_array_reduce_test) */</span>
          expect(
            product([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
          ).to.eql(
            <span class="hljs-number">24</span>
          );
          <span class="hljs-comment">/* #@range_end(product_in_array_reduce_test)  */</span>
          next();
        });
        it(<span class="hljs-string">'allの定義'</span>, (next) =&gt; {
          <span class="hljs-comment">/* #@range_begin(all_in_array_reduce) */</span>
          <span class="hljs-keyword">var</span> all = (array) =&gt; {
            <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
              <span class="hljs-keyword">return</span> accumulator &amp;&amp; item; <span class="hljs-comment">/* 論理和を実行する */</span>
            }); <span class="hljs-comment">/* 第2引数を指定していない場合は、
                   配列の先頭要素が変数accumulatorの初期値になる */</span>
          };
          <span class="hljs-comment">/* #@range_end(all_in_array_reduce)  */</span>
          expect(
            all([<span class="hljs-literal">true</span>,<span class="hljs-literal">true</span>,<span class="hljs-literal">true</span>])
          ).to.eql(
            <span class="hljs-literal">true</span>
          );
          expect(
            <span class="hljs-comment">/* #@range_begin(all_in_array_reduce_test) */</span>
            all([<span class="hljs-literal">true</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">true</span>])
            <span class="hljs-comment">/* #@range_end(all_in_array_reduce_test) */</span>
          ).to.eql(
            <span class="hljs-comment">/* #@range_begin(all_in_array_reduce_test_result) */</span>
            <span class="hljs-literal">false</span>
            <span class="hljs-comment">/* #@range_end(all_in_array_reduce_test_result) */</span>
          );
          next();
        });
        it(<span class="hljs-string">'maxの定義'</span>, (next) =&gt; {
          <span class="hljs-comment">/* #@range_begin(max_in_array_reduce) */</span>
          <span class="hljs-keyword">var</span> max = (array) =&gt; {
            <span class="hljs-keyword">var</span> bigger = (n,m) =&gt; {
              <span class="hljs-keyword">if</span>(n &gt; m) {
                <span class="hljs-keyword">return</span> n;
              } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> m;
              };
            };
            <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
              <span class="hljs-keyword">return</span> bigger(accumulator, item);
            });
          };
          <span class="hljs-comment">/* #@range_end(max_in_array_reduce)  */</span>
          expect(
            max([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])
          ).to.eql(
            <span class="hljs-number">4</span>
          );
          expect(
            max([<span class="hljs-number">1</span>,-<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,-<span class="hljs-number">4</span>])
          ).to.eql(
            <span class="hljs-number">3</span>
          );
          next();
        });
        it(<span class="hljs-string">'reverseの定義'</span>, (next) =&gt; {
          <span class="hljs-comment">/* #@range_begin(reverse_in_array_reduce) */</span>
          <span class="hljs-keyword">var</span> reverse = (array) =&gt; {
            <span class="hljs-keyword">return</span> array.reduce((accumulator, currentValue) =&gt; {
              <span class="hljs-keyword">return</span> [currentValue].concat(accumulator);
            },[]);
          };
          expect(reverse([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])).to.eql([<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>]);
          <span class="hljs-comment">/* #@range_end(reverse_in_array_reduce)  */</span>
          next();
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>map関数の定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        it(<span class="hljs-string">'map関数の定義'</span>, (next) =&gt; {
          <span class="hljs-keyword">var</span> succ = (n) =&gt; {
            <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>;
          };
          <span class="hljs-comment">/* #@range_begin(map_in_array_reduce) */</span>
          <span class="hljs-keyword">var</span> map = (transform) =&gt; {
            <span class="hljs-keyword">return</span> (array) =&gt; {
              <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
                <span class="hljs-keyword">return</span> accumulator.concat(transform(item));
              },[]); <span class="hljs-comment">// 蓄積変数の初期値として空の配列[]を指定する</span>
            };
          };
          <span class="hljs-comment">/* #@range_end(map_in_array_reduce)  */</span>
          expect(
            map(succ)([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
          ).to.eql(
            [<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]
          );
          <span class="hljs-keyword">var</span> constant = (any) =&gt; {
            <span class="hljs-keyword">return</span> (_) =&gt; {
              <span class="hljs-keyword">return</span> any;
            };
          };
          <span class="hljs-keyword">var</span> alwaysOne = constant(<span class="hljs-number">1</span>); 
          expect(
            <span class="hljs-comment">/* #@range_begin(map_in_array_reduce_test) */</span>
            map(succ)([<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>])
            <span class="hljs-comment">/* #@range_end(map_in_array_reduce_test) */</span>
          ).to.eql(
            <span class="hljs-comment">/* #@range_begin(map_in_array_reduce_test_result) */</span>
            [<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>]
            <span class="hljs-comment">/* #@range_end(map_in_array_reduce_test_result) */</span>
          );
          next();
        });
        it(<span class="hljs-string">'reduceによるfilterの定義'</span>, (next) =&gt; {
          <span class="hljs-keyword">var</span> even = (n) =&gt; {
            <span class="hljs-keyword">return</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>;
          };
          <span class="hljs-comment">/* #@range_begin(filter_in_array_reduce) */</span>
          <span class="hljs-keyword">var</span> filter = (array) =&gt; {
            <span class="hljs-keyword">return</span> (predicate) =&gt; {
              <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
                <span class="hljs-keyword">if</span>(predicate(item)) {
                  <span class="hljs-keyword">return</span> accumulator.concat(item);
                } <span class="hljs-keyword">else</span> {
                  <span class="hljs-keyword">return</span> accumulator;
                }
              },[]); <span class="hljs-comment">// 蓄積変数の初期値として空の配列[]を指定する</span>
            };
          };
          <span class="hljs-comment">/* #@range_end(filter_in_array_reduce)  */</span>
          expect(
            filter([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])(even)
          ).to.eql(
            [<span class="hljs-number">2</span>]
          );
          next();
        });
      });
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h3 id="-">部品を組み合わせる</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'部品を組み合わせる'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h4 id="-">関数適用で部品を組み合わせる</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>      it(<span class="hljs-string">'関数適用で部品を組み合わせる'</span>, (next) =&gt; {
        <span class="hljs-keyword">var</span> map = (transform) =&gt; {
          <span class="hljs-keyword">return</span> (array) =&gt; {
            <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
              <span class="hljs-keyword">return</span> accumulator.concat(transform(item));
            },[]); <span class="hljs-comment">// 蓄積変数の初期値として空の配列[]を指定する</span>
          };
        };
        <span class="hljs-keyword">var</span> sum = (array) =&gt; {
          <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; { <span class="hljs-comment">// 第1引数に関数を渡す</span>
            <span class="hljs-keyword">return</span> accumulator + item;                 <span class="hljs-comment">// 足し算を実行する</span>
          },<span class="hljs-number">0</span>); <span class="hljs-comment">// 第2引数には、蓄積変数の初期値として0を渡す </span>
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>constant関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/* #@range_begin(constant) */</span>
        <span class="hljs-keyword">var</span> constant = (any) =&gt; {
          <span class="hljs-keyword">return</span> (_) =&gt; {
            <span class="hljs-keyword">return</span> any;
          };
        };
        <span class="hljs-keyword">var</span> alwaysOne = constant(<span class="hljs-number">1</span>); 
        <span class="hljs-comment">/* #@range_end(constant) */</span>
        <span class="hljs-comment">/* #@range_begin(map_alwaysOne) */</span>
        expect(
          map(alwaysOne)([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
        ).to.eql(
          [<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]
        );
        <span class="hljs-comment">/* #@range_end(map_alwaysOne) */</span>
        <span class="hljs-keyword">var</span> flip = (fun) =&gt; {
          <span class="hljs-keyword">return</span>  (x) =&gt; {
            <span class="hljs-keyword">return</span> (y) =&gt; {
              <span class="hljs-keyword">return</span> fun(y)(x);
            };
          };
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>関数合成によるlength関数の定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/* #@range_begin(array_length_in_composition) */</span>
        <span class="hljs-keyword">var</span> length = (array) =&gt; { <span class="hljs-comment">// 引数が配列であることを明示する</span>
          <span class="hljs-keyword">return</span> compose(sum,map(alwaysOne))(array);
        };
        <span class="hljs-comment">/* #@range_end(array_length_in_composition)  */</span>
        expect(
          length([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
        ).to.eql(
          <span class="hljs-number">3</span>
        );
        next();
      });
      it(<span class="hljs-string">'adderからsucc関数を作る'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(succ_from_adder) */</span>
        <span class="hljs-keyword">var</span> adder = (m) =&gt; {
          <span class="hljs-keyword">return</span> (n) =&gt; {
            <span class="hljs-keyword">return</span> m + n;
          };
        };
        <span class="hljs-keyword">var</span> succ = adder(<span class="hljs-number">1</span>);
        <span class="hljs-comment">/* #@range_end(succ_from_adder)  */</span>
        expect(
          succ(<span class="hljs-number">1</span>)
        ).to.eql(
          <span class="hljs-number">2</span>
        );
        next();
      });
      it(<span class="hljs-string">'length関数を作る'</span>, (next) =&gt; {
        <span class="hljs-keyword">var</span> map = (transform) =&gt; {
          <span class="hljs-keyword">return</span> (array) =&gt; {
            <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
              <span class="hljs-keyword">return</span> accumulator.concat(transform(item));
            },[]); <span class="hljs-comment">// 蓄積変数の初期値として空の配列[]を指定する</span>
          };
        };
        <span class="hljs-keyword">var</span> sum = (array) =&gt; {
          <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; { <span class="hljs-comment">// 第1引数に関数を渡す</span>
            <span class="hljs-keyword">return</span> accumulator + item;                 <span class="hljs-comment">// 足し算を実行する</span>
          },<span class="hljs-number">0</span>); <span class="hljs-comment">// 第2引数には、蓄積変数の初期値として0を渡す </span>
        };
        <span class="hljs-keyword">var</span> constant = (any) =&gt; {
          <span class="hljs-keyword">return</span> (_) =&gt; {
            <span class="hljs-keyword">return</span> any;
          };
        };
        <span class="hljs-keyword">var</span> alwaysOne = constant(<span class="hljs-number">1</span>); 
        <span class="hljs-comment">/* #@range_begin(array_length) */</span>
        <span class="hljs-keyword">var</span> length = (array) =&gt; {
          <span class="hljs-keyword">return</span> sum(map(alwaysOne)(array));
        };
        <span class="hljs-comment">/* #@range_end(array_length)  */</span>
        expect(
          length([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
        ).to.eql(
          <span class="hljs-number">3</span>
        );
        next();
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h4 id="-">関数合成による処理の合成</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>      describe(<span class="hljs-string">'関数合成による処理の合成'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>compose関数の定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/* #@range_begin(function_compose) */</span>
        <span class="hljs-keyword">var</span> compose = (f,g) =&gt; {
          <span class="hljs-keyword">return</span> (arg) =&gt; {
            <span class="hljs-keyword">return</span> f(g(arg));
          };
        };
        <span class="hljs-comment">/* #@range_end(function_compose)  */</span>
        it(<span class="hljs-string">'関数合成でlength関数を作る(ポイントフリー版)'</span>, (next) =&gt; {
          <span class="hljs-keyword">var</span> map = (transform) =&gt; {
            <span class="hljs-keyword">return</span> (array) =&gt; {
              <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; {
                <span class="hljs-keyword">return</span> accumulator.concat(transform(item));
              },[]); <span class="hljs-comment">// 蓄積変数の初期値として空の配列[]を指定する</span>
            };
          };
          <span class="hljs-keyword">var</span> sum = (array) =&gt; {
            <span class="hljs-keyword">return</span> array.reduce((accumulator, item) =&gt; { <span class="hljs-comment">// 第1引数に関数を渡す</span>
              <span class="hljs-keyword">return</span> accumulator + item;                 <span class="hljs-comment">// 足し算を実行する</span>
            },<span class="hljs-number">0</span>); <span class="hljs-comment">// 第2引数には、蓄積変数の初期値として0を渡す </span>
          };
          <span class="hljs-keyword">var</span> constant = (any) =&gt; {
            <span class="hljs-keyword">return</span> (_) =&gt; {
              <span class="hljs-keyword">return</span> any;
            };
          };
          <span class="hljs-keyword">var</span> alwaysOne = constant(<span class="hljs-number">1</span>); 
          <span class="hljs-comment">/* #@range_begin(flip_definition) */</span>
          <span class="hljs-keyword">var</span> flip = (fun) =&gt; {
            <span class="hljs-keyword">return</span>  (x) =&gt; {
              <span class="hljs-keyword">return</span> (y) =&gt; {
                <span class="hljs-keyword">return</span> fun(y)(x);
              };
            };
          };
          <span class="hljs-comment">/* #@range_end(flip_definition) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>関数合成によるlength関数の定義（ポイントフリースタイル）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-comment">/* #@range_begin(array_length_in_composition_with_point_free_style) */</span>
          <span class="hljs-keyword">var</span> length = compose(sum,map(alwaysOne));
          <span class="hljs-comment">/* #@range_end(array_length_in_composition_with_point_free_style)  */</span>
          expect(
            length([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
          ).to.eql(
            <span class="hljs-number">3</span>
          );
          next();
        });
      });
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h3 id="-">テストが容易である</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'テスト'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>単体テストの書き方の例</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'単体テストの書き方の例'</span>, (next) =&gt; {
      <span class="hljs-keyword">var</span> succ = (n) =&gt; {
        <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>;
      };
      expect(
        succ(<span class="hljs-number">1</span>) <span class="hljs-comment">// テストしたい式を書く</span>
      ).to.eql(
        <span class="hljs-number">2</span>       <span class="hljs-comment">// 期待する結果を書く</span>
      );
      next();
    });
    it(<span class="hljs-string">'参照透過性のあるコードはテストが容易である'</span>, (next) =&gt; {
      <span class="hljs-keyword">var</span> adder = (m) =&gt; {
        <span class="hljs-keyword">return</span> (n) =&gt; {
          <span class="hljs-keyword">return</span> m + n;
        };
      };
      <span class="hljs-comment">/* #@range_begin(adder_test) */</span>
      expect(
        adder(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)
      ).to.eql(
        <span class="hljs-number">3</span>
      );
      <span class="hljs-comment">/* #@range_end(adder_test) */</span>
      next();
    });
    describe(<span class="hljs-string">'参照透過性のないコードはテストが困難である'</span>, () =&gt; {
      describe(<span class="hljs-string">'ゲームの勝敗の例'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>参照透過性のないコードのテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        it(<span class="hljs-string">"参照透過性のないコードのテスト"</span>, (next) =&gt; {
          <span class="hljs-comment">/* #@range_begin(winner_with_sideeffect) */</span>
          <span class="hljs-keyword">var</span> winner = (playerL, playerR) =&gt; {
            <span class="hljs-keyword">if</span>(playerR.score &gt; playerL.score) {
              <span class="hljs-built_in">console</span>.log(playerR.name + <span class="hljs-string">"が勝者です"</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(playerR.score &lt; playerL.score) {
              <span class="hljs-built_in">console</span>.log(playerL.name + <span class="hljs-string">"が勝者です"</span>);
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"引き分けです"</span>);
            }
          }; 
          <span class="hljs-comment">/* #@range_end(winner_with_sideeffect) */</span>
          <span class="hljs-keyword">var</span> playerA = {
            name: <span class="hljs-string">'a'</span>,
            score: <span class="hljs-number">10</span>
          };
          <span class="hljs-keyword">var</span> playerB = {
            name: <span class="hljs-string">'b'</span>,
            score: <span class="hljs-number">20</span>
          };
          next();
        });
        it(<span class="hljs-string">"参照透過性のあるコードのテスト"</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>winner関数の分離</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-comment">/* #@range_begin(winner_without_sideeffect) */</span>
          <span class="hljs-comment">/* 勝者を判定する */</span>
          <span class="hljs-keyword">var</span> judge = (playerL, playerR) =&gt; {
            <span class="hljs-keyword">if</span>(playerL.score &gt; playerR.score) {
              <span class="hljs-keyword">return</span> playerL;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(playerL.score &lt; playerR.score) {
              <span class="hljs-keyword">return</span> playerR;
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
          }; 
          <span class="hljs-comment">/* 勝者を告げる文字列を生成する */</span>
          <span class="hljs-keyword">var</span> announce = (winner) =&gt; {
            <span class="hljs-keyword">if</span>(winner) {
              <span class="hljs-keyword">return</span> winner.name + <span class="hljs-string">"が勝者です"</span>;
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> <span class="hljs-string">"引き分けです"</span>;
            }
          };
          <span class="hljs-comment">/* 勝者を表示する */</span>
          <span class="hljs-keyword">var</span> displayWinner = (winner) =&gt; {
            <span class="hljs-built_in">console</span>.log(announce(winner));
          };
          <span class="hljs-comment">/* #@range_end(winner_without_sideeffect) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>副作用のない関数のテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-comment">/* #@range_begin(announce_winner) */</span>
          <span class="hljs-keyword">var</span> socrates = {
            name: <span class="hljs-string">'ソクラテス'</span>,
            score: <span class="hljs-number">10</span>
          };
          <span class="hljs-keyword">var</span> plato = {
            name: <span class="hljs-string">'プラトン'</span>,
            score: <span class="hljs-number">20</span>
          };
          <span class="hljs-comment">/* 純粋な関数をテストする */</span>
          expect(
            announce(judge(socrates, plato))
          ).to.eql(
            <span class="hljs-string">"プラトンが勝者です"</span>
          );
          <span class="hljs-comment">/* #@range_end(announce_winner) */</span>
          next();
        });
      });
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h3 id="-">コードの正しさを証明できる</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'コードの正しさを証明できる'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <h4 id="-">プロパティテストで正しさを検証する</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'プロパティテストで正しさを検証する'</span>, () =&gt; {
      <span class="hljs-keyword">var</span> adder = (m) =&gt; {
        <span class="hljs-keyword">return</span> (n) =&gt; {
          <span class="hljs-keyword">return</span> m + n;
        };
      };
      <span class="hljs-keyword">var</span> succ = adder(<span class="hljs-number">1</span>);
      <span class="hljs-keyword">var</span> iterate = (step) =&gt; {
        <span class="hljs-keyword">return</span> (init) =&gt; {
          <span class="hljs-keyword">return</span> [init, (_) =&gt; {
            <span class="hljs-keyword">return</span> iterate(step)(step(init));
          }];
        };
      };
      <span class="hljs-keyword">var</span> take = (n) =&gt; {
        <span class="hljs-keyword">return</span> (aStream) =&gt; {
          <span class="hljs-keyword">if</span>(n === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> [];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> [aStream[<span class="hljs-number">0</span>]].concat(take(n-<span class="hljs-number">1</span>)(aStream[<span class="hljs-number">1</span>]()));
          }
        };
      };
      <span class="hljs-keyword">var</span> enumFrom = (from) =&gt; {
        <span class="hljs-keyword">return</span> iterate(succ)(from);
      };
      <span class="hljs-keyword">var</span> filter = (predicate) =&gt; {
        <span class="hljs-keyword">return</span> (aStream) =&gt; {
          <span class="hljs-keyword">var</span> head = aStream[<span class="hljs-number">0</span>];
          <span class="hljs-keyword">if</span>(predicate(head) === <span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">return</span> [head, (_) =&gt; {
              <span class="hljs-keyword">return</span> filter(predicate)(aStream[<span class="hljs-number">1</span>]());
            }];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> filter(predicate)(aStream[<span class="hljs-number">1</span>]());
          }
        };
      };
      it(<span class="hljs-string">'succ関数の性質テスト'</span>, (next) =&gt; {
        <span class="hljs-keyword">var</span> elemAt = (n) =&gt; {
          <span class="hljs-keyword">return</span> (aStream) =&gt; {
            <span class="hljs-keyword">if</span>(n === <span class="hljs-number">1</span>) {
              <span class="hljs-keyword">return</span> aStream[<span class="hljs-number">0</span>];
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> elemAt(n-<span class="hljs-number">1</span>)(aStream[<span class="hljs-number">1</span>]());
            };
          };
        };
        <span class="hljs-keyword">var</span> scanl = (aStream) =&gt; {
          <span class="hljs-keyword">return</span> (glue) =&gt; {
            <span class="hljs-keyword">var</span> out = [aStream[<span class="hljs-number">0</span>], (_) =&gt; {
              <span class="hljs-keyword">return</span> zipWith(glue)(aStream[<span class="hljs-number">1</span>](), out);
            }];
            <span class="hljs-keyword">return</span> out;
          };
        };
        <span class="hljs-keyword">var</span> conjunction = (x,y) =&gt; {
          <span class="hljs-keyword">return</span> x &amp;&amp; y;  <span class="hljs-comment">// 論理和をとる</span>
        };
        <span class="hljs-keyword">var</span> zipWith = (glue) =&gt; {
          <span class="hljs-keyword">return</span> (xs, ys) =&gt; {
            <span class="hljs-keyword">if</span>(xs.length === <span class="hljs-number">0</span>) {
              <span class="hljs-keyword">return</span> []; 
            } 
            <span class="hljs-keyword">if</span>(ys.length === <span class="hljs-number">0</span>) {
              <span class="hljs-keyword">return</span> []; 
            } 
            <span class="hljs-keyword">return</span> [glue(xs[<span class="hljs-number">0</span>], ys[<span class="hljs-number">0</span>]), (_) =&gt; {
              <span class="hljs-keyword">return</span> zipWith(glue)(xs[<span class="hljs-number">1</span>](), ys[<span class="hljs-number">1</span>]());
            }];
          };
        };
        <span class="hljs-keyword">var</span> listAnd = (aStream) =&gt; {
          <span class="hljs-keyword">var</span> out = [aStream[<span class="hljs-number">0</span>], (_) =&gt; {
            <span class="hljs-keyword">return</span> zipWith((x,y) =&gt; { 
              <span class="hljs-keyword">return</span> x &amp;&amp; y;
            })(aStream[<span class="hljs-number">1</span>](), out);
          }];
          <span class="hljs-keyword">return</span> out;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>プロパティテストのための関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/* #@range_begin(succ_property) */</span>
        <span class="hljs-comment">/* ストリームのmap関数 */</span>
        <span class="hljs-keyword">var</span> map = (transform) =&gt; {
          <span class="hljs-keyword">return</span> (aStream) =&gt; {
            <span class="hljs-keyword">var</span> head = aStream[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">return</span> [transform(head), (_) =&gt; {
              <span class="hljs-keyword">return</span> map(transform)(aStream[<span class="hljs-number">1</span>]());
            }];
          };
        };
        <span class="hljs-comment">/* ストリームの先頭から引数n分だけ取り出すtake関数 */</span>
        <span class="hljs-keyword">var</span> take = (n) =&gt; {
          <span class="hljs-keyword">return</span> (aStream) =&gt; {
            <span class="hljs-keyword">if</span>(n === <span class="hljs-number">0</span>) {
              <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> [aStream[<span class="hljs-number">0</span>], (_) =&gt; {
                <span class="hljs-keyword">return</span> take(n-<span class="hljs-number">1</span>)(aStream[<span class="hljs-number">1</span>]());
              }];
            }
          };
        };
        <span class="hljs-comment">/* ストリームの全ての要素がtrueであるかを判定するall関数 */</span>
        <span class="hljs-keyword">var</span> all = (aStream) =&gt; {
          <span class="hljs-keyword">var</span> allHelper = (aStream, accumulator) =&gt; {
            <span class="hljs-keyword">var</span> head = aStream[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">var</span> newAccumulator = accumulator &amp;&amp; head;
            <span class="hljs-keyword">if</span>(aStream[<span class="hljs-number">1</span>]() === <span class="hljs-literal">null</span>){
              <span class="hljs-keyword">return</span> newAccumulator;
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> allHelper(aStream[<span class="hljs-number">1</span>](), newAccumulator);
            } 
          };
          <span class="hljs-keyword">return</span> allHelper(aStream, <span class="hljs-literal">true</span>);
        };
        <span class="hljs-comment">/* 検証の対象となる命題 */</span>
        <span class="hljs-keyword">var</span> proposition = (n) =&gt; {
          <span class="hljs-keyword">return</span> succ(<span class="hljs-number">0</span>) + succ(n) === succ(succ(n));
        };
        <span class="hljs-comment">/* #@range_end(succ_property) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>succ関数のプロパティテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/* #@range_begin(succ_property_test) */</span>
        <span class="hljs-comment">/* 100個の整数について命題が正しいかをテストする */</span>
        expect(
          all(
            take(<span class="hljs-number">100</span>)(
              map(proposition)(enumFrom(<span class="hljs-number">0</span>))
            )
          )
        ).to.eql(
          <span class="hljs-literal">true</span>
        );
        <span class="hljs-comment">/* #@range_end(succ_property_test) */</span>
        next();
      });
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p><a href="http://akimichi.github.io/functionaljs/">目次に戻る</a> <a href="http://akimichi.github.io/functionaljs/chap03.spec.html">次章に移る</a> </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>});</pre></div></div>
            
        </li>
        
    </ul>
  <!-- <div id="footer">  目次に戻る。 </div> -->
  <!-- </div> -->
</body>
</html>
