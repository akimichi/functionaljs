<!DOCTYPE html>

<html>
<head>
  <title>chap06.spec.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
  <script type="text/javascript" async
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <!-- <script type="text/x-mathjax-config"> -->
  <!--   MathJax.Hub.Config({ -->
  <!--   tex2jax: { -->
  <!--       inlineMath: [ ['$','$'], ['\\(','\\)'] ], -->
  <!--       displayMath: [ ['$$','$$'], ["\\[","\\]"] ], -->
  <!--       processEscapes: true -->
  <!--   } -->
  <!--   }); -->
  <!-- </script> -->
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>chap06.spec.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="-6-">第6章 関数を利用する</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="-">小目次</h2>
<div class="toc">
<ul class="toc">
  <li><a href="http://akimichi.github.io/functionaljs/chap06.spec.html#function-basics">6.1 関数の基本</a>
    <ul>
       <li><a href="http://akimichi.github.io/functionaljs/chap06.spec.html#function-definition">関数を定義する</a></li>
       <li><a href="http://akimichi.github.io/functionaljs/chap06.spec.html#function-application">関数を適用する</a></li></ul>
  </li>
  <li><a href="http://akimichi.github.io/functionaljs/chap06.spec.html#function-and-referential-transparency">6.2 関数と参照透過性</a>
     <ul>
        <li><a href="http://akimichi.github.io/functionaljs/chap06.spec.html#purity-of-function">関数の純粋性</a></li>
        <li><a href="http://akimichi.github.io/functionaljs/chap06.spec.html#coping-sideeffect">副作用への対処</a></li>
     </ul>
  </li>
</ul>
</div>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'expect.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="6-1-section-id-function-basics-section-">6.1 <section id='function-basics'>関数の基本</section></h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'関数の基本'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3 id="-section-id-function-definition-section-"><section id='function-definition'>関数を定義する</section></h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'関数を定義する'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong>リスト6.1</strong> 恒等関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'恒等関数'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(identity_function_definition) */</span>
      <span class="hljs-keyword">var</span> identity = (any) =&gt; {
        <span class="hljs-keyword">return</span> any;
      };
      <span class="hljs-comment">/* #@range_end(identity_function_definition) */</span>
      expect(
        identity(<span class="hljs-number">1</span>)
      ).to.eql(
        <span class="hljs-number">1</span>
      );
      expect(
        identity(<span class="hljs-string">"a"</span>)
      ).to.eql(
        <span class="hljs-string">"a"</span>
      );
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>リスト6.2</strong> succ関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'succ関数'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(succ_function_definition) */</span>
      <span class="hljs-keyword">var</span> succ = (n) =&gt; {
        <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>;
      };
      <span class="hljs-comment">/* #@range_end(succ_function_definition) */</span>
      <span class="hljs-comment">/* テスト */</span>
      expect(
        succ(<span class="hljs-number">0</span>)  <span class="hljs-comment">// 0 を引数にsucc関数を適用する</span>
      ).to.eql(
        <span class="hljs-number">1</span>
      );
      expect(
        succ(<span class="hljs-number">1</span>)  <span class="hljs-comment">// 数値1にsucc関数を適用する</span>
      ).to.eql(
        <span class="hljs-number">2</span>
      );</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <pre><code>node&gt; <span class="hljs-keyword">var</span> succ = (n) =&gt; { <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>; }; 
<span class="hljs-literal">undefined</span>
node&gt; succ(<span class="hljs-string">"abc"</span>)
abc1
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>      expect(
        succ(<span class="hljs-string">"abc"</span>)
      ).to.eql(
        <span class="hljs-string">"abc1"</span>
      );
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>リスト6.3</strong> add関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'add関数'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(add_function_definition) */</span>
      <span class="hljs-comment">/* add:: (NUM, NUM) =&gt; NUM */</span>
      <span class="hljs-keyword">var</span> add = (n, m) =&gt; {
        <span class="hljs-keyword">return</span> n + m;
      };
      <span class="hljs-comment">/* #@range_end(add_function_definition) */</span>
      <span class="hljs-comment">/* テスト */</span>
      expect(
        add(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)
      ).to.eql(
        <span class="hljs-number">1</span>
      );
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>リスト6.5</strong> 関数の変数へのバインド</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'関数の変数へのバインド'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(function_bound_to_variable) */</span>
      <span class="hljs-keyword">var</span> succ = (x) =&gt; {
        <span class="hljs-keyword">return</span> x + <span class="hljs-number">1</span>;
      };
      <span class="hljs-comment">/* #@range_end(function_bound_to_variable) */</span>
      next();
    });
    it(<span class="hljs-string">'引数を参照しない関数'</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>リスト6.6</strong> 定数関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-comment">/* #@range_begin(constant_one_function) */</span>
      <span class="hljs-keyword">var</span> alwaysOne = (x) =&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
      };
      <span class="hljs-comment">/* #@range_end(constant_one_function) */</span>
      expect(
        alwaysOne(<span class="hljs-number">1</span>)
      ).to.eql(
        <span class="hljs-number">1</span>
      );
      expect(
        alwaysOne(<span class="hljs-string">"a"</span>)
      ).to.eql(
        <span class="hljs-number">1</span>
      );</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>リスト6.7</strong> left関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-comment">/* #@range_begin(left_function) */</span>
      <span class="hljs-keyword">var</span> left = (x,y) =&gt; {
        <span class="hljs-keyword">return</span> x;
      };
      <span class="hljs-comment">/* #@range_end(left_function) */</span>
      expect(
        left(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)
      ).to.eql(
        <span class="hljs-number">1</span>
      );
      next();
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h3 id="-section-id-function-application-section-"><section id='function-application'>関数を適用する</section></h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'関数を適用する'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>リスト6.8</strong> succ関数のテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'succ関数のテスト'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(succ_function_test) */</span>
      <span class="hljs-keyword">var</span> succ = (n) =&gt; { <span class="hljs-comment">// nは仮引数 </span>
        <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>;
      };
      expect(
        succ(<span class="hljs-number">1</span>)  <span class="hljs-comment">// 数値1にsucc関数を適用する</span>
      ).to.eql(
        <span class="hljs-number">2</span>
      );
      <span class="hljs-comment">/* #@range_end(succ_function_test) */</span>
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h4 id="-">関数の評価戦略</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'関数の評価戦略'</span>, () =&gt; {
      it(<span class="hljs-string">'add(succ(0), succ(2))の簡約'</span>, (next) =&gt; {
        <span class="hljs-keyword">var</span> add = (n, m) =&gt; {
          <span class="hljs-keyword">return</span> n + m;
        };
        <span class="hljs-keyword">var</span> succ = (n) =&gt; {
          <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>;
        };
        expect(
          add(succ(<span class="hljs-number">0</span>), succ(<span class="hljs-number">2</span>))
        ).to.eql(
          <span class="hljs-number">4</span>
        );
        next();
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>リスト6.9</strong> JavaScriptにおける正格評価</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      it(<span class="hljs-string">'JavaScriptにおける正格評価'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(strict_evaluation_in_javascript) */</span>
        <span class="hljs-keyword">var</span> left = (x,y) =&gt; {
          <span class="hljs-keyword">return</span> x;
        };
        <span class="hljs-keyword">var</span> infiniteLoop = (_) =&gt; {
          <span class="hljs-keyword">return</span> infiniteLoop(_);
        };
        <span class="hljs-comment">/* このテストは無限ループになるのでコメントアウトしている
         expect(
           left(1, infiniteLoop())
         ).to.eql(
           1
         )
         */</span>
        <span class="hljs-comment">/* #@range_end(strict_evaluation_in_javascript) */</span>
        next();
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>リスト6.10</strong> 条件文と遅延評価</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      it(<span class="hljs-string">'条件文と遅延評価'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(conditional_is_nonstrict) */</span>
        <span class="hljs-keyword">var</span> infiniteLoop = () =&gt; {
          <span class="hljs-keyword">return</span> infiniteLoop();
        };

        <span class="hljs-keyword">var</span> conditional = (n) =&gt; {
          <span class="hljs-keyword">if</span>(n === <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">/* 条件文が真の場合には評価されない */</span>
            <span class="hljs-keyword">return</span> infiniteLoop();
          }
        };
        expect(
          conditional(<span class="hljs-number">1</span>)
        ).to.eql(
          <span class="hljs-literal">true</span> <span class="hljs-comment">// 無限ループに陥ることなく計算に成功する</span>
        );
        <span class="hljs-comment">/* #@range_end(conditional_is_nonstrict) */</span>
        next();
      });
      it(<span class="hljs-string">'乗算の遅延評価'</span>, (next) =&gt; {
        <span class="hljs-keyword">var</span> infiniteLoop = () =&gt; {
          <span class="hljs-keyword">return</span> infiniteLoop();
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>リスト6.11</strong> 遅延評価で定義したmultiply関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/* #@range_begin(multiply_lazy_evaluation) */</span>
        <span class="hljs-keyword">var</span> lazyMultiply = (funX,funY) =&gt; {
          <span class="hljs-keyword">var</span> x = funX();

          <span class="hljs-keyword">if</span>(x === <span class="hljs-number">0</span>){
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;          <span class="hljs-comment">// xが0ならば、funYは評価しない</span>
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> x * funY(); <span class="hljs-comment">// ここで初めてfunYを評価する</span>
          }
        };
        <span class="hljs-comment">/* #@range_end(multiply_lazy_evaluation) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong>リスト6.12</strong> 遅延評価で定義したmultiply関数のテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/* #@range_begin(multiply_lazy_evaluation_test) */</span>
        expect(
          lazyMultiply((_) =&gt; {    <span class="hljs-comment">// 値を関数でラッピングする</span>
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
          }, (_) =&gt; {
            <span class="hljs-keyword">return</span> infiniteLoop(); <span class="hljs-comment">// ここが評価されると無限ループに陥る</span>
          })
        ).to.eql(
          <span class="hljs-number">0</span>
        );
        <span class="hljs-comment">/* #@range_end(multiply_lazy_evaluation_test) */</span>
        next();
      });
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h4 id="-">サンクで無限を表現する</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'サンクで無限を表現する'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><strong>リスト6.14</strong> サンクによるストリーム型の定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-comment">/* #@range_begin(stream_with_thunk) */</span>
      <span class="hljs-keyword">var</span> stream = {
        match: (data, pattern) =&gt; {
          <span class="hljs-keyword">return</span> data(pattern);
        },
        empty: (_) =&gt; {
          <span class="hljs-keyword">return</span> (pattern) =&gt; {
            <span class="hljs-keyword">return</span> pattern.empty();
          };
        },
        cons: (head,tailThunk) =&gt; {
          <span class="hljs-keyword">return</span> (pattern) =&gt; {
            <span class="hljs-keyword">return</span> pattern.cons(head,tailThunk);
          };
        },
        <span class="hljs-comment">/* head:: STREAM[T] =&gt; T */</span>
        <span class="hljs-comment">/* ストリーム型headの定義は、リスト型headと同じ */</span>
        head: (astream) =&gt; {
          <span class="hljs-keyword">return</span> stream.match(astream,{
            empty: (_) =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; },
            cons: (value, tailThunk) =&gt; { <span class="hljs-keyword">return</span> value; }
          });
        },
        <span class="hljs-comment">/* tail:: STREAM[T] =&gt; STREAM[T] */</span>
        tail: (astream) =&gt; {
          <span class="hljs-keyword">return</span> stream.match(astream,{
            empty: (_) =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; },
            cons: (head, tailThunk) =&gt; {
              <span class="hljs-keyword">return</span> tailThunk(); <span class="hljs-comment">// ここで初めてサンクを評価する</span>
            }
          });
        }
      };
      <span class="hljs-comment">/* #@range_end(stream_with_thunk) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><strong>リスト6.16</strong> ストリーム型のテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      it(<span class="hljs-string">"ストリーム型のテスト"</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(stream_with_thunk_test) */</span>
        <span class="hljs-keyword">var</span> theStream = stream.cons(<span class="hljs-number">1</span>, (_) =&gt; { <span class="hljs-comment">// 第2引数にサンクを渡す</span>
          <span class="hljs-keyword">return</span> stream.cons(<span class="hljs-number">2</span>,(_) =&gt; {         <span class="hljs-comment">// 第2引数にサンクを渡す</span>
            <span class="hljs-keyword">return</span> stream.empty();
          });
        });
        expect(
          stream.head(theStream)  <span class="hljs-comment">// ストリームの先頭要素を取り出す</span>
        ).to.eql(
          <span class="hljs-number">1</span>
        );
        <span class="hljs-comment">/* #@range_end(stream_with_thunk_test) */</span>
        next();
      });
      describe(<span class="hljs-string">"無限ストリームを作る"</span>, () =&gt; {
        <span class="hljs-keyword">var</span> match = (data, pattern) =&gt; {
          <span class="hljs-keyword">return</span> data(pattern);
        };
        <span class="hljs-keyword">var</span> stream = {
          empty: (_) =&gt; {
            <span class="hljs-keyword">return</span> (pattern) =&gt; {
              <span class="hljs-keyword">return</span> pattern.empty();
            };
          },
          cons: (head,tailThunk) =&gt; {
            <span class="hljs-keyword">return</span> (pattern) =&gt; {
              <span class="hljs-keyword">return</span> pattern.cons(head,tailThunk);
            };
          },
          <span class="hljs-comment">/* head:: STREAM[T] =&gt; T */</span>
          <span class="hljs-comment">/* ストリーム型headの定義は、リスト型headと同じ */</span>
          head: (astream) =&gt; {
            <span class="hljs-keyword">return</span> match(astream,{
              empty: (_) =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; },
              cons: (value, tailThunk) =&gt; { <span class="hljs-keyword">return</span> value; }
            });
          },
          <span class="hljs-comment">/* tail:: STREAM[T] =&gt; STREAM[T] */</span>
          tail: (astream) =&gt; {
            <span class="hljs-keyword">return</span> match(astream,{
              empty: (_) =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; },
              cons: (head, tailThunk) =&gt; {
                <span class="hljs-keyword">return</span> tailThunk();  <span class="hljs-comment">// ここで初めてサンクを評価する</span>
              }
            });
          }
        };
        it(<span class="hljs-string">"無限の整数列を作る"</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><strong>リスト6.17</strong> 無限に1が続く数列</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-comment">/* #@range_begin(infinite_ones) */</span>
          <span class="hljs-comment">/* ones = 1,1,1,1,... */</span>
          <span class="hljs-keyword">var</span> ones = stream.cons(<span class="hljs-number">1</span>, (_) =&gt; {
            <span class="hljs-keyword">return</span> ones; <span class="hljs-comment">// onesを再帰的に呼び出す</span>
          });
          <span class="hljs-comment">/* #@range_end(infinite_ones) */</span>
          <span class="hljs-comment">/* #@range_begin(infinite_ones_test) */</span>
          expect(
            stream.head(ones) <span class="hljs-comment">// 最初の要素を取りだす</span>
          ).to.eql(
            <span class="hljs-number">1</span>
          );
          expect(
            stream.head(stream.tail(ones))  <span class="hljs-comment">// 2番目の要素を取りだす</span>
          ).to.eql(
            <span class="hljs-number">1</span>
          );
          <span class="hljs-comment">/* #@range_end(infinite_ones_test) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><strong>リスト6.19</strong> 無限に連続する整数列を生成するenumFrom関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-comment">/* #@range_begin(infinite_integer) */</span>
          <span class="hljs-keyword">var</span> enumFrom = (n) =&gt; {
            <span class="hljs-keyword">return</span> stream.cons(n, (_) =&gt; {
              <span class="hljs-keyword">return</span> enumFrom(n + <span class="hljs-number">1</span>);
            });
          };
          <span class="hljs-comment">/* #@range_end(infinite_integer) */</span>
          expect(
            stream.head(enumFrom(<span class="hljs-number">1</span>)) <span class="hljs-comment">// 最初の要素を取りだす</span>
          ).to.eql(
            <span class="hljs-number">1</span>
          );
          expect(
            stream.head(stream.tail(enumFrom(<span class="hljs-number">1</span>)))  <span class="hljs-comment">// 2番目の要素を取りだす</span>
          ).to.eql(
            <span class="hljs-number">2</span>
          );
          next();
        });
        it(<span class="hljs-string">"無限の整数列をテストする"</span>, (next) =&gt; {
          <span class="hljs-keyword">this</span>.timeout(<span class="hljs-number">3000</span>);
          <span class="hljs-keyword">var</span> enumFrom = (n) =&gt; {
            <span class="hljs-keyword">return</span> stream.cons(n, (_) =&gt; {
              <span class="hljs-keyword">return</span> enumFrom(n + <span class="hljs-number">1</span>);
            });
          };
          <span class="hljs-comment">/* take関数を定義するため、streamモジュールを再掲する */</span>
          <span class="hljs-keyword">var</span> stream = {
            match: (data, pattern) =&gt; {
              <span class="hljs-keyword">return</span> data(pattern);
            },
            empty: (_) =&gt; {
              <span class="hljs-keyword">return</span> (pattern) =&gt; {
                <span class="hljs-keyword">return</span> pattern.empty();
              };
            },
            cons: (head,tailThunk) =&gt; {
              <span class="hljs-keyword">return</span> (pattern) =&gt; {
                <span class="hljs-keyword">return</span> pattern.cons(head,tailThunk);
              };
            },
            head: (astream) =&gt; {
              <span class="hljs-keyword">return</span> match(astream,{
                empty: (_) =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; },
                cons: (value, tailThunk) =&gt; { <span class="hljs-keyword">return</span> value; }
              });
            },
            tail: (astream) =&gt; {
              <span class="hljs-keyword">return</span> match(astream,{
                empty: (_) =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; },
                cons: (head, tailThunk) =&gt; {
                  <span class="hljs-keyword">return</span> tailThunk();  
                }
              });
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><strong>リスト6.21</strong> ストリームのtake関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-comment">/* #@range_begin(stream_take) */</span>
            <span class="hljs-comment">/* take:: (STREAM[T], NUM) =&gt; LIST[T] */</span>
            take: (astream, n) =&gt; {
              <span class="hljs-keyword">return</span> stream.match(astream,{
                empty: (_) =&gt; {              <span class="hljs-comment">// ストリームが空のケース</span>
                  <span class="hljs-keyword">return</span> list.empty();
                },
                cons: (head,tailThunk) =&gt; {  <span class="hljs-comment">// ストリームが空でないケース </span>
                  <span class="hljs-keyword">if</span>(n === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">return</span> list.empty();
                  } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> list.cons(head,   <span class="hljs-comment">// リストを生成する</span>
                                     stream.take(tailThunk(),(n -<span class="hljs-number">1</span>)));
                  }
                }
              });
            }
            <span class="hljs-comment">/* #@range_end(stream_take) */</span>
          };
          expect(
            stream.head(enumFrom(<span class="hljs-number">1</span>))
          ).to.eql(
            <span class="hljs-number">1</span>
          );
          expect(
            stream.head(stream.tail(enumFrom(<span class="hljs-number">1</span>)))
          ).to.eql(
            <span class="hljs-number">2</span>
          );
          <span class="hljs-keyword">var</span> list = {
            match: (data, pattern) =&gt; {
              <span class="hljs-keyword">return</span> data(pattern);
            },
            empty: (_) =&gt; {
              <span class="hljs-keyword">return</span> (pattern) =&gt; {
                <span class="hljs-keyword">return</span> pattern.empty();
              };
            },
            cons: (value, list) =&gt; {
              <span class="hljs-keyword">return</span> (pattern) =&gt; {
                <span class="hljs-keyword">return</span> pattern.cons(value, list);
              };
            },
            isEmpty: (alist) =&gt; {
              <span class="hljs-keyword">return</span> match(alist, { 
                empty: <span class="hljs-literal">true</span>,
                cons: (head, tail) =&gt; { 
                  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
              });
            },
            head: (alist) =&gt; {
              <span class="hljs-keyword">return</span> match(alist, {
                empty: <span class="hljs-literal">null</span>, 
                cons: (head, tail) =&gt; {
                  <span class="hljs-keyword">return</span> head;
                }
              });
            },
            tail: (alist) =&gt; {
              <span class="hljs-keyword">return</span> match(alist, {
                empty: <span class="hljs-literal">null</span>,
                cons: (head, tail) =&gt; {
                  <span class="hljs-keyword">return</span> tail;
                }
              });
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><strong>リスト6.22</strong> リストのtoArray関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-comment">/* #@range_begin(list_toArray) */</span>
            toArray: (alist) =&gt; {
              <span class="hljs-keyword">var</span> toArrayHelper = (alist,accumulator) =&gt; {
                <span class="hljs-keyword">return</span> list.match(alist, {
                  empty: (_) =&gt; {
                    <span class="hljs-keyword">return</span> accumulator;
                  },
                  cons: (head, tail) =&gt; {
                    <span class="hljs-keyword">return</span> toArrayHelper(tail,
                                         accumulator.concat(head));
                  }
                });
              };
              <span class="hljs-keyword">return</span> toArrayHelper(alist, []);
            }
            <span class="hljs-comment">/* #@range_end(list_toArray) */</span>
          };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><strong>リスト6.23</strong> 無限の整数列をテストする</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-comment">/* #@range_begin(infinite_integer_test) */</span>
          expect(
            list.toArray( <span class="hljs-comment">// ストリームを配列に変換する</span>
              stream.take(enumFrom(<span class="hljs-number">1</span>),<span class="hljs-number">4</span>) <span class="hljs-comment">// 無限の整数列から4個の要素を取り出す </span>
            )
          ).to.eql(
            [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]
          );
          <span class="hljs-comment">/* #@range_end(infinite_integer_test) */</span>
          <span class="hljs-comment">/* #@range_begin(stream_filter_test) */</span>
          expect(
            <span class="hljs-comment">/* 無限の整数列から最初の4つの要素を取り出し、それを配列に変換する */</span>
            list.toArray(stream.take(enumFrom(<span class="hljs-number">1</span>), <span class="hljs-number">4</span>))
          ).to.eql(
            [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]
          );
          <span class="hljs-comment">/* #@range_end(stream_filter_test) */</span>
          next();
        });
      });
    }); 
  }); <span class="hljs-comment">// 関数の適用</span>
}); <span class="hljs-comment">// 関数の基本</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h2 id="6-2-section-id-function-and-referential-transparency-section-">6.2 <section id='function-and-referential-transparency'>関数と参照透過性</section></h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'関数と参照透過性'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3 id="-section-id-purity-of-function-section-"><section id='purity-of-function'>関数の純粋性</section></h3>
<p><strong>リスト6.25</strong> succ関数は参照透過性を持つ</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  it(<span class="hljs-string">'succ関数は参照透過性を持つ'</span>, (next) =&gt; {
    <span class="hljs-keyword">var</span> succ = (n) =&gt; {
      <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>;
    };
    <span class="hljs-comment">/* #@range_begin(succ_has_referential_transparency) */</span>
    expect(
      succ(<span class="hljs-number">1</span>)
    ).to.eql(
      succ(<span class="hljs-number">1</span>)
    );
    <span class="hljs-comment">/* #@range_end(succ_has_referential_transparency) */</span>
    next();
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><strong>リスト6.26</strong> ファイル操作は参照透過性を破壊する</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  it(<span class="hljs-string">'ファイル操作は参照透過性を破壊する'</span>, (next) =&gt; {
    <span class="hljs-comment">/* #@range_begin(fileio_destroys_referential_transparency) */</span>
    <span class="hljs-comment">/* fsモジュールを変数fsにバインドする */</span>
    <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
    <span class="hljs-comment">/* テストの実行前にあらかじめ "This is a test."
       という文字列をファイルに書き込んでおく */</span>
    fs.writeFileSync(<span class="hljs-string">'test/resources/file.txt'</span>, <span class="hljs-string">"This is a test."</span>);

    <span class="hljs-comment">/* 第1回目のファイルの読み込み */</span>
    <span class="hljs-keyword">var</span> text = fs.readFileSync(<span class="hljs-string">"test/resources/file.txt"</span>,<span class="hljs-string">'utf8'</span>);
    expect(
      fs.readFileSync(<span class="hljs-string">"test/resources/file.txt"</span>, <span class="hljs-string">'utf8'</span>)
    ).to.eql(
      <span class="hljs-string">"This is a test."</span>
    );
    <span class="hljs-comment">/* 途中でのファイルへの書き込み */</span>
    fs.writeFileSync(<span class="hljs-string">'test/resources/file.txt'</span>,
                     <span class="hljs-string">"This is another test."</span>);

    <span class="hljs-comment">/* 第2回目のファイルの読み込み */</span>
    expect(
      fs.readFileSync(<span class="hljs-string">"test/resources/file.txt"</span>, <span class="hljs-string">'utf8'</span>)
    ).to.eql(<span class="hljs-comment">/* 最初の readFileSync関数の結果と異なっている */</span>
      <span class="hljs-string">"This is another test."</span>
    );
    <span class="hljs-comment">/* #@range_end(fileio_destroys_referential_transparency) */</span>
    next();
  });
  it(<span class="hljs-string">'画面出力が参照透過性を損なうこと'</span>, (next) =&gt; {
    <span class="hljs-comment">/* #@range_begin(log_destroys_referential_transparency) */</span>
    expect(
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"this is a test"</span>)
    ).to.eql(
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"this is anoter test"</span>)
    );
    <span class="hljs-comment">/* #@range_end(log_destroys_referential_transparency) */</span>
    next();
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h3 id="-section-id-coping-sideeffect-section-"><section id='coping-sideeffect'>副作用への対処</section></h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'副作用への対処'</span>, () =&gt; {
    describe(<span class="hljs-string">'tap関数'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><strong>リスト6.27</strong> tap関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-comment">/* #@range_begin(tap_combinator) */</span>
      <span class="hljs-keyword">var</span> tap = (target,sideEffect) =&gt; {
        sideEffect(target); <span class="hljs-comment">// 副作用を実行する</span>
        <span class="hljs-keyword">return</span> target;
      };
      <span class="hljs-comment">/* #@range_end(tap_combinator) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><strong>リスト6.28</strong> tap関数によるconsole.logのテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      it(<span class="hljs-string">'tap関数によるconsole.logのテスト'</span>, (next) =&gt; {
        <span class="hljs-keyword">var</span> succ = (n) =&gt; {
          <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>;
        };
        <span class="hljs-comment">/* #@range_begin(tap_combinator_test_in_console) */</span>
        <span class="hljs-comment">/* 画面出力という副作用を実行する関数 */</span>
        <span class="hljs-keyword">var</span> consoleSideEffect = (any) =&gt; {
          <span class="hljs-built_in">console</span>.log(any);
        };
        expect(
          tap(succ(<span class="hljs-number">1</span>), consoleSideEffect)
        ).to.eql(
          tap(succ(<span class="hljs-number">1</span>), consoleSideEffect)
        );
        <span class="hljs-comment">/* #@range_end(tap_combinator_test_in_console) */</span>
        next();
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p><strong>リスト6.29</strong> tap関数によるファイル入出力のテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      it(<span class="hljs-string">'tap関数によるファイル入出力のテスト'</span>, (next) =&gt; {
        <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>); <span class="hljs-comment">// fsモジュールを変数fsにバインドする</span>
        <span class="hljs-comment">/* #@range_begin(tap_combinator_test_in_fileio) */</span>
        <span class="hljs-comment">/* あらかじめ文字列をファイルに書き込んでおく */</span>
        fs.writeFileSync(<span class="hljs-string">'test/resources/file.txt'</span>, <span class="hljs-string">"This is a test."</span>);

        <span class="hljs-comment">/* ファイルからの読み込みという副作用を実行する */</span>
        <span class="hljs-keyword">var</span> IOSideEffect = (_) =&gt; {
          <span class="hljs-keyword">var</span> content = fs.readFileSync(<span class="hljs-string">"test/resources/file.txt"</span>,
                                        <span class="hljs-string">'utf8'</span>);
          fs.writeFileSync(<span class="hljs-string">'test/resources/file.txt'</span>,
                           <span class="hljs-string">"This is another test."</span>);
          <span class="hljs-keyword">return</span> content;
        };

        expect(
          tap(fs.readFileSync(<span class="hljs-string">"test/resources/file.txt"</span>, <span class="hljs-string">'utf8'</span>),
              IOSideEffect)
        ).not.to.eql( <span class="hljs-comment">// 同じ引数に適用しているのに両者は等しくない</span>
          tap(fs.readFileSync(<span class="hljs-string">"test/resources/file.txt"</span>, <span class="hljs-string">'utf8'</span>),
              IOSideEffect)
        );
        <span class="hljs-comment">/* #@range_end(tap_combinator_test_in_fileio) */</span>
        next();
      });
    });
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><a href="index.html">目次に戻る</a> <a href="chap07.spec.html">次章に移る</a> </p>

            </div>
            
        </li>
        
    </ul>
  <!-- <div id="footer">  目次に戻る。 </div> -->
  <!-- </div> -->
</body>
</html>
