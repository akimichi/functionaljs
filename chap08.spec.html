<!DOCTYPE html>

<html>
<head>
  <title>chap08.spec.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
  <script type="text/javascript" async
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <!-- <script type="text/x-mathjax-config"> -->
  <!--   MathJax.Hub.Config({ -->
  <!--   tex2jax: { -->
  <!--       inlineMath: [ ['$','$'], ['\\(','\\)'] ], -->
  <!--       displayMath: [ ['$$','$$'], ["\\[","\\]"] ], -->
  <!--       processEscapes: true -->
  <!--   } -->
  <!--   }); -->
  <!-- </script> -->
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>chap08.spec.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="-8-">第8章 関数型言語を作る</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="-">小目次</h2>
<div class="toc">
<ul class="toc">
  <li><a href="http://akimichi.github.io/functionaljs/chap08.spec.html#abstract-syntax-tree">8.2 抽象構文木を作る</a></li>
  <li><a href="http://akimichi.github.io/functionaljs/chap08.spec.html#environment">8.3 環境を作る</a></li>
  <li><a href="http://akimichi.github.io/functionaljs/chap08.spec.html#evaluator">8.4 評価器を作る</a>
     <ul>
       <li><a href="http://akimichi.github.io/functionaljs/chap08.spec.html#identity-monad-evaluator">恒等モナドによる評価器</a></li>
       <li><a href="http://akimichi.github.io/functionaljs/chap08.spec.html#logger-monad-evaluator">ログ出力評価器</a></li></ul>
  </li>
</ul>
</div>

            </div>
            
            <div class="content"><div class='highlight'><pre>

<span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'expect.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>以下のコードで利用されるpairモジュールとlistモジュールをあらかじめ定義しておく</p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><strong>pairモジュール</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> pair = {
  match : (data, pattern) =&gt; {
    <span class="hljs-keyword">return</span> data.call(pair, pattern);
  },
  cons: (left, right) =&gt; {
    <span class="hljs-keyword">return</span> (pattern) =&gt; {
      <span class="hljs-keyword">return</span> pattern.cons(left, right);
    };
  },
  right: (tuple) =&gt; {
    <span class="hljs-keyword">return</span> pair.match(tuple, {
      cons: (left, right) =&gt; {
        <span class="hljs-keyword">return</span> right;
      }
    });
  },
  left: (tuple) =&gt; {
    <span class="hljs-keyword">return</span> pair.match(tuple, {
      cons: (left, right) =&gt; {
        <span class="hljs-keyword">return</span> left;
      }
    });
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong>listモジュール</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> list  = {
  match : (data, pattern) =&gt; {
    <span class="hljs-keyword">return</span> data.call(list, pattern);
  },
  empty: (_) =&gt; {
    <span class="hljs-keyword">return</span> (pattern) =&gt; {
      <span class="hljs-keyword">return</span> pattern.empty();
    };
  },
  cons: (head, tail) =&gt; {
    <span class="hljs-keyword">return</span> (pattern) =&gt; {
      <span class="hljs-keyword">return</span> pattern.cons(head, tail);
    };
  },
  head: (alist) =&gt; {
    <span class="hljs-keyword">return</span> list.match(alist, {
      empty: (_) =&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
      },
      cons: (head, tail) =&gt; {
        <span class="hljs-keyword">return</span> head;
      }
    });
  },
  tail: (alist) =&gt; {
    <span class="hljs-keyword">return</span> list.match(alist, {
      empty: (_) =&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
      },
      cons: (head, tail) =&gt; {
        <span class="hljs-keyword">return</span> tail;
      }
    });
  },
  <span class="hljs-comment">/* append:: LIST[T] -&gt; LIST[T] -&gt; LIST[T] */</span>
  append: (xs) =&gt; {
    <span class="hljs-keyword">return</span> (ys) =&gt; {
      <span class="hljs-keyword">return</span> list.match(xs, {
        empty: (_) =&gt; {
          <span class="hljs-keyword">return</span> ys;
        },
        cons: (head, tail) =&gt; {
          <span class="hljs-keyword">return</span> list.cons(head, list.append(tail)(ys)); 
        }
      });
    };
  },
  <span class="hljs-comment">/* foldr:: LIST[T] -&gt; T -&gt; FUN[T -&gt; LIST] -&gt; T */</span>
  foldr: (alist) =&gt; {
    <span class="hljs-keyword">return</span> (accumulator) =&gt; {
      <span class="hljs-keyword">return</span> (glue) =&gt; {
        expect(glue).to.a(<span class="hljs-string">'function'</span>);
        <span class="hljs-keyword">return</span> list.match(alist,{
          empty: (_) =&gt; {
            <span class="hljs-keyword">return</span> accumulator;
          },
          cons: (head, tail) =&gt; {
            <span class="hljs-keyword">return</span> glue(head)(list.foldr(tail)(accumulator)(glue));
          }
        });
      };
    };
  },
  toArray: (alist) =&gt; {
    <span class="hljs-keyword">return</span> list.foldr(alist)([])((item) =&gt; {
      <span class="hljs-keyword">return</span> (accumulator) =&gt; {
        <span class="hljs-keyword">return</span> [item].concat(accumulator); 
      };
    });
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="8-2-section-id-abstract-syntax-tree-section-">8.2 <section id='abstract-syntax-tree'>抽象構文木を作る</section></h2>
<blockquote>
<p>参考資料: <a href="https://ja.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E6%A7%8B%E6%96%87%E6%9C%A8">Wikipediaの記事</a></p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'抽象構文木を作る'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>リスト8.2</strong> 式の代数的データ構造</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'式の代数的データ構造'</span>, () =&gt; {
    <span class="hljs-keyword">var</span> exp = {
      <span class="hljs-comment">/* #@range_begin(expression_algebraic_datatype) */</span>
      <span class="hljs-comment">/* 式のパターンマッチ関数 */</span>
      match : (data, pattern) =&gt; { 
        <span class="hljs-keyword">return</span> data(pattern);
      },
      <span class="hljs-comment">/* 数値の式 */</span>
      num: (value) =&gt; {             
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.num(value);
        };
      },
      <span class="hljs-comment">/* 変数の式 */</span>
      variable : (name) =&gt; {        
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.variable(name);
        };
      },
      <span class="hljs-comment">/* 関数定義の式(λ式) */</span>
      lambda: (variable, body) =&gt; { 
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.lambda(variable, body);
        };
      },
      <span class="hljs-comment">/* 関数適用の式 */</span>
      app: (lambda, arg) =&gt; {       
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.app(lambda, arg);
        };
      },
      <span class="hljs-comment">/* #@range_end(expression_algebraic_datatype) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>リスト8.3</strong> 演算の定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-comment">/* #@range_begin(expression_arithmetic) */</span>
      <span class="hljs-comment">/* 足し算の式 */</span>
      add : (expL,expR) =&gt; {        
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.add(expL, expR);
        };
      }
      <span class="hljs-comment">/* #@range_end(expression_arithmetic) */</span>
    };
    describe(<span class="hljs-string">'式をテストする'</span>, () =&gt; {
      it(<span class="hljs-string">"\\x.\\y.x"</span>, (next) =&gt; {
        <span class="hljs-comment">/* λx.λy.x */</span>
        exp.match(exp.lambda(exp.variable(<span class="hljs-string">"x"</span>),exp.lambda(exp.variable(<span class="hljs-string">"y"</span>),exp.variable(<span class="hljs-string">"x"</span>))),{
          lambda: (variable, arg) =&gt; {
            expect(
              variable
            ).to.a(<span class="hljs-string">'function'</span>);
          }
        });
        next();
      });
    });
  });

});</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="8-3-section-id-environment-section-">8.3 <section id='environment'>環境を作る</section></h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'環境を作る'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>リスト8.5</strong> クロージャーによる「環境」の定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-comment">/* #@range_begin(environment) */</span>
  <span class="hljs-keyword">var</span> env = {
    <span class="hljs-comment">/* 空の環境を作る */</span>
    <span class="hljs-comment">/* empty:: STRING =&gt; VALUE */</span>
    empty: (variable) =&gt; {                        
      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    },
    <span class="hljs-comment">/* 変数名に対応する値を環境から取り出す */</span>
    <span class="hljs-comment">/* lookup:: (STRING, ENV) =&gt; VALUE */</span>
    lookup : (name, environment) =&gt; {       
      <span class="hljs-keyword">return</span> environment(name);
    },
    <span class="hljs-comment">/* 環境を拡張する */</span>
    <span class="hljs-comment">/* extend:: (STRING, VALUE, ENV) =&gt; ENV */</span>
    extend: (identifier, value, environment) =&gt; { 
      <span class="hljs-keyword">return</span> (queryIdentifier) =&gt; {
        <span class="hljs-keyword">if</span>(identifier === queryIdentifier) {
          <span class="hljs-keyword">return</span> value;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> env.lookup(queryIdentifier,environment);
        }
      };
    }
  };
  <span class="hljs-comment">/* #@range_end(environment) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>リスト8.7</strong> 変数バインディングにおける環境のセマンティクス</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;
a;
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  it(<span class="hljs-string">'変数バインディングにおける環境のセマンティクス'</span>, (next) =&gt; {
    <span class="hljs-comment">/* #@range_begin(environment_code_test) */</span>
    expect(((_) =&gt; {
      <span class="hljs-comment">/* 空の環境からnewEnv環境を作る */</span>
      <span class="hljs-keyword">var</span> newEnv = env.extend(<span class="hljs-string">"a"</span>, <span class="hljs-number">1</span>, env.empty); 
      <span class="hljs-comment">/* newEnv環境を利用して a の値を求める */</span>
      <span class="hljs-keyword">return</span> env.lookup(<span class="hljs-string">"a"</span>, newEnv);            
    })()).to.eql(
      <span class="hljs-number">1</span>
    );
    <span class="hljs-comment">/* #@range_end(environment_code_test) */</span>
    expect(((_) =&gt; {
      <span class="hljs-keyword">var</span> initEnv = env.empty;                      <span class="hljs-comment">// 空の辞書を作成する</span>
      <span class="hljs-comment">/* var a = 1 を実行して、辞書を拡張する */</span>  
      <span class="hljs-keyword">var</span> firstEnv = env.extend(<span class="hljs-string">"a"</span>, <span class="hljs-number">1</span>, initEnv);
      <span class="hljs-comment">/* var b = 3 を実行して、辞書を拡張する */</span>
      <span class="hljs-keyword">var</span> secondEnv = env.extend(<span class="hljs-string">"b"</span>,<span class="hljs-number">3</span>, firstEnv);
      <span class="hljs-comment">/* 辞書から b の値を参照する */</span>
      <span class="hljs-keyword">return</span> env.lookup(<span class="hljs-string">"b"</span>,secondEnv);
    })()).to.eql(
      <span class="hljs-number">3</span>
    );</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <pre><code class="lang-js"><span class="hljs-keyword">var</span> x = <span class="hljs-number">1</span>;
<span class="hljs-keyword">var</span> y = <span class="hljs-number">2</span>;
<span class="hljs-keyword">var</span> closure = () =&gt; {
  <span class="hljs-keyword">var</span> z = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">return</span> x + y + z;
};
closure()
</code></pre>
<p><strong>リスト8.9</strong> クロージャーにおける環境のセマンティクス</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* #@range_begin(environment_extend_test) */</span>
    expect(((_) =&gt; {
      <span class="hljs-comment">/* 空の辞書を作成する */</span>
      <span class="hljs-keyword">var</span> initEnv = env.empty;                   
      <span class="hljs-comment">/* 空の辞書から outerEnv環境を作る */</span>
      <span class="hljs-keyword">var</span> outerEnv = env.extend(<span class="hljs-string">"x"</span>, <span class="hljs-number">1</span>, initEnv);    

      <span class="hljs-comment">/* closureEnv環境を作る */</span>
      <span class="hljs-keyword">var</span> closureEnv = env.extend(<span class="hljs-string">"y"</span>, <span class="hljs-number">2</span>, outerEnv);  
      <span class="hljs-comment">/* closureEnv環境を利用してx+yを計算する */</span>
      <span class="hljs-keyword">return</span> env.lookup(<span class="hljs-string">"x"</span>,closureEnv) + env.lookup(<span class="hljs-string">"y"</span>,closureEnv);
    })()).to.eql(
      <span class="hljs-number">3</span>
    );
    <span class="hljs-comment">/* #@range_end(environment_extend_test) */</span>
    next();
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="8-4-section-id-evaluator-section-">8.4 <section id='evaluator'>評価器を作る</section></h2>
<blockquote>
<p>参考資料: <a href="https://www.google.co.jp/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwiw25uwks7PAhVBF5QKHQjDBfEQFggcMAA&amp;url=http%3A%2F%2Fwww.eliza.ch%2Fdoc%2Fwadler92essence_of_FP.pdf&amp;usg=AFQjCNFX6YZ2kqhIuqGGysZCyMQwaWAAfQ&amp;sig2=0GWjNVeqVkXjUCr6B20DLA&amp;bvm=bv.135258522,d.dGo">The Essence of Functional Programming</a></p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'評価器を作る'</span>, () =&gt; {
  <span class="hljs-comment">/* 「環境」モジュール */</span>
  <span class="hljs-keyword">var</span> env = {
    empty: (variable) =&gt; {                        
      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    },
    lookup : (name, environment) =&gt; {       
      <span class="hljs-keyword">return</span> environment(name);
    },
    extend: (identifier, value, environment) =&gt; { 
      <span class="hljs-keyword">return</span> (queryIdentifier) =&gt; {
        <span class="hljs-keyword">if</span>(identifier === queryIdentifier) {
          <span class="hljs-keyword">return</span> value;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> env.lookup(queryIdentifier,environment);
        }
      };
    }
  };
  <span class="hljs-keyword">var</span> emptyEnv = env.empty;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h3 id="-section-id-identity-monad-evaluator-section-"><section id='identity-monad-evaluator'>恒等モナドによる評価器</section></h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'恒等モナドによる評価器'</span>, () =&gt; {
    <span class="hljs-keyword">var</span> exp = {
      match : (data, pattern) =&gt; { <span class="hljs-comment">// 式のパターンマッチ関数</span>
        <span class="hljs-keyword">return</span> data(pattern);
      },
      num: (value) =&gt; {             <span class="hljs-comment">// 数値の式</span>
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.num(value);
        };
      },
      variable : (name) =&gt; {        <span class="hljs-comment">// 変数の式</span>
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.variable(name);
        };
      },
      lambda: (variable, body) =&gt; { <span class="hljs-comment">// 関数定義の式(λ式)</span>
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.lambda(variable, body);
        };
      },
      app: (lambda, arg) =&gt; {       <span class="hljs-comment">// 関数適用の式</span>
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.app(lambda, arg);
        };
      },
      add : (expL,expR) =&gt; {        <span class="hljs-comment">// 足し算の式</span>
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.add(expL, expR);
        };
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h3 id="-">恒等モナド</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* #@range_begin(identity_monad) */</span>
    <span class="hljs-keyword">var</span> ID = {
      unit: (value) =&gt; {
        <span class="hljs-keyword">return</span> value;
      },
      flatMap: (instance) =&gt; {
        <span class="hljs-keyword">return</span> (transform) =&gt; {
          expect(transform).to.a(<span class="hljs-string">'function'</span>);
          <span class="hljs-keyword">return</span> transform(instance);
        };
      }
    };
    <span class="hljs-comment">/* #@range_end(identity_monad) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>リスト8.10</strong> 恒等モナド評価器の定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* #@range_begin(identity_monad_evaluator) */</span>
    <span class="hljs-comment">/* evaluate:: (EXP, ENV) =&gt; ID[VALUE] */</span>
    <span class="hljs-keyword">var</span> evaluate = (anExp, environment) =&gt; {
      <span class="hljs-keyword">return</span> exp.match(anExp,{</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong>リスト8.11</strong> 数値の評価</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        num: (numericValue) =&gt; {        
          <span class="hljs-keyword">return</span> ID.unit(numericValue);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>リスト8.13</strong> 変数の評価</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        variable: (name) =&gt; {           
          <span class="hljs-keyword">return</span> ID.unit(env.lookup(name, environment));
        },
        <span class="hljs-comment">/* 関数定義（λ式）の評価  */</span>
        lambda: (variable, body) =&gt; {   
          <span class="hljs-keyword">return</span> exp.match(variable,{
            variable: (name) =&gt; {
              <span class="hljs-keyword">return</span> ID.unit((actualArg) =&gt; {
                <span class="hljs-keyword">return</span> evaluate(body, 
                                env.extend(name, actualArg, environment));
              });
            }
          });
        },
        <span class="hljs-comment">/* 関数適用の評価 */</span>
        app: (lambda, arg) =&gt; {         
          <span class="hljs-keyword">return</span> ID.flatMap(evaluate(lambda, environment))((closure) =&gt; {
            <span class="hljs-keyword">return</span> ID.flatMap(evaluate(arg, environment))((actualArg) =&gt; {
              <span class="hljs-keyword">return</span> closure(actualArg); 
            });
          });
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><strong>リスト8.15</strong>  足し算の評価 </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        add: (expL, expR) =&gt; {          
          <span class="hljs-keyword">return</span> ID.flatMap(evaluate(expL, environment))((valueL) =&gt; {
            <span class="hljs-keyword">return</span> ID.flatMap(evaluate(expR, environment))((valueR) =&gt; {
              <span class="hljs-keyword">return</span> ID.unit(valueL + valueR); 
            });
          });
        }
      });
    };
    <span class="hljs-comment">/* #@range_end(identity_monad_evaluator) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><strong>リスト8.12</strong> 数値の評価のテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'数値の評価のテスト'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(number_evaluation_test) */</span>
      expect(
        evaluate(exp.num(<span class="hljs-number">2</span>), env.empty)
      ).to.eql(
        ID.unit(<span class="hljs-number">2</span>)
      );
      <span class="hljs-comment">/* #@range_end(number_evaluation_test) */</span>
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><strong>リスト8.14</strong> 変数の評価のテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'変数の評価のテスト'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(variable_evaluation_test) */</span>
      <span class="hljs-comment">/* 変数xを1に対応させた環境を作る */</span>
      <span class="hljs-keyword">var</span> newEnv = env.extend(<span class="hljs-string">"x"</span>, <span class="hljs-number">1</span>, env.empty); 
      <span class="hljs-comment">/* 拡張したnewEnv環境を用いて変数xを評価する */</span>
      expect(
        evaluate(exp.variable(<span class="hljs-string">"x"</span>), newEnv)
      ).to.eql(
        ID.unit(<span class="hljs-number">1</span>)
      );
      <span class="hljs-comment">/* #@range_end(variable_evaluation_test) */</span>
      expect(
        evaluate(exp.variable(<span class="hljs-string">"y"</span>), newEnv)
      ).to.be(
        ID.unit(<span class="hljs-literal">undefined</span>)
      );
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><strong>リスト8.16</strong> 足し算の評価のテスト</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'足し算の評価のテスト'</span>, (next) =&gt; {
      <span class="hljs-comment">/* add(1,2) */</span>
      <span class="hljs-comment">/* #@range_begin(add_evaluation_test) */</span>
      <span class="hljs-keyword">var</span> addition = exp.add(exp.num(<span class="hljs-number">1</span>),exp.num(<span class="hljs-number">2</span>));
      expect(
        evaluate(addition, env.empty)
      ).to.eql(
        ID.unit(<span class="hljs-number">3</span>)
      );
      <span class="hljs-comment">/* #@range_end(add_evaluation_test) */</span>
      next();
    });
    it(<span class="hljs-string">'恒等モナド評価器で演算を評価する'</span>, (next) =&gt; {
      expect(
        evaluate(exp.add(exp.num(<span class="hljs-number">1</span>),exp.num(<span class="hljs-number">2</span>)), emptyEnv)
      ).to.be(
        ID.unit(<span class="hljs-number">3</span>)
      );
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="-">関数の評価</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'ID評価器で関数を評価する'</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <pre><code class="lang-js">((x) =&gt; {
  <span class="hljs-keyword">return</span> x; 
})(<span class="hljs-number">1</span>)
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> expression = exp.lambda(exp.variable(<span class="hljs-string">"x"</span>),
                                  exp.variable(<span class="hljs-string">"x"</span>));
      expect(
        evaluate(expression, emptyEnv)(<span class="hljs-number">1</span>)
      ).to.be(
        <span class="hljs-number">1</span>
      );
      next();
    });
    it(<span class="hljs-string">'関数適用の評価のテスト'</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><strong>リスト8.17</strong> 関数適用の評価のテスト</p>
<pre><code class="lang-js">((n) =&gt; {
  <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>; 
})(<span class="hljs-number">2</span>)
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-comment">/* #@range_begin(application_evaluation_test) */</span>
      <span class="hljs-keyword">var</span> expression = exp.app(         <span class="hljs-comment">/* 関数適用 */</span>
        exp.lambda(exp.variable(<span class="hljs-string">"n"</span>),   <span class="hljs-comment">/* λ式 */</span>
                   exp.add(exp.variable(<span class="hljs-string">"n"</span>),
                           exp.num(<span class="hljs-number">1</span>))),
        exp.num(<span class="hljs-number">2</span>));                    <span class="hljs-comment">/* 引数の数値2 */</span>
      expect(
        evaluate(expression, env.empty)
      ).to.eql(
        ID.unit(<span class="hljs-number">3</span>)
      );
      <span class="hljs-comment">/* #@range_end(application_evaluation_test) */</span>
      next();
    });
    it(<span class="hljs-string">'ID評価器で関数適用 \\x.add(x,x)(2)を評価する'</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <pre><code class="lang-js">((x) =&gt; {
  <span class="hljs-keyword">return</span> x + x; 
})(<span class="hljs-number">2</span>)
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> expression = exp.app(exp.lambda(exp.variable(<span class="hljs-string">"x"</span>),
                                          exp.add(exp.variable(<span class="hljs-string">"x"</span>),exp.variable(<span class="hljs-string">"x"</span>))),
                               exp.num(<span class="hljs-number">2</span>));
      expect(
        evaluate(expression, env.empty)
      ).to.eql(
        <span class="hljs-number">4</span>
      );
      next();
    });
    it(<span class="hljs-string">'カリー化関数の評価'</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><strong>リスト8.19</strong>カリー化関数の評価</p>
<pre><code class="lang-js">((n) =&gt; {
   <span class="hljs-keyword">return</span> (m) =&gt; {
      <span class="hljs-keyword">return</span> n + m;
   };
})(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-comment">/* #@range_begin(curried_function_evaluation_test) */</span>
      <span class="hljs-keyword">var</span> expression = exp.app(
        exp.app(
          exp.lambda(exp.variable(<span class="hljs-string">"n"</span>),
                     exp.lambda(exp.variable(<span class="hljs-string">"m"</span>),
                                exp.add(
                                  exp.variable(<span class="hljs-string">"n"</span>),exp.variable(<span class="hljs-string">"m"</span>)))),
          exp.num(<span class="hljs-number">2</span>)),
        exp.num(<span class="hljs-number">3</span>));
      expect(
        evaluate(expression, env.empty)
      ).to.eql(
        ID.unit(<span class="hljs-number">5</span>)
      );
      <span class="hljs-comment">/* #@range_end(curried_function_evaluation_test) */</span>
      next();
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h3 id="-section-id-logger-monad-evaluator-section-"><section id='logger-monad-evaluator'>ログ出力評価器</section></h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'ログ出力評価器'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><strong>リスト8.20</strong> ログ出力評価器の式</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* #@range_begin(expression_logger_interpreter) */</span>
    <span class="hljs-keyword">var</span> exp = {
      log: (anExp) =&gt; { <span class="hljs-comment">// ログ出力用の式</span>
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.log(anExp);
        };
      },
      <span class="hljs-comment">/* #@range_end(expression_logger_interpreter) */</span>
      match : (data, pattern) =&gt; {
        <span class="hljs-keyword">return</span> data.call(exp, pattern);
      },
      num : (value) =&gt; {
        expect(value).to.a(<span class="hljs-string">'number'</span>);
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.num(value);
        };
      },
      variable : (name) =&gt; {
        expect(name).to.a(<span class="hljs-string">'string'</span>);
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.variable(name);
        };
      },
      lambda : (variable, body) =&gt; {
        expect(variable).to.a(<span class="hljs-string">'function'</span>);
        expect(body).to.a(<span class="hljs-string">'function'</span>);
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.lambda(variable, body);
        };
      },
      app : (variable, arg) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.app(variable, arg);
        };
      },
      add : (exp1,exp2) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.add(exp1, exp2);
        };
      },
      mul : (exp1,exp2) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.mul(exp1, exp2);
        };
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><strong>リスト8.21</strong> LOGモナドの定義</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* #@range_begin(logger_monad) */</span>
    <span class="hljs-comment">/* LOG[T] = PAIR[T, LIST[STRING]] */</span>
    <span class="hljs-keyword">var</span> LOG = {
      <span class="hljs-comment">/* unit:: VALUE =&gt; LOG[VALUE] */</span>
      unit: (value) =&gt; {
        <span class="hljs-comment">/* 値とログのPair型を作る */</span>
        <span class="hljs-keyword">return</span> pair.cons(value, list.empty()); 
      },
      <span class="hljs-comment">/* flatMap:: LOG[T] =&gt; FUN[T =&gt; LOG[T]] =&gt; LOG[T] */</span>
      flatMap: (instanceM) =&gt; {
        <span class="hljs-keyword">return</span> (transform) =&gt; {
          <span class="hljs-keyword">return</span> pair.match(instanceM,{
            <span class="hljs-comment">/* Pair型に格納されている値の対を取り出す */</span>
            cons: (value, log) =&gt; {
              <span class="hljs-comment">/* 取り出した値で計算する */</span>
              <span class="hljs-keyword">var</span> newInstance = transform(value); 
              <span class="hljs-comment">/* 計算の結果をPairの左側に格納し、
                 新しいログをPairの右側に格納する */</span>
              <span class="hljs-keyword">return</span> pair.cons(pair.left(newInstance),
                               list.append(log)(pair.right(newInstance)));
            }
          });
        };
      },
      <span class="hljs-comment">/* 引数 value をログに格納する */</span>
      <span class="hljs-comment">/* output:: VALUE =&gt; LOG[()] */</span>
      output: (value) =&gt; {
        <span class="hljs-keyword">return</span> pair.cons(<span class="hljs-literal">null</span>, 
                         list.cons(<span class="hljs-built_in">String</span>(value), list.empty()));
      }
    };
    <span class="hljs-comment">/* #@range_end(logger_monad) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><strong>リスト8.22</strong> LOGモナド評価器</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* #@range_begin(logger_monad_evaluator) */</span>
    <span class="hljs-comment">/* evaluate:: (EXP, ENV) =&gt; LOG[VALUE] */</span>
    <span class="hljs-keyword">var</span> evaluate = (anExp, environment) =&gt; {
      <span class="hljs-keyword">return</span> exp.match(anExp,{
        <span class="hljs-comment">/* log式の評価 */</span>
        log: (anExp) =&gt; {
          <span class="hljs-comment">/* 式を評価する */</span>
          <span class="hljs-keyword">return</span> LOG.flatMap(evaluate(anExp, environment))((value) =&gt; {
            <span class="hljs-comment">/* value をログに格納する */</span>
            <span class="hljs-keyword">return</span> LOG.flatMap(LOG.output(value))((_) =&gt; { 
              <span class="hljs-keyword">return</span> LOG.unit(value); 
            });
          });
        },
        <span class="hljs-comment">/* #@range_end(logger_monad_evaluator) */</span>
        <span class="hljs-comment">/* 数値の評価 */</span>
        num: (value) =&gt; {
          <span class="hljs-keyword">return</span> LOG.unit(value);
        },
        <span class="hljs-comment">/* 変数の評価 */</span>
        variable: (name) =&gt; {
          <span class="hljs-keyword">return</span> LOG.unit(env.lookup(name, environment));
        },
        <span class="hljs-comment">/* λ式の評価 */</span>
        lambda: (variable, body) =&gt; {
          <span class="hljs-keyword">return</span> exp.match(variable,{
            variable: (name) =&gt; {
              <span class="hljs-keyword">return</span> LOG.unit((actualArg) =&gt; {
                <span class="hljs-keyword">return</span> evaluate(body, env.extend(name, actualArg, environment));
              });
            }
          });
        },
        <span class="hljs-comment">/* 関数適用の評価 */</span>
        app: (lambda, arg) =&gt; {         <span class="hljs-comment">// 関数適用の評価</span>
          <span class="hljs-keyword">return</span> LOG.flatMap(evaluate(lambda, environment))((closure) =&gt; {
            <span class="hljs-keyword">return</span> LOG.flatMap(evaluate(arg, environment))((actualArg) =&gt; {
              <span class="hljs-keyword">return</span> closure(actualArg); 
            });
          });
        },
        add: (expL, expR) =&gt; {
          <span class="hljs-keyword">return</span> LOG.flatMap(evaluate(expL, environment))((valueL) =&gt; {
            <span class="hljs-keyword">return</span> LOG.flatMap(evaluate(expR, environment))((valueR) =&gt; {
              <span class="hljs-keyword">return</span> LOG.unit(valueL + valueR); 
            });
          });
        }
      });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h3 id="-">ログ出力評価器のテスト</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'ログ出力評価器のテスト'</span>, () =&gt; {
      it(<span class="hljs-string">'LOG評価器で数値を評価する'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(log_interpreter_number) */</span>
        pair.match(evaluate(exp.log(exp.num(<span class="hljs-number">2</span>)), env.empty),{
          cons: (value, log) =&gt; {
            expect( <span class="hljs-comment">// 結果の値をテストする</span>
              value
            ).to.be(
              <span class="hljs-number">2</span>
            );
            expect( <span class="hljs-comment">// 保存されたログを見る</span>
              list.toArray(log)
            ).to.eql(
              [<span class="hljs-number">2</span>]
            );
          }
        });
        <span class="hljs-comment">/* #@range_end(log_interpreter_number) */</span>
        next();
      });
      it(<span class="hljs-string">'LOG評価器で変数を評価する'</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(log_interpreter_variable) */</span>
        <span class="hljs-keyword">var</span> newEnv = env.extend(<span class="hljs-string">"x"</span>, <span class="hljs-number">1</span>, env.empty);
        pair.match(evaluate(exp.log(exp.variable(<span class="hljs-string">"x"</span>)), newEnv), {
          cons: (value, log) =&gt; {
            expect( <span class="hljs-comment">// 結果の値をテストする</span>
              value
            ).to.eql(
              <span class="hljs-number">1</span>
            );
            expect( <span class="hljs-comment">// 保存されたログを見る</span>
              list.toArray(log)
            ).to.eql(
              [<span class="hljs-number">1</span>]
            );
          }
        });
        <span class="hljs-comment">/* #@range_end(log_interpreter_variable) */</span>
        next();
      });
      it(<span class="hljs-string">'LOG評価器で演算を評価する'</span>, (next) =&gt; {
        pair.match(evaluate(exp.log(exp.add(exp.num(<span class="hljs-number">1</span>),exp.num(<span class="hljs-number">2</span>))), env.empty),{
          cons: (value, log) =&gt; {
            expect(
              value
            ).to.be(
              <span class="hljs-number">3</span>
            );
            expect(
              list.toArray(log)
            ).to.eql(
              [<span class="hljs-number">3</span>]
            );
          }
        });
        pair.match(evaluate(exp.log(exp.add(exp.log(exp.num(<span class="hljs-number">1</span>)),exp.log(exp.num(<span class="hljs-number">2</span>)))), env.empty),{
          cons: (value, log) =&gt; {
            expect(
              value
            ).to.be(
              <span class="hljs-number">3</span> <span class="hljs-comment">// 1 + 2 = 3</span>
            );
            expect(
              list.toArray(log)
            ).to.eql(
              [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]
            );
          }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><strong>リスト8.25</strong> ログ出力評価器による評価戦略の確認</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/* #@range_begin(log_interpreter_evaluation_strategy) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <pre><code class="lang-js">((n) =&gt; {
   <span class="hljs-keyword">return</span> add(<span class="hljs-number">1</span>)(n)
})(<span class="hljs-number">2</span>);
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> theExp = exp.log(exp.app(exp.lambda(exp.variable(<span class="hljs-string">"n"</span>),
                                                exp.add(exp.log(exp.num(<span class="hljs-number">1</span>)), 
                                                        exp.variable(<span class="hljs-string">"n"</span>))),
                                     exp.log(exp.num(<span class="hljs-number">2</span>))));
        pair.match(evaluate(theExp, env.empty),{
          <span class="hljs-comment">/* パターンマッチで結果を取り出す */</span>
          cons: (value, log) =&gt; {
            expect(
              value
            ).to.eql(
              <span class="hljs-number">3</span>
            );
            expect(
              list.toArray(log)
            ).to.eql(
              [<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>]
            );
          }
        });
        <span class="hljs-comment">/* #@range_end(log_interpreter_evaluation_strategy) */</span>
        next();
      });
      it(<span class="hljs-string">'LOG評価器で関数適用を評価する'</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <pre><code class="lang-js">((x) =&gt; {
   <span class="hljs-keyword">return</span> add(x)(x)
})(<span class="hljs-number">2</span>);
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> expression = exp.app(exp.lambda(exp.variable(<span class="hljs-string">"x"</span>),
                                            exp.add(exp.variable(<span class="hljs-string">"x"</span>),exp.variable(<span class="hljs-string">"x"</span>))),
                                 exp.num(<span class="hljs-number">2</span>));
        expect(
          pair.left(evaluate(expression, env.empty))
        ).to.eql(
          <span class="hljs-number">4</span>
        );
        expect(
          list.toArray(pair.right(evaluate(expression, env.empty)))
        ).to.eql(
          []
        );
        next();
      });
      it(<span class="hljs-string">'LOG評価器でカリー化関数を評価する'</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <pre><code class="lang-js">((x) =&gt; {
  <span class="hljs-keyword">return</span> (y) =&gt; {
      <span class="hljs-keyword">return</span> add(x)(y)
  };
})(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>);
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> expression = exp.app(
          exp.app(exp.lambda(exp.variable(<span class="hljs-string">"x"</span>),
                             exp.lambda(exp.variable(<span class="hljs-string">"y"</span>),
                                        exp.add(exp.variable(<span class="hljs-string">"x"</span>),exp.variable(<span class="hljs-string">"y"</span>)))),
                  exp.num(<span class="hljs-number">2</span>)),
          exp.num(<span class="hljs-number">3</span>));
        expect(
          pair.left(evaluate(expression, emptyEnv))
        ).to.be(
          <span class="hljs-number">5</span>
        );
        next();
      });
    });
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><a href="index.html">目次に戻る</a> </p>

            </div>
            
        </li>
        
    </ul>
  <!-- <div id="footer">  目次に戻る。 </div> -->
  <!-- </div> -->
</body>
</html>
