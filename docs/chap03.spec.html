<!DOCTYPE html>

<html>
<head>
  <title>chap03.spec.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
  <script type="text/javascript" async
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <!-- <script type="text/x-mathjax-config"> -->
  <!--   MathJax.Hub.Config({ -->
  <!--   tex2jax: { -->
  <!--       inlineMath: [ ['$','$'], ['\\(','\\)'] ], -->
  <!--       displayMath: [ ['$$','$$'], ["\\[","\\]"] ], -->
  <!--       processEscapes: true -->
  <!--   } -->
  <!--   }); -->
  <!-- </script> -->
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>chap03.spec.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="-3-">第3章 心の準備</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="-">小目次</h2>
<div class="toc">
<ul class="toc">
  <li><a href="http://akimichi.github.io/functionaljs/chap03.spec.html#DRY-principle">3.1 DRY原則</a></li>
  <li><a href="http://akimichi.github.io/functionaljs/chap03.spec.html#abstraction-oriented">3.2 抽象化への指向</a></li>
  <li><a href="http://akimichi.github.io/functionaljs/chap03.spec.html#semantics-conscious">3.3 セマンティクスを意識する</a></li>
  <li><a href="http://akimichi.github.io/functionaljs/chap03.spec.html#test-driven">3.4 テストに親しむ</a></li>
</ul>
</div>

            </div>
            
            <div class="content"><div class='highlight'><pre>

<span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'expect.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="3-1-section-id-dry-principle-dry-section-">3.1 <section id='DRY-principle'>DRY原則</section></h2>
<blockquote>
<p>参考資料: <a href="https://www.infoq.com/jp/news/2012/05/DRY-code-duplication-coupling">DRY原則の利用: コードの重複と密結合の間</a></p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'DRY原則'</span>, () =&gt; {
  <span class="hljs-keyword">var</span> add = (x, y) =&gt; {
    <span class="hljs-keyword">return</span> x + y;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><strong>リスト3.1</strong> 冗長なコード</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  it(<span class="hljs-string">'冗長なコード'</span>, (next) =&gt; {
    <span class="hljs-comment">/* #@range_begin(redundant_code) */</span>
    <span class="hljs-keyword">var</span> timesForMultiply = (count, arg, memo) =&gt; {
      <span class="hljs-keyword">if</span>(count &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> timesForMultiply(count-<span class="hljs-number">1</span>, arg, arg + memo);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> arg + memo;
      }
    };
    <span class="hljs-keyword">var</span> multiply = (n, m) =&gt; {
      <span class="hljs-keyword">return</span> timesForMultiply(n, m, <span class="hljs-number">0</span>);
    };
    <span class="hljs-keyword">var</span> timesForExponential = (count, arg, memo) =&gt; {
      <span class="hljs-keyword">if</span>(count &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> timesForExponential(count-<span class="hljs-number">1</span>, arg, arg * memo);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> arg * memo;
      }
    };
    <span class="hljs-keyword">var</span> exponential = (n, m) =&gt; {
      <span class="hljs-keyword">return</span> timesForExponential(m, n, <span class="hljs-number">1</span>);
    };
    <span class="hljs-comment">/* #@range_end(redundant_code) */</span>
    expect(
      multiply(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    ).to.eql(
      <span class="hljs-number">6</span>
    );
    expect(
      exponential(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    ).to.eql(
      <span class="hljs-number">8</span>
    );
    next();
  });
  it(<span class="hljs-string">'DRYを適用する'</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong>リスト3.3</strong> DRYなtimes関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* #@range_begin(dry_times) */</span>
    <span class="hljs-keyword">var</span> times = (count, arg, memo, fun) =&gt; { <span class="hljs-comment">// 引数funを追加</span>
      <span class="hljs-keyword">if</span>(count &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> times(count-<span class="hljs-number">1</span>, arg, fun(arg,memo), fun);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> fun(arg,memo);
      }
    };
    <span class="hljs-comment">/* #@range_end(dry_times) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>リスト3.4</strong> DRYなかけ算とべき乗</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* #@range_begin(dry_functions) */</span>
    <span class="hljs-keyword">var</span> add = (n, m) =&gt; {
      <span class="hljs-keyword">return</span> n + m;
    };
    <span class="hljs-comment">/* times関数を利用してmultiply関数を定義する */</span>
    <span class="hljs-keyword">var</span> multiply = (n, m) =&gt; {
      <span class="hljs-keyword">return</span> times(m, n, <span class="hljs-number">0</span>, add);
    };
    <span class="hljs-comment">/* times関数を利用してexponential関数を定義する */</span>
    <span class="hljs-keyword">var</span> exponential = (n, m) =&gt; {
      <span class="hljs-keyword">return</span> times(m, n, <span class="hljs-number">1</span>, multiply);
    };
    <span class="hljs-comment">/* #@range_end(dry_functions) */</span>
    expect(
      multiply(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    ).to.eql(
      <span class="hljs-number">6</span>
    );
    expect(
      exponential(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    ).to.eql(
      <span class="hljs-number">8</span>
    );
    expect(
      multiply(-<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    ).to.eql(
        -<span class="hljs-number">6</span>
    );
    next();
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="3-2-section-id-abstraction-oriented-section-">3.2 <section id='abstraction-oriented'>抽象化への指向</section></h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'抽象化への指向'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>リスト3.5</strong> 関数という抽象化</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  it(<span class="hljs-string">'関数という抽象化'</span>, (next) =&gt; {
    <span class="hljs-comment">/* #@range_begin(function_abstraction_example) */</span>
    <span class="hljs-keyword">var</span> succ = (n) =&gt; {
      <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>;
    };
    <span class="hljs-comment">/* #@range_end(function_abstraction_example) */</span>
    next();
  });
  describe(<span class="hljs-string">'高階関数による抽象化'</span>, () =&gt; {
    <span class="hljs-keyword">var</span> anArray = [<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">7</span>,<span class="hljs-number">11</span>,<span class="hljs-number">13</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>リスト3.6</strong> for文によるsum関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'for文によるsum関数'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(sum_for) */</span>
      <span class="hljs-keyword">var</span> anArray = [<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">7</span>];
      <span class="hljs-keyword">var</span> sum = (array) =&gt; {
        <span class="hljs-keyword">var</span> result = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>; index &lt; array.length; index++){
          result = result + array[index];
        }
        <span class="hljs-keyword">return</span> result;
      };
      sum(anArray);
      <span class="hljs-comment">/* #@range_end(sum_for) */</span>
      expect(
        sum(anArray)
      ).to.eql(
        <span class="hljs-number">17</span>
      );
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>リスト3.7</strong> forEachによるsum関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'forEachによるsum関数'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(sum_forEach) */</span>
      <span class="hljs-keyword">var</span> sum = (array) =&gt; {
        <span class="hljs-comment">/* 結果を格納する変数result */</span>
        <span class="hljs-keyword">var</span> result = <span class="hljs-number">0</span>;
        array.forEach((item) =&gt; {
          result = result + item;
        });
        <span class="hljs-keyword">return</span> result;
      };
      <span class="hljs-comment">/* #@range_end(sum_forEach) */</span>
      expect(
        sum(anArray)
      ).to.eql(
        <span class="hljs-number">41</span>
      );
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>リスト3.8</strong> reduceによるsum関数</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'reduceによるsum関数'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(sum_reduce) */</span>
      <span class="hljs-keyword">var</span> sum = (array) =&gt; {
        <span class="hljs-keyword">return</span> array.reduce((x, y) =&gt; {
          <span class="hljs-keyword">return</span> x + y;
        });
      };
      <span class="hljs-comment">/* #@range_end(sum_reduce) */</span>
      expect(
        sum(anArray)
      ).to.eql(
        <span class="hljs-number">41</span>
      );
      next();
    });
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h2 id="3-3-section-id-semantics-conscious-section-">3.3 <section id='semantics-conscious'>セマンティクスを意識する</section></h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'セマンティクスを意識する'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>リスト3.9</strong> 環境という仕組み</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  it(<span class="hljs-string">'環境という仕組み'</span>, (next) =&gt; {
    <span class="hljs-comment">/* merge関数は、引数にわたされた2つのオブジェクトを併合する */</span>
    <span class="hljs-keyword">var</span> merge = (obj1, obj2) =&gt; {
      <span class="hljs-keyword">var</span> mergedObject = {};
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attrname <span class="hljs-keyword">in</span> obj1) { mergedObject[attrname] = obj1[attrname]; }
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attrname <span class="hljs-keyword">in</span> obj2) { mergedObject[attrname] = obj2[attrname]; }
      <span class="hljs-keyword">return</span> mergedObject;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <dl>
  <dt>empty</dt>
  <dd>空の環境</dd>
  <dt>extendEnv </dt>
  <dd>環境に変数と値の対応を与えて、辞書を拡張する</dd>
  <dt>lookupEnv</dt>
  <dd>変数を指定して、環境に記憶されている値を取り出す</dd>
</dl>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/* #@range_begin(environment_example) */</span>
    <span class="hljs-comment">/* 空の環境 */</span>
    <span class="hljs-keyword">var</span> emptyEnv = {};
    <span class="hljs-comment">/* 環境を拡張する */</span>
    <span class="hljs-keyword">var</span> extendEnv = (binding, oldEnv) =&gt; {
      <span class="hljs-comment">/* merge(obj1, obj2) は
         obj1とobj2のオブジェクトをマージする関数のこと */</span>
      <span class="hljs-keyword">return</span> merge(binding, oldEnv); 
    };
    <span class="hljs-comment">/* 変数名に対応する値を環境から取り出す */</span>
    <span class="hljs-keyword">var</span> lookupEnv = (name, env) =&gt; {
      <span class="hljs-keyword">return</span> env[name];
    };
    <span class="hljs-comment">/* #@range_end(environment_example) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;
<span class="hljs-keyword">var</span> b = <span class="hljs-number">3</span>;
b
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    expect(((_) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>リスト3.11</strong> リスト 3.10のセマンティクス </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-comment">/* #@range_begin(environment_example_usage) */</span>
      <span class="hljs-comment">/* 空の辞書を作成する */</span>
      <span class="hljs-keyword">var</span> initEnv = emptyEnv;                       
      <span class="hljs-comment">/* var a = 1 を実行して、辞書を拡張する */</span>
      <span class="hljs-keyword">var</span> firstEnv = extendEnv({<span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>}, initEnv);  
      <span class="hljs-comment">/* var b = 3 を実行して、辞書を拡張する */</span>
      <span class="hljs-keyword">var</span> secondEnv = extendEnv({<span class="hljs-string">"b"</span>: <span class="hljs-number">3</span>}, firstEnv); 
      <span class="hljs-comment">/* 辞書から b の値を参照する */</span>
      lookupEnv(<span class="hljs-string">"b"</span>, secondEnv);                
      <span class="hljs-comment">/* #@range_end(environment_example_usage) */</span>
      <span class="hljs-keyword">return</span> lookupEnv(<span class="hljs-string">"b"</span>, secondEnv);                 
    })()).to.eql(
      <span class="hljs-number">3</span>
    );
    next();
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h2 id="3-4-section-id-test-driven-section-">3.4 <section id='test-driven'>テストに親しむ</section></h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'テストに親しむ'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h3 id="-">単体テストの仕組み</h3>
<blockquote>
<p>参考資料: <a href="https://ja.wikipedia.org/wiki/%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88">単体テスト</a></p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'単体テストの仕組み'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>リスト3.12</strong> アサート関数の例</p>
<p>assertライブラリを使う場合</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'assertによる表明'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(assert_assertion) */</span>
      <span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">"assert"</span>);
      assert.equal(<span class="hljs-number">1</span> + <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
      <span class="hljs-comment">/* #@range_end(assert_assertion) */</span>
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>expectライブラリを使う場合</p>
<blockquote>
<p>参考資料: <a href="https://github.com/Automattic/expect.js">https://github.com/Automattic/expect.js</a></p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>    it(<span class="hljs-string">'expectによる表明'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(expect_assertion) */</span>
      <span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'expect.js'</span>);
      expect(
        <span class="hljs-number">1</span> + <span class="hljs-number">2</span>
      ).to.eql(
        <span class="hljs-number">3</span>
      );
      <span class="hljs-comment">/* #@range_end(expect_assertion) */</span>
      next();
    });
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><a href="index.html">目次に戻る</a> <a href="chap04.spec.html">次章に移る</a> </p>

            </div>
            
        </li>
        
    </ul>
  <!-- <div id="footer">  目次に戻る。 </div> -->
  <!-- </div> -->
</body>
</html>
