<!DOCTYPE html>

<html>
<head>
  <title>chap05.spec.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>chap05.spec.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'expect.js'</span>);
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="-">プログラムをコントロールする仕組み</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>describe(<span class="hljs-string">'プログラムをコントロールする仕組み'</span>, () =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="-">条文分岐</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'条文分岐'</span>, () =&gt; {
    it(<span class="hljs-string">'偶数の例'</span>, (next) =&gt; {
      <span class="hljs-comment">/* ##@range_begin(even_function)*/</span>
      <span class="hljs-keyword">var</span> even = (n) =&gt; {
        <span class="hljs-keyword">if</span>((n % <span class="hljs-number">2</span>) === <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
      };
      <span class="hljs-comment">/* ##@range_end(even_function)*/</span>
      expect(
        even(<span class="hljs-number">2</span>)
      ).to.eql(
        <span class="hljs-literal">true</span>
      );
      expect(
        even(<span class="hljs-number">3</span>)
      ).to.eql(
        <span class="hljs-literal">false</span>
      );
      next();
    });
    <span class="hljs-comment">/*
    it('逆数の例', (next) =&gt; {
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>##@range_begin(inverse_function)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> inverse = (n) =&gt; {
        <span class="hljs-keyword">if</span>(n === <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / n;
        }
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>##@range_end(inverse_function)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      expect(
        inverse(2)
      ).to.be(
        0.5
      );
      expect(
        inverse(0)
      ).to.be(
        0
      );
      next();
    });
    */
    it('ifは文である', (next) =&gt; {
      /* ##@range_begin(if_statement) */
      if(true) {

      } else {

      }
      /* ##@range_end(if_statement) */
      next();
    });
    it('ifの非正格性', (next) =&gt; {
      var infiniteLoop = (x) =&gt; {
        return infiniteLoop(x);
      };
      /* ##@range_begin(if_nonstrict) */
      var func = (x) =&gt; {
        if(true) {
          return x;
        } else {
          throw {
            name: "",
            message: "ここには決して到達しません"
          };
        }
      };
      /* テスト */
      expect(
        func(1)
      ).to.eql(
        1
      );
      /* ##@range_end(if_nonstrict) */
      next();
    });
    it("三項演算子", (next) =&gt; {
      /* ##@range_begin(trinary_if) */
      var signum = (n) =&gt; {
        return (n &gt; 0)?  1 : (n === 0)? 0 : -1;
      };
      expect(
        signum(3)
      ).to.eql(
        1
      );
      expect(
        signum(-3)
      ).to.eql(
          -1
      );
      expect(
        signum(0)
      ).to.eql(
        0
      );
      /* ##@range_end(trinary_if) */
      next();
    });
    it('条件式を実装する', (next) =&gt; {
      /* #@range_begin(conditional) */
      var cond = (predicate, pattern) =&gt; {
        if(predicate){
          return pattern.trueClause();
        } else {
          return pattern.falseClause();
        };
      };
      /* テスト */
      expect(
        cond((2 &lt; 3), {
          trueClause: () =&gt; {
            return true;
          },
          falseClause: () =&gt; {
            throw {
              message: "ここは到達しません"
            };
          }
        })
      ).to.eql(
        true
      );
      /* #@range_end(conditional) */
      /*
      var conditional = function(pred, trueExpr, falseExpr){
        return (x) =&gt; {
          if(pred(x)){
            return trueExpr(x);
          } else {
            return falseExpr(x);
          }
        };
      };
      var lessThan = (n) =&gt; {
        return (x) =&gt; {
          return x &lt; n;
        };
      };
      var succ = (n) =&gt; {
        return n + 1;
      };
      expect(
        conditional(lessThan(3), function(_){ return 1;},function(_){ return 0;})(2)
      ).to.eql(
        1
      );
      var infiniteLoop = (x) =&gt; {
        return infiniteLoop(x);
      };
      expect(conditional(lessThan(3), function(x){ return x;},function(x){ return infiniteLoop(x);})(2)).to.eql(2);
      */
      next();
    });
    it('関数渡しで反復文を構築する', function(next) {
      /* #@range_begin(loop)            */
      var loop = function(pred, accumulator, expression){
        if(pred(accumulator)){
          return loop(pred, expression(accumulator), expression);
        } else {
          return accumulator;
        }
      };
      var lessThan = function(n){
        return function(x){
          return x &lt; n;
        };
      };
      var succ = function(n){
        return n + 1;
      };
      expect(loop(lessThan(3), 0, succ)).to.eql(3);
      /* #@range_end(loop) */
      next();
    });
    describe('真理値', () =&gt; {
      it('チャーチの真理値', (next) =&gt; {
        /* ##@range_begin(church_truth) */
        var _true = (x) =&gt; {
          return (y) =&gt; {
            return x;
          };
        };
        var _false = (x) =&gt; {
          return (y) =&gt; {
            return y;
          };
        };
        var _ifElse = (pred) =&gt; {
          return (x) =&gt; {
            return (y) =&gt; {
              return pred(x)(y);
            };
          };
        };
        var _not = (x) =&gt; {
          return (x(_false))(_true);
        };
        var _and = (x) =&gt; {
          return (y) =&gt; {
            return (x(y))(_false);
          };
        };
        var _or = (x) =&gt; {
          return (y) =&gt; {
            return (x(_true))(y);
          };
        };
        /* ##@range_end(church_truth) */
        /* ##@range_begin(church_truth_test) */
        expect(
          _true(1)(0)
        ).to.be(
          1
        );
        expect(
          _not(_true)(1)(0)
        ).to.be(
          0
        );
        expect(
          _and(_true)(_true)(1)(0)
        ).to.be(
          1
        );
        expect(
          _ifElse(_true)(1)(0)
        ).to.be(
          1
        );
        expect(
          _ifElse(_false)(1)(0)
        ).to.be(
          0
        );
        expect(((_) =&gt; {
          var eq = (x) =&gt; {
            return (y) =&gt; {
              if(x === y) {
                return _true;
              } else {
                return _false;
              }
            };
          };
          return _ifElse(eq(0)(0))(1)(0);
        })()).to.be(
          1
        );
        expect(
          _ifElse(_true)(_false)(_true)(1)(0)
        ).to.be(
          0
        );

        /* ##@range_end(church_truth_test) */
        next();
      });
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="-switch-">条件分岐としてのswitch文</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'条件分岐としてのswitch文'</span>, () =&gt; {
    it(<span class="hljs-string">"信号機の例"</span>, (next) =&gt; {
      <span class="hljs-keyword">var</span> forward, stop, watchfulForward;
      <span class="hljs-comment">/* #@range_begin(signal) */</span>
      <span class="hljs-keyword">var</span> move;
      <span class="hljs-keyword">var</span> signal = (light) =&gt; {
        <span class="hljs-keyword">switch</span>(light){
        <span class="hljs-keyword">case</span> <span class="hljs-string">"green"</span>:
          move = forward;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"red"</span>:
          move = stop;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"yellow"</span>:
          move = watchfulForward;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
          <span class="hljs-keyword">throw</span> {
            name: <span class="hljs-string">"そのような信号はありません"</span>,
            message: <span class="hljs-string">"unknown: "</span> + light
          };
        }
      }
      <span class="hljs-comment">/* #@range_end(signal) */</span>
      next();
    });
    it(<span class="hljs-string">"可変データとのマッチング"</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(switch_for_mutable) */</span>
      <span class="hljs-keyword">var</span> switch_for_mutable = (array) =&gt; {
        <span class="hljs-keyword">switch</span>(array){
        <span class="hljs-keyword">case</span> [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]:
		  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
		  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
      }
	  <span class="hljs-comment">/* テスト */</span>
      expect(
        switch_for_mutable([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
      ).to.eql(
        <span class="hljs-literal">false</span>
      );
      <span class="hljs-comment">/* #@range_end(switch_for_mutable) */</span>
      next();
    });
    it(<span class="hljs-string">"通貨の例"</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(currency) */</span>
      <span class="hljs-keyword">var</span> move;
      <span class="hljs-keyword">var</span> signal = (currency) =&gt; {
        <span class="hljs-keyword">switch</span>(currency){
        <span class="hljs-keyword">case</span> <span class="hljs-string">"yen"</span>:
          move = forward;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"dollar"</span>:
          move = stop;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"euro"</span>:
          move = watchfulForward;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
          <span class="hljs-keyword">throw</span> {
            name: <span class="hljs-string">"対応していない通貨です"</span>,
            message: <span class="hljs-string">"unknown: "</span> + currency
          };
        }
      }
      <span class="hljs-comment">/* #@range_end(currency) */</span>
      next();
    });
    it(<span class="hljs-string">"compare"</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(compare) */</span>
      <span class="hljs-keyword">var</span> compare =  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n,m</span>)</span>{
        <span class="hljs-keyword">if</span> (n &gt; m) {
          <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span>(n === m) {  <span class="hljs-comment">/* ネストされたif文 */</span>
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
          }
        }
      };
      expect(
        compare(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>)
      ).to.eql(
        <span class="hljs-number">1</span>
      );
      expect(
        compare(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)
      ).to.eql(
        <span class="hljs-number">0</span>
      );
      expect(
        compare(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)
      ).to.eql(
          -<span class="hljs-number">1</span>
      );
      <span class="hljs-comment">/* #@range_end(compare) */</span>
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h3 id="-">コンビネータによる条件分岐の改善</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'コンビネータによる条件分岐の改善'</span>, () =&gt; {
      <span class="hljs-keyword">var</span> multiplyOf = (n) =&gt; {
        <span class="hljs-keyword">return</span> (m) =&gt; {
          <span class="hljs-keyword">if</span>((m % n) === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        }
      };
      <span class="hljs-keyword">var</span> twoFold = multiplyOf(<span class="hljs-number">2</span>);
      <span class="hljs-keyword">var</span> threeFold = multiplyOf(<span class="hljs-number">3</span>);
      <span class="hljs-keyword">var</span> fiveFold = multiplyOf(<span class="hljs-number">5</span>);
      it(<span class="hljs-string">'notコンビネータ'</span>, (next) =&gt; {
        <span class="hljs-comment">/* not:: (NUMBER-&gt;BOOL) -&gt; NUMBER -&gt; BOOL */</span>
        <span class="hljs-keyword">var</span> not = (predicate) =&gt; {
          <span class="hljs-keyword">return</span> (data) =&gt; { <span class="hljs-comment">// NUMBER -&gt; BOOL</span>
            <span class="hljs-keyword">if</span> (predicate(data)) {
              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
          };
        };
      expect(
        not(not(twoFold))(<span class="hljs-number">4</span>)
      ).to.eql(
        <span class="hljs-literal">true</span>
      );
        next();
      });
      it(<span class="hljs-string">'2と3の倍数で 5の倍数ではない'</span>, (next) =&gt; {
        <span class="hljs-comment">/* ##@range_begin(twoFoldAndThreeFoldButNotFiveFold) */</span>
        <span class="hljs-keyword">var</span> twoFold = (n) =&gt; { <span class="hljs-comment">/* 2の倍数を判定する */</span>
          <span class="hljs-keyword">if</span>((n % <span class="hljs-number">2</span>) === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        };
        <span class="hljs-comment">/*
          3の倍数を判定する threeFold
          5の倍数を判定する fiveFoldも同様に定義したとする
        */</span>
        <span class="hljs-keyword">var</span> twoFoldAndThreeFoldButNotFiveFold = (n) =&gt; {
          <span class="hljs-keyword">if</span>(twoFold(n) &amp;&amp; threeFold(n)) { <span class="hljs-comment">/* 2の倍数かつ3の倍数 */</span>
            <span class="hljs-keyword">if</span>(fiveFold(n)) { <span class="hljs-comment">/* 5の倍数 */</span>
              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            } <span class="hljs-keyword">else</span> { <span class="hljs-comment">/* 2の倍数かつ3の倍数で、5の倍数ではない */</span>
              <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        };
        <span class="hljs-comment">/* テスト */</span>
        expect(
          twoFoldAndThreeFoldButNotFiveFold(<span class="hljs-number">6</span>)
        ).to.eql(
          <span class="hljs-literal">true</span>
        )
        expect(
          twoFoldAndThreeFoldButNotFiveFold(<span class="hljs-number">30</span>)
        ).to.eql(
          <span class="hljs-literal">false</span>
        )
        <span class="hljs-comment">/* ##@range_end(twoFoldAndThreeFoldButNotFiveFold) */</span>
        next();
      });
      <span class="hljs-comment">/* ##@range_begin(not_combinator) */</span>
      <span class="hljs-comment">/* 「~ではない」を表す否定  */</span>
      <span class="hljs-comment">/* not:: (NUMBER-&gt;BOOL) -&gt; (NUMBER-&gt;BOOL) */</span>
      <span class="hljs-keyword">var</span> not = (predicate) =&gt; { <span class="hljs-comment">// predicate:: NUMBER-&gt;BOOL</span>
        <span class="hljs-keyword">return</span> (number) =&gt; {     <span class="hljs-comment">// NUMBER-&gt;BOOL型の関数を返す</span>
          <span class="hljs-keyword">return</span> ! predicate(number); <span class="hljs-comment">// !演算子で論理を反転させる</span>
        };
      };
      <span class="hljs-comment">/* ##@range_end(not_combinator) */</span>
      <span class="hljs-comment">/* ##@range_begin(logical_combinator) */</span>
      <span class="hljs-comment">/* 「かつ」を表す論理積  */</span>
      <span class="hljs-comment">/* and:: (NUMBER-&gt;BOOL, NUMBER-&gt;BOOL) -&gt; (NUMBER-&gt;BOOL) */</span>
      <span class="hljs-keyword">var</span> and = (predicateA, predicateB) =&gt; {
        <span class="hljs-keyword">return</span> (data) =&gt; {
          <span class="hljs-keyword">return</span> predicateA(data) &amp;&amp; predicateB(data);
        };
      };
      <span class="hljs-comment">/* 「もしくは」を表す論理和  */</span>
      <span class="hljs-keyword">var</span> or = (predicateA, predicateB) =&gt; {
        <span class="hljs-keyword">return</span> (data) =&gt; {
          <span class="hljs-keyword">return</span> predicateA(data) || predicateB(data);
        };
      };
      <span class="hljs-comment">/* ##@range_end(logical_combinator) */</span>
      it(<span class="hljs-string">'論理コンビネータのテスト'</span>, (next) =&gt; {
        expect(
          twoFold(<span class="hljs-number">2</span>)
        ).to.eql(
          <span class="hljs-literal">true</span>
        )
        <span class="hljs-comment">/* ##@range_begin(logical_combinator_test) */</span>
        expect(
		  <span class="hljs-comment">/* 「2の倍数かつ3の倍数で、5の倍数ではない」*/</span>
          and(and(twoFold,threeFold),not(fiveFold))(<span class="hljs-number">6</span>)
        ).to.eql(
          <span class="hljs-literal">true</span>
        )
        <span class="hljs-comment">/* ##@range_end(logical_combinator_test) */</span>
        expect(
           and(twoFold,threeFold)(<span class="hljs-number">6</span>)
        ).to.eql(
          <span class="hljs-literal">true</span>
        )
        expect(
           and(twoFold,threeFold)(<span class="hljs-number">4</span>)
        ).to.eql(
          <span class="hljs-literal">false</span>
        )
        expect(
          and(and(twoFold,threeFold),not(fiveFold))(<span class="hljs-number">4</span>)
        ).to.eql(
          <span class="hljs-literal">false</span>
        )
        <span class="hljs-comment">/* 2の倍数もしくは3の倍数で5の倍数でもあるもの */</span>
        <span class="hljs-comment">/* ##@range_begin(another_logical_combinator_test) */</span>
        expect(
		  <span class="hljs-comment">/* 「2の倍数もしくは3の倍数、かつ5の倍数でもある」 */</span>
          and(or(twoFold,threeFold),fiveFold)(<span class="hljs-number">10</span>)
        ).to.eql(
          <span class="hljs-literal">true</span>
        )
        <span class="hljs-comment">/* ##@range_end(another_logical_combinator_test) */</span>
        next();
      });
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="-">代数的データ型</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">'代数的データ型'</span>, () =&gt; {
    it(<span class="hljs-string">'Listを代数的データ型として実装する'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(list_in_algebraic_datatype) */</span>
	  <span class="hljs-comment">/* リストの代数的データ型 */</span>
      <span class="hljs-keyword">var</span> empty = (pattern) =&gt; {
        <span class="hljs-keyword">return</span> pattern.empty;
      };
      <span class="hljs-keyword">var</span> cons = (value, list) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.cons(value, list);
        };
      };
      <span class="hljs-comment">/* #@range_end(list_in_algebraic_datatype) */</span>
      <span class="hljs-comment">/* #@range_begin(match_in_algebraic_datatype) */</span>
	  <span class="hljs-comment">/* 代数的データ型に対してパターンマッチを実現する関数 */</span>
      <span class="hljs-keyword">var</span> match = (exp, pattern) =&gt; { 
        <span class="hljs-keyword">return</span> exp.call(pattern, pattern);
      };
      <span class="hljs-comment">/* #@range_end(match_in_algebraic_datatype) */</span>
      <span class="hljs-comment">/* #@range_begin(list_function_using_algebraic_datatype) */</span>
      <span class="hljs-keyword">var</span> isEmpty = (list) =&gt; {
        <span class="hljs-keyword">return</span> match(list, { <span class="hljs-comment">// match関数で分岐する</span>
          empty: <span class="hljs-literal">true</span>,
          cons: (head, tail) =&gt; { <span class="hljs-comment">// headとtailにそれぞれ先頭要素、末尾要素が入る</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          },
        })
      };
      <span class="hljs-keyword">var</span> head = (list) =&gt; {
        <span class="hljs-keyword">return</span> match(list, {
          empty: <span class="hljs-literal">undefined</span>, <span class="hljs-comment">// 空のリストには先頭要素はありません</span>
          cons: (head, tail) =&gt; {
            <span class="hljs-keyword">return</span> head;
          },
        })
      };
      <span class="hljs-keyword">var</span> tail = (list) =&gt; {
        <span class="hljs-keyword">return</span> match(list, {
          empty: <span class="hljs-literal">undefined</span>,  <span class="hljs-comment">// 空のリストには末尾要素はありません</span>
          cons: (head, tail) =&gt; {
            <span class="hljs-keyword">return</span> tail;
          },
        })
      };
      <span class="hljs-comment">/* #@range_end(list_function_using_algebraic_datatype) */</span>
      <span class="hljs-comment">/* #@range_begin(list_in_algebraic_datatype_test) */</span>
      expect(
        isEmpty(empty)         <span class="hljs-comment">// empty は空のリストではある</span>
      ).to.eql(
        <span class="hljs-literal">true</span>
      )
      expect(
        isEmpty(cons(<span class="hljs-number">1</span>,empty)) <span class="hljs-comment">// [1] は空のリストではない</span>
      ).to.eql(
        <span class="hljs-literal">false</span>
      )
      expect(
        head(cons(<span class="hljs-number">1</span>,empty))    <span class="hljs-comment">// [1]の先頭要素は 1 である</span>
      ).to.be(
        <span class="hljs-number">1</span>
      )
      expect(
        isEmpty(tail(cons(<span class="hljs-number">1</span>,empty)))     <span class="hljs-comment">// [1]の末尾要素は空のリストである</span>
      ).to.be(
        <span class="hljs-literal">true</span>
      )
      expect(
        head(tail(cons(<span class="hljs-number">1</span>,cons(<span class="hljs-number">2</span>,empty)))) <span class="hljs-comment">// [1,2]の2番目の要素は2である</span>
      ).to.be(
        <span class="hljs-number">2</span>
      )
      <span class="hljs-comment">/* #@range_end(list_in_algebraic_datatype_test) */</span>
      next();
    });
    it(<span class="hljs-string">'男女の別をsum型で表現する'</span>, (next) =&gt; {
      <span class="hljs-keyword">var</span> BMI = (weight <span class="hljs-comment">/* kg */</span>, height <span class="hljs-comment">/* cm */</span>) =&gt; {
        <span class="hljs-keyword">var</span> height_in_meter = height / <span class="hljs-number">100.0</span>;
        <span class="hljs-keyword">return</span> weight / (height_in_meter * height_in_meter);
      };
      <span class="hljs-keyword">var</span> match = (exp, pattern) =&gt; {
        <span class="hljs-keyword">return</span> exp.call(pattern, pattern);
      };
      <span class="hljs-keyword">var</span> male = (data) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.male(data);
        }
      };
      <span class="hljs-keyword">var</span> female = (data) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.female(data);
        };
      }
      <span class="hljs-keyword">var</span> evaluate = (person) =&gt; {
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">return</span> match(person, {
          male: (data) =&gt; {
            <span class="hljs-keyword">return</span> {
              BMI: BMI(data.weight, data.height),
              <span class="hljs-comment">/* total body water */</span>
              TBW: data.weight * <span class="hljs-number">0.6</span>,
              <span class="hljs-comment">/* estimated blood volume */</span>
              EBV: <span class="hljs-number">0.168</span> * <span class="hljs-built_in">Math</span>.pow(data.height,<span class="hljs-number">3</span>) + <span class="hljs-number">0.050</span> * data.weight + <span class="hljs-number">0.444</span>
            };
          },
          female: (data) =&gt; {
            <span class="hljs-keyword">return</span> {
              BMI: BMI(data.weight, data.height),
              TBW: data.weight * <span class="hljs-number">0.5</span>,
              <span class="hljs-comment">/* estimated blood volume = 0.250 \times height^3 + 0.625 \times weight - 0.662 */</span>
              EBV: <span class="hljs-number">0.250</span> * <span class="hljs-built_in">Math</span>.pow(data.height,<span class="hljs-number">3</span>) + <span class="hljs-number">0.625</span> * data.weight - <span class="hljs-number">0.662</span>
            };
          },
        });
      }
      <span class="hljs-keyword">var</span> man = male({
        weight: <span class="hljs-number">72</span>,
        height: <span class="hljs-number">175</span>
      });
      <span class="hljs-keyword">var</span> woman = female({
        weight: <span class="hljs-number">54</span>,
        height: <span class="hljs-number">160</span>
      });
      expect(
        evaluate(man).BMI
      ).to.be(<span class="hljs-number">23.510204081632654</span>)
      expect(
        evaluate(woman).TBW
      ).to.be(<span class="hljs-number">27</span>)
      next();
    });
    it(<span class="hljs-string">'数式の例'</span>, (next) =&gt; {
      <span class="hljs-comment">/* #@range_begin(algebraic_datatype) */</span>
      <span class="hljs-keyword">var</span> match = (exp, pattern) =&gt; {
        <span class="hljs-keyword">return</span> exp.call(pattern, pattern);
      };
      <span class="hljs-keyword">var</span> num = (n) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.num(n);
        };
      };
      <span class="hljs-keyword">var</span> add = (x, y) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.add(x, y);
        };
      };
      <span class="hljs-keyword">var</span> mul = (x, y) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.mul(x, y);
        };
      };
      <span class="hljs-keyword">var</span> calculate = (exp) =&gt; {
        <span class="hljs-keyword">return</span> match(exp, { <span class="hljs-comment">// パターンマッチを実行する</span>
          num: (x) =&gt; {
            <span class="hljs-keyword">return</span> x;
          },
          add: (x, y) =&gt; {
            <span class="hljs-keyword">return</span> calculate(x) + calculate(y);
          },
          mul: (x, y) =&gt; {
            <span class="hljs-keyword">return</span> calculate(x) * calculate(y);
          }
        });
      };
      <span class="hljs-keyword">var</span> exp = add(num(<span class="hljs-number">1</span>), mul(num(<span class="hljs-number">2</span>), num(<span class="hljs-number">3</span>)));
      expect(
        calculate(exp)
      ).to.eql(
        <span class="hljs-number">7</span>
      )
      <span class="hljs-comment">/* #@range_end(algebraic_datatype) */</span>
      next();
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="-">反復処理の種類と特徴</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>  describe(<span class="hljs-string">"反復処理の種類と特徴"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    describe(<span class="hljs-string">"while文"</span>, () =&gt; {
      it(<span class="hljs-string">"カウント"</span>, (next) =&gt; {
        <span class="hljs-comment">/* #@range_begin(while_counter) */</span>
        <span class="hljs-keyword">var</span> counter = <span class="hljs-number">0</span>;         <span class="hljs-comment">// 変数の初期化</span>
        <span class="hljs-keyword">while</span> (counter &lt; <span class="hljs-number">10</span>) {   <span class="hljs-comment">// 反復の条件</span>
          counter = counter + <span class="hljs-number">1</span>; <span class="hljs-comment">// 変数の更新</span>
        }
		<span class="hljs-comment">/* テスト */</span>
        expect(
          counter
        ).to.eql(
          <span class="hljs-number">10</span>
        );
        <span class="hljs-comment">/* #@range_end(while_counter) */</span>
        next();
      });
      <span class="hljs-comment">/*
      it("length", (next) =&gt; {
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>#@range_begin(while_length)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> array = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>];
        <span class="hljs-keyword">var</span> length = (array) =&gt; {
         <span class="hljs-keyword">var</span> counter = <span class="hljs-number">0</span>;
         <span class="hljs-keyword">while</span> (counter &lt; <span class="hljs-number">10</span>) {
            counter += <span class="hljs-number">1</span>;
         }
        }
        expect(
          counter
        ).to.eql(
          <span class="hljs-number">10</span>
        );</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>#@range_end(while_length)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        next();
      });
      it(<span class="hljs-string">"whileによるsum"</span>, (next) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>#@range_begin(while_sum)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> array = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>];
        <span class="hljs-keyword">var</span> sum = (array) =&gt; {
         <span class="hljs-keyword">var</span> counter = <span class="hljs-number">0</span>;
         <span class="hljs-keyword">while</span> (counter &lt; <span class="hljs-number">10</span>) {
            counter += <span class="hljs-number">1</span>;
         }
        }
        expect(
          counter
        ).to.eql(
          <span class="hljs-number">10</span>
        );</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>#@range_end(while_sum)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        next();
      });
      */
    });
    it("for文", (next) =&gt; {
      /* #@range_begin(for_example) */
      for (var counter = 0; counter &lt; 10; counter += 1) {
        ;
      }
	  /* テスト */
      expect(
        counter
      ).to.eql(
        10
      );
      /* #@range_end(for_example) */
      next();
    });
    describe('forEach文', () =&gt; {
      it("forEach文によるsum", (next) =&gt; {
        /* #@range_begin(forEach_sum) */
        var array = [1,2,3,4,5];
        var sum = 0;
        array.forEach((element) =&gt; {
          sum += element;
        });
		/* テスト */
        expect(
          sum
        ).to.eql(
          15
        );
        /* #@range_end(forEach_sum) */
        next();
      });
      it("forEach文によるlength", (next) =&gt; {
        /* #@range_begin(forEach_length) */
        var length = (array) =&gt; {
          var result = 0;
          array.forEach((element) =&gt; {
            result += 1;
          });
          return result;
        };
        expect(
          length([1,2,3,4,5])
        ).to.eql(
          5
        );
        /* #@range_end(forEach_length) */
        next();
      });
    });
    describe('再帰処理', () =&gt; {
      var list = {
        empty: [],
        cons: (n, list) =&gt; {
          return [n].concat(list);
        },
        head: (list) =&gt; {
          return list[0];
        },
        tail: (list) =&gt; {
          return list.slice(1,list.length);
        },
        isEmpty: (list) =&gt; {
          return list.length === 0;
        }
      };
      it('lengthの例', (next) =&gt; {
        var match = (exp, pattern) =&gt; {
          return exp.call(pattern, pattern);
        };
        var empty = (pattern) =&gt; {
          return pattern.empty;
        };
        var cons = (x, xs) =&gt; {
          return (pattern) =&gt; {
            return pattern.cons(x, xs);
          };
        };
        var isEmpty = (list) =&gt; {
          return match(list, {
            empty: true,
            cons: (head, tail) =&gt; {
              return false;
            },
          })
        };
        var head = (list) =&gt; {
          return match(list, {
            empty: undefined,
            cons: (head, tail) =&gt; {
              return head;
            },
          })
        };
        var tail = (list) =&gt; {
          return match(list, {
            empty: undefined,
            cons: (head, tail) =&gt; {
              return tail;
            },
          })
        };
        /* #@range_begin(recursive_length) */
        var length = (list, accumulator) =&gt; {
          return match(list, {
            empty: accumulator,
            cons: (head, tail) =&gt; {
              return length(tail, accumulator + 1); // length関数を再帰的に呼び出す
            },
          })
        };
		/* テスト */
        expect(
          length(empty, 0)
        ).to.eql(
          0
        )
        expect(
          length(cons(1,empty), 0)
        ).to.eql(
          1
        )
        expect(
          length(cons(1,cons(2,cons(3,empty))),0)
        ).to.eql(
          3
        )
        /* #@range_end(recursive_length) */
        /* #@range_begin(recursive_sum) */
        var sum = (list, accumulator) =&gt; {
          return match(list, {
            empty: accumulator,
            cons: (head, tail) =&gt; {
              return sum(tail, accumulator + head);
            },
          })
        };
        expect(
          sum(empty, 0)
        ).to.eql(
          0
        )
        expect(
          sum(cons(1,empty), 0)
        ).to.eql(
          1
        )
        expect(
          sum(cons(1,cons(2,cons(3,empty))),0)
        ).to.eql(
          6
        )
        /* #@range_end(recursive_sum) */
        next();
      });
      describe('mapの例', () =&gt; {
        /* #@range_begin(recursive_map) */
        var map = (alist, transform) =&gt; {
          if (list.isEmpty(alist)) {
            return list.empty;
          } else {
            var x = list.head(alist);
            var xs = list.tail(alist);
            return list.cons(transform(x), map(xs, transform));
          }
        };
        /* #@range_end(recursive_map) */
        var alist = list.cons(1,
                              list.cons(2,
                                        list.cons(3,
                                                  list.empty)));
        var double = (n) =&gt; {
          return n * 2;
        };
        var doubledList = map(alist, double);
        expect(
          list.head(doubledList)
        ).to.eql(
          2
        );
        expect(
          list.head(list.tail(doubledList))
        ).to.eql(
          4
        );
        expect(
          list.head(list.tail(list.tail(doubledList)))
        ).to.eql(
          6
        );
      });
      describe('sumの例', () =&gt; {
        /* #@range_begin(recursive_sum) */
        var sum = (alist, accumulator) =&gt; {
          if (list.isEmpty(alist)) {
            return accumulator;
          } else {
            var x = list.head(alist);
            var xs = list.tail(alist);
            return sum(xs, accumulator + x);
          }
        };
        /* #@range_end(recursive_sum) */
        var alist = list.cons(1,
                              list.cons(2,
                                        list.cons(3,
                                                  list.empty)));
        expect(
          sum(alist, 0)
        ).to.eql(
          6
        );
      });
      describe('maximumの例', () =&gt; {
        /* #@range_begin(recursive_maximum) */
        var maximum = (alist, accumulator) =&gt; {
          if (list.isEmpty(alist)) {
            return accumulator;
          } else {
            var x = list.head(alist);
            var xs = list.tail(alist);
            if(x &gt; accumulator) {
              return maximum(xs, x);
            } else {
              return maximum(xs, accumulator);
            }
          }
        };
        /* #@range_end(recursive_maximum) */
        var alist = list.cons(2,
                              list.cons(4,
                                        list.cons(1,
                                                  list.empty)));
        expect(
          maximum(alist, 0)
        ).to.eql(
          4
        );
      });
      describe('factorialの例', () =&gt; {
        it("factorial by recursive process", function(next) {
          /* #@range_begin(recursive_factorial) */
          var factorial = (n) =&gt; {
            if (n === 1) {
              return 1;
            } else {
              return n * factorial(n - 1);
            }
          };
          /* #@range_end(recursive_factorial) */
          expect(
            factorial(6)
          ).to.eql(
            720
          );
          next();
        });
        it("factorial by iterative process", function(next) {
          /* #@range_begin(iterative_factorial) */
          var factorial = (n) =&gt; {
            return fact_iter(1, 1, n);
          };
          var fact_iter = (product, counter, max_count) =&gt; {
            if (counter &gt; max_count) {
              return product;
            } else {
              return fact_iter(counter * product, counter + 1, max_count);
            }
          };
          expect(factorial(6)).to.eql(720);
          /* #@range_end(iterative_factorial) */
          next();
        });
        it('命令的factorial', function(next) {
          /* #@range_begin(imperative_factorial) */
          var factorial = function(n) {
            var index, result;
            result = 1;
            index = 1;
            while (index &lt; n + 1) {
              result = result * index;
              index = index + 1;
            }
            return result;
          };
          /* #@range_end(imperative_factorial) */
          expect(
            factorial(5)
          ).to.eql(
            120
          );
          next();
        });
      });
    });
  });
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
