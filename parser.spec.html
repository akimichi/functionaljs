<!DOCTYPE html>

<html>
<head>
  <title>parser.spec.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>parser.spec.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-keyword">var</span> __ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'kansuu.js'</span>);
<span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'expect.js'</span>);

describe(<span class="hljs-string">'パーサーコンビネーター'</span>, () =&gt; {
  describe(<span class="hljs-string">'代数的データ構造を用いた第2版'</span>, () =&gt; {

    <span class="hljs-keyword">var</span> match = (exp, pattern) =&gt; {
      <span class="hljs-keyword">return</span> exp(pattern);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>return exp.call(pattern, pattern);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    };
    <span class="hljs-keyword">var</span> list = {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>match: (exp, pattern) =&gt; {
   return exp.call(pattern, pattern);
},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      empty: (_) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.empty();
        };
      },
      cons: (value, list) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.cons(value, list);
        };
      },
      isEmpty: (seq) =&gt; {
        <span class="hljs-keyword">return</span> match(seq, {
          empty: (_) =&gt; {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          },
          cons: (head, tail) =&gt; {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          },
        });
      },
      head: (seq) =&gt; {
        <span class="hljs-keyword">return</span> match(seq, {
          empty: (_) =&gt; {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
          },
          cons: (head, tail) =&gt; {
            <span class="hljs-keyword">return</span> head;
          },
        });
      },
      tail: (seq) =&gt; {
        <span class="hljs-keyword">return</span> match(seq, {
          empty: (_)=&gt; {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
          },
          cons: (head, tail) =&gt; {
            <span class="hljs-keyword">return</span> tail;
          },
        });
      },
      fromString: (string) =&gt; {
        <span class="hljs-keyword">if</span>(string.length === <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">return</span> list.empty();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(string.length === <span class="hljs-number">1</span>) {
          <span class="hljs-keyword">return</span> list.cons(string[<span class="hljs-number">0</span>],list.empty());
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> list.cons(string[<span class="hljs-number">0</span>],string.substring(<span class="hljs-number">1</span>));
        }
      },
      toArray: (seq) =&gt; {
        <span class="hljs-keyword">var</span> toArrayAux = (seq) =&gt; {
          <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
          <span class="hljs-keyword">return</span> (accumulator) =&gt; {
            <span class="hljs-keyword">return</span> match(seq, {
              empty: (_) =&gt; {
                <span class="hljs-keyword">return</span> accumulator;
              },
              cons: (head, tail) =&gt; {
                <span class="hljs-keyword">return</span> toArrayAux.call(self, tail)(accumulator.concat(head))
              },
            });
          };
        };
        <span class="hljs-keyword">return</span> toArrayAux(seq)([]);
      }
    };
    <span class="hljs-comment">/* パース結果の代数的データ型 */</span>
    <span class="hljs-keyword">var</span> parseResult = {
      failed: (message) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.failed(message);
        };
      },
      successful: (value, input) =&gt; {
        <span class="hljs-keyword">return</span> (pattern) =&gt; {
          <span class="hljs-keyword">return</span> pattern.successful(value, input);
        };
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>parse: PARSER -&gt; LIST -&gt; PARSERESULT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> parse = (parser) =&gt; {
      <span class="hljs-keyword">return</span> (list) =&gt; {
        <span class="hljs-keyword">return</span> parser(list);
      };
    };
    <span class="hljs-comment">/* 基本パーサー */</span>
    <span class="hljs-comment">/* #@range_begin(succeed_fail) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>succeed:: ANY =&gt; LIST =&gt; RESULT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> succeed = (value) =&gt; {
      <span class="hljs-keyword">return</span> (seq) =&gt; {
        <span class="hljs-keyword">return</span> parseResult.successful(value, seq);
      };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>fail:: (ANY) =&gt; LIST =&gt; PARSERESULT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> fail = (message) =&gt; {
      <span class="hljs-keyword">return</span> (seq) =&gt; {
        <span class="hljs-keyword">return</span> parseResult.failed(message);
      };
    };
    <span class="hljs-comment">/* #@range_end(succeed_fail) */</span>
    it(<span class="hljs-string">'list#fromString'</span>, (next) =&gt; {
      expect(
        list.isEmpty(list.fromString(<span class="hljs-string">""</span>))
      ).to.eql(
        <span class="hljs-literal">true</span>
      );
      <span class="hljs-keyword">var</span> listFromString = list.fromString(<span class="hljs-string">"abc"</span>);
      expect(
        list.head(listFromString)
      ).to.eql(
        <span class="hljs-string">"a"</span>
      );
      next();
    });
    it(<span class="hljs-string">'list#toArray'</span>, (next) =&gt; {
      expect(
        list.toArray(list.cons(<span class="hljs-number">1</span>,list.empty()))
      ).to.eql(
        [<span class="hljs-number">1</span>]
      );
      expect(
        list.toArray(list.cons(<span class="hljs-string">"a"</span>,list.empty()))
      ).to.eql(
        [<span class="hljs-string">"a"</span>]
      );
      next();
    });
    <span class="hljs-comment">/* #@range_begin(succeed_fail) */</span>
    it(<span class="hljs-string">'succeed'</span>, (next) =&gt; {
      match(parse(succeed(<span class="hljs-number">1</span>)(<span class="hljs-string">"hello"</span>)),{
        failed: () =&gt; {
          expect().fail();
        },
        successful: (value, seq) =&gt; {
          expect(
            value
          ).to.eql(
            <span class="hljs-number">1</span>
          );
          expect(
            seq
          ).to.eql(
            <span class="hljs-string">"hello"</span>
          );
        }
      });
      match(parse(succeed([<span class="hljs-string">'+'</span>, <span class="hljs-string">'-'</span>]))(<span class="hljs-string">""</span>),{
        failed: () =&gt; {
          expect().fail();
        },
        successful: (value, input) =&gt; {
          expect(
            value
          ).to.eql(
            [<span class="hljs-string">'+'</span>, <span class="hljs-string">'-'</span>]
          );
          expect(
            input
          ).to.eql(
            <span class="hljs-string">""</span>
          );
        }
      });
      match(parse(succeed(<span class="hljs-number">10</span>))(<span class="hljs-string">""</span>),{
        failed: () =&gt; {
          expect().fail();
        },
        successful: (value, input) =&gt; {
          expect(
            value
          ).to.eql(
            <span class="hljs-number">10</span>
          );
          expect(
            input
          ).to.eql(
            <span class="hljs-string">""</span>
          );
        }
      });
      next();
    });
    it(<span class="hljs-string">'fail'</span>, (next) =&gt; {
      match(parse(fail(<span class="hljs-string">"message"</span>))(<span class="hljs-string">"hello"</span>),{
        failed: (message) =&gt; {
          expect(
            message
          ).to.eql(
            <span class="hljs-string">"message"</span>
          );
        },
        successful: (value, input) =&gt; {
          expect().fail();
        }
      });
      next();
    });
    <span class="hljs-comment">/* #@range_end(succeed_fail) */</span>
    <span class="hljs-comment">/* #@range_begin(satisfy)  */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>satisfy:: FUNC[T=&gt;BOOL] =&gt; LIST =&gt; PARSERESULT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> satisfy = (predicate) =&gt; {
      <span class="hljs-keyword">return</span> (inputList) =&gt; {
        <span class="hljs-keyword">return</span> match(inputList, {
          empty: (_) =&gt; {
            <span class="hljs-keyword">return</span> fail(<span class="hljs-string">"failed"</span>);
          },
          cons: (head, tail) =&gt; {
            <span class="hljs-keyword">if</span>(predicate(head)){
              <span class="hljs-keyword">return</span> succeed(head)(tail);
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> fail(<span class="hljs-string">"failed"</span>);
            }
          }
        });
        <span class="hljs-comment">/* #@range_end(satisfy)       */</span>
      };
    };
    it(<span class="hljs-string">'satisfy'</span>, (next) =&gt; {
      <span class="hljs-keyword">var</span> inputList = list.fromString(<span class="hljs-string">"abc"</span>);
      <span class="hljs-keyword">var</span> isA = (input) =&gt; {
        <span class="hljs-keyword">return</span> (input === <span class="hljs-string">"a"</span>);
      };
      match(satisfy(isA)(inputList),{
        failed: (_) =&gt; {
          expect().fail(<span class="hljs-string">"should not happen"</span>);
        },
        successful: (value, input) =&gt; {
          expect(value).to.eql(<span class="hljs-string">"a"</span>)
        }
      });
      next();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>character: Char =&gt; PARSERESULT =&gt; LIST =&gt; PARSERESULT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> character = (ch) =&gt; {
      <span class="hljs-keyword">var</span> predicate = (head) =&gt; {
        <span class="hljs-keyword">if</span>(ch === head){
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
      };
      <span class="hljs-keyword">return</span> satisfy(predicate);
    };
    <span class="hljs-keyword">var</span> seq = (firstParser, nextParser) =&gt; {
      <span class="hljs-keyword">return</span> (inputList) =&gt; {
        <span class="hljs-keyword">return</span> match(parse(firstParser)(inputList),{
          successful: (value, nextInputList) =&gt; {
            <span class="hljs-keyword">return</span> parse(nextParser(value)(nextInputList));
          },
          failed: (message) =&gt; {
            <span class="hljs-keyword">return</span> parseResult.failed(message);
          }
        });
      };
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>string: LIST[CHAR] =&gt;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> string = (string) =&gt; {
      <span class="hljs-keyword">return</span> match(string, {
        empty: (_) =&gt; {
          <span class="hljs-keyword">return</span> succeed(list.empty());
        },
        cons: (head, tail) =&gt; {
          <span class="hljs-keyword">return</span> seq(character(head),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{
            <span class="hljs-keyword">return</span> seq(string(tail),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xs</span>)</span>{
              <span class="hljs-keyword">return</span> succeed(list.cons(x,xs));
            });
          });
        }
      });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>it(‘string parser’, (next) =&gt; {
  var stringList = list.fromString(“abc”);
  var inputList = list.fromString(“abcdef”);
  var parseResult = parse(string(stringList)(inputList));
  match(parseResult,{
 failed: (_) =&gt; {
   expect().fail(“should not happen”)
 },
 successful: (value, nextInput) =&gt; {
   expect(value).to.eql(“a”)
 }
  })
  next();
});</p>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>(\x. \y. y x) (2 + 2) (\x. x + 1)
=&gt; (\y. y (2 + 2)) (\x. x + 1)
=&gt; (\x. x + 1) (2 + 2)
=&gt; (2 + 2) + 1
=&gt; 4 + 1
=&gt; 5</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  });
  describe(<span class="hljs-string">'第1版'</span>, () =&gt; {
    <span class="hljs-keyword">var</span> parser = {
      <span class="hljs-comment">/*        #@range_begin(succeed_fail)      */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>succeed:: T =&gt; String =&gt; {value:T, input:String}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      succeed: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>)</span>{
          <span class="hljs-keyword">return</span> {value: value, input: input};
        };
      },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>succeed:: () =&gt; String =&gt; {}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      fail: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>)</span>{
          <span class="hljs-keyword">return</span> {};
        };
      },
      <span class="hljs-comment">/*        #@range_end(succeed_fail)      */</span>
      <span class="hljs-comment">/*        #@range_begin(satisfy)      */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>satisfy:: (T=&gt;Bool) =&gt; String =&gt; {value:T, input:String}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      satisfy: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">predicate</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>)</span>{
            <span class="hljs-keyword">if</span>(__.isEmpty(input)) {
              <span class="hljs-keyword">return</span> context.fail()();
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">var</span> head = __.head(input);
              <span class="hljs-keyword">var</span> tail = __.tail(input);
              <span class="hljs-keyword">if</span>(predicate(head)){
                <span class="hljs-keyword">return</span> context.succeed(head)(tail);
              } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> context.fail()();
              }
            }
          };
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_end(satisfy)       */</span>
      <span class="hljs-comment">/*        #@range_begin(parse) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>parse:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      parse: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parser</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>)</span>{
          <span class="hljs-keyword">return</span> parser(input);
        };
      },
      <span class="hljs-comment">/*
        #@range_end(parse) */</span>
      item: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>)</span>{
          <span class="hljs-keyword">if</span>(__.isEmpty(input)) {
            <span class="hljs-keyword">return</span> [];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> head = __.head(input);
            <span class="hljs-keyword">var</span> tail = __.tail(input);
            <span class="hljs-keyword">return</span> {value: head, input: tail};
          }
        };
      },
      <span class="hljs-comment">/* #@range_begin(char) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>char: Char =&gt; {value:T, input:String}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      char: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ch</span>)</span>{
        <span class="hljs-keyword">var</span> predicate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">head</span>)</span>{
          <span class="hljs-keyword">if</span>(ch === head){
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        };
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.satisfy(predicate);
      },
      <span class="hljs-comment">/* #@range_end(char) */</span>
      <span class="hljs-comment">/* #@range_begin(string) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>char: Char =&gt; {value:T, input:String}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      string: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">string</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">if</span>(__.isEmpty(string)) {
            <span class="hljs-keyword">return</span> context.succeed(<span class="hljs-string">''</span>);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> head = __.head(string);
            <span class="hljs-keyword">var</span> tail = __.tail(string);

            <span class="hljs-keyword">return</span> context.seq(context.char(head),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{
              <span class="hljs-keyword">return</span> context.seq(context.string(tail),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xs</span>)</span>{
                <span class="hljs-keyword">return</span> context.succeed(x + xs);
              });
            });
          }
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_end(string) */</span>
      lex: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">regex</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">var</span> predicate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ch</span>)</span>{
            <span class="hljs-keyword">if</span>(regex.test(ch)){
              <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
          };
          <span class="hljs-keyword">return</span> context.satisfy(predicate);
        }(<span class="hljs-keyword">this</span>);
      },
      digit: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.lex(<span class="hljs-regexp">/\d/</span>);
        }(<span class="hljs-keyword">this</span>);
      },
      lower: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.lex(<span class="hljs-regexp">/[a-z]/</span>);
        }(<span class="hljs-keyword">this</span>);
      },
      upper: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.lex(<span class="hljs-regexp">/[A-Z]/</span>);
        }(<span class="hljs-keyword">this</span>);
      },
      letter: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.lex(<span class="hljs-regexp">/[a-zA-Z]/</span>);
        }(<span class="hljs-keyword">this</span>);
      },
      alphanum: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.lex(<span class="hljs-regexp">/\w/</span>);
        }(<span class="hljs-keyword">this</span>);
      },
      ident: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-comment">// Parser String</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.seq(context.lower(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{
            <span class="hljs-keyword">return</span> context.seq(context.many(context.alphanum())(__.op[<span class="hljs-string">"+"</span>]), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xs</span>)</span>{
              <span class="hljs-keyword">return</span> context.succeed(x + xs);
            });
          });
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_begin(space) */</span>
      space: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-comment">// Parser ()</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">var</span> isSpace = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{
            <span class="hljs-keyword">if</span>(x === <span class="hljs-string">' '</span>){
              <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
          };
          <span class="hljs-keyword">return</span> context.seq(context.many(context.satisfy(isSpace))(__.op[<span class="hljs-string">"+"</span>]), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dummy</span>)</span>{
            <span class="hljs-keyword">return</span> context.succeed(<span class="hljs-string">''</span>);
          });
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_end(space) */</span>
      <span class="hljs-comment">/* #@range_begin(token) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>token::</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      token: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parser</span>)</span>{ <span class="hljs-comment">// Parser a =&gt; Parser a</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.seq(context.space(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_</span>)</span>{
            <span class="hljs-keyword">return</span> context.seq(parser, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>)</span>{
              <span class="hljs-keyword">return</span> context.seq(context.space(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_</span>)</span>{
                <span class="hljs-keyword">return</span> context.succeed(v);
              });
            });
          });
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_end(token) */</span>
      identifier: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.token(context.ident());
        }(<span class="hljs-keyword">this</span>);
      },
      natural: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.token(context.nat());
        }(<span class="hljs-keyword">this</span>);
      },
      symbol: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">string</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.token(context.string(string));
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_begin(seq) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>seq:: (Parser, Parser) =&gt; Parser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      seq: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">first, next</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>)</span>{
            <span class="hljs-keyword">var</span> firstResult = context.parse(first)(input);
            <span class="hljs-keyword">if</span>(__.isEmpty(firstResult)) {
              <span class="hljs-keyword">return</span> {};
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">var</span> firstValue = firstResult.value;
              <span class="hljs-keyword">var</span> nextInput = firstResult.input;
              <span class="hljs-keyword">return</span> context.parse(next(firstValue))(nextInput);
            }
          };
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_end(seq) */</span>
      <span class="hljs-comment">/* #@range_begin(alt) */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>alt:: (Parser, Parser) =&gt; Parser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      alt: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">first, alternative</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>)</span>{
            <span class="hljs-keyword">var</span> firstResult = context.parse(first)(input);
            <span class="hljs-keyword">if</span>(__.isEmpty(firstResult)) {
              <span class="hljs-keyword">return</span> context.parse(alternative)(input);
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">return</span> firstResult;
            }
          };
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_end(alt) */</span>
      <span class="hljs-comment">/*
        #@range_begin(many1)
      */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Parser a =&gt; Parser [a]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      many1: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parser</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">operator</span>)</span>{
            <span class="hljs-keyword">return</span> context.seq(parser,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>)</span>{
              <span class="hljs-keyword">return</span> context.seq(context.many(parser)(operator),<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">vs</span>)</span>{
                <span class="hljs-keyword">return</span> context.succeed(operator(v,vs));
              });
            });
          };
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/*  #@range_end(many1) */</span>
      <span class="hljs-comment">/* #@range_begin(many)  */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Parser a =&gt; Parser [a]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      many: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parser</span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">operator</span>)</span>{
            <span class="hljs-keyword">return</span> context.alt(context.many1(parser)(operator),context.succeed([]));
          };
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_end(many)  */</span>
      <span class="hljs-comment">/* #@range_begin(nat)  */</span>
      nat: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-comment">// Parser String</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>)</span>{
          <span class="hljs-keyword">return</span> context.seq(context.many1(context.digit())(__.op[<span class="hljs-string">"+"</span>]), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">digits</span>)</span>{
            <span class="hljs-keyword">return</span> context.succeed(<span class="hljs-built_in">Number</span>(digits));
          });
        }(<span class="hljs-keyword">this</span>);
      },
      <span class="hljs-comment">/* #@range_end(nat)  */</span>
    };

    <span class="hljs-comment">/* #@range_begin(succeed_fail) */</span>
    it(<span class="hljs-string">'succeed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
      expect(parser.parse(parser.succeed(<span class="hljs-number">1</span>))(<span class="hljs-string">"hello"</span>)).to.eql( { value : <span class="hljs-number">1</span>, input : <span class="hljs-string">'hello'</span> } );
      expect(parser.parse(parser.succeed([<span class="hljs-string">'+'</span>, <span class="hljs-string">'-'</span>]))(<span class="hljs-string">""</span>)).to.eql( { value : [<span class="hljs-string">'+'</span>, <span class="hljs-string">'-'</span>], input : <span class="hljs-string">''</span> } );
      expect(parser.parse(parser.succeed(<span class="hljs-number">10</span>))(<span class="hljs-string">""</span>)).to.eql( { value : <span class="hljs-number">10</span>, input : <span class="hljs-string">''</span> } );
      expect(parser.parse(parser.succeed(<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"10"</span>)))(<span class="hljs-string">""</span>)).to.eql( { value : <span class="hljs-number">10</span>, input : <span class="hljs-string">''</span> } );
      next();
    });
    it(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
      expect(parser.parse(parser.fail())(<span class="hljs-string">"hello"</span>)).to.eql( {} );
      next();
    });
    <span class="hljs-comment">/* #@range_end(succeed_fail) */</span>
    it(<span class="hljs-string">'item'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
      expect(parser.parse(parser.item())(<span class="hljs-string">""</span>)).to.eql( [] );
      expect(parser.parse(parser.item())(<span class="hljs-string">"hello"</span>)).to.eql( { value : <span class="hljs-string">'h'</span>, input : <span class="hljs-string">'ello'</span> } );
      next();
    });
    it(<span class="hljs-string">'char'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
      <span class="hljs-comment">/* #@range_begin(char) */</span>
      <span class="hljs-keyword">var</span> plus = parser.char(<span class="hljs-string">'+'</span>);
      expect(parser.parse(plus)(<span class="hljs-string">"-"</span>)).to.eql( {} );
      expect(parser.parse(plus)(<span class="hljs-string">"+"</span>)).to.eql( {value: <span class="hljs-string">'+'</span>, input: <span class="hljs-string">''</span>} );
      expect(parser.parse(plus)(<span class="hljs-string">"-+"</span>)).to.eql( {} );
      <span class="hljs-comment">/* #@range_end(char) */</span>
      next();
    });
    describe(<span class="hljs-string">'space'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-comment">/* #@range_begin(space) */</span>
      it(<span class="hljs-string">'空白パーサー space をテストする'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        expect(parser.parse(parser.space())(<span class="hljs-string">"  abc"</span>)).to.eql( { value : <span class="hljs-string">''</span>, input : <span class="hljs-string">'abc'</span> });
        next();
      });
      <span class="hljs-comment">/* #@range_end(space) */</span>
    });
    it(<span class="hljs-string">'string'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
      <span class="hljs-comment">/* #@range_begin(string) */</span>
      expect(parser.parse(parser.string(<span class="hljs-string">"abc"</span>))(<span class="hljs-string">"abcdef"</span>)).to.eql( { value : <span class="hljs-string">'abc'</span>, input : <span class="hljs-string">'def'</span> });
      expect(parser.parse(parser.string(<span class="hljs-string">"abc"</span>))(<span class="hljs-string">"ab1234"</span>)).to.eql( {});
      <span class="hljs-comment">/* #@range_end(string) */</span>
      next();
    });
    describe(<span class="hljs-string">'seq'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      it(<span class="hljs-string">'plusminus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        <span class="hljs-keyword">var</span> plus = parser.char(<span class="hljs-string">'+'</span>);
        <span class="hljs-keyword">var</span> minus = parser.char(<span class="hljs-string">'-'</span>);
        <span class="hljs-keyword">var</span> plusminus = parser.seq(plus,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ans1</span>)</span>{
          <span class="hljs-keyword">return</span> parser.seq(minus,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ans2</span>)</span>{
            <span class="hljs-keyword">return</span> parser.succeed([ans1, ans2]);
          });
        });
        expect(parser.parse(plusminus)(<span class="hljs-string">"+-*"</span>)).to.eql( { value : [<span class="hljs-string">'+'</span>,<span class="hljs-string">'-'</span>], input : <span class="hljs-string">'*'</span> } );
        next();
      });
      it(<span class="hljs-string">'minusone should be -1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        <span class="hljs-comment">/*
          #@range_begin(minusone)
        */</span>
        <span class="hljs-keyword">var</span> minus = parser.char(<span class="hljs-string">'-'</span>);
        <span class="hljs-keyword">var</span> one = parser.char(<span class="hljs-string">'1'</span>);
        <span class="hljs-keyword">var</span> minusone = parser.seq(minus,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ans1</span>)</span>{
          <span class="hljs-keyword">return</span> parser.seq(one,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ans2</span>)</span>{
            <span class="hljs-keyword">var</span> ans = <span class="hljs-built_in">parseInt</span>(ans1 + ans2);
            <span class="hljs-keyword">return</span> parser.succeed(ans);
          });
        });
        expect(parser.parse(minusone)(<span class="hljs-string">"-1"</span>)).to.eql( { value : -<span class="hljs-number">1</span>, input : <span class="hljs-string">''</span> } );
        <span class="hljs-comment">/*
          #@range_end(minusone)
        */</span>
        next();
      });
      it(<span class="hljs-string">'oneoneone should be 111'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        <span class="hljs-keyword">var</span> one = parser.char(<span class="hljs-string">'1'</span>);
        <span class="hljs-keyword">var</span> oneoneone = parser.seq(one,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ans1</span>)</span>{
          <span class="hljs-keyword">return</span> parser.seq(one,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ans2</span>)</span>{
            <span class="hljs-keyword">return</span> parser.seq(one,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ans3</span>)</span>{
              <span class="hljs-keyword">var</span> ans = <span class="hljs-built_in">parseInt</span>(ans1 + ans2 + ans3);
              <span class="hljs-keyword">return</span> parser.succeed(ans);
            });
          });
        });
        expect(parser.parse(oneoneone)(<span class="hljs-string">"1111"</span>)).to.eql( { value : <span class="hljs-number">111</span>, input : <span class="hljs-string">'1'</span> } );
        next();
      });
    });
    describe(<span class="hljs-string">'alt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      it(<span class="hljs-string">'one or succeed a'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        <span class="hljs-keyword">var</span> syntax = parser.alt(parser.char(<span class="hljs-string">'1'</span>),
                                parser.succeed(<span class="hljs-string">'a'</span>));
        expect(parser.parse(syntax)(<span class="hljs-string">"1a"</span>)).to.eql( { value : <span class="hljs-string">'1'</span>, input : <span class="hljs-string">'a'</span> });
        next();
      });
      it(<span class="hljs-string">'item or succeed'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        <span class="hljs-keyword">var</span> syntax = parser.alt(parser.item(), parser.succeed(<span class="hljs-string">'a'</span>));
        expect(parser.parse(syntax)(<span class="hljs-string">"hello"</span>)).to.eql( { value : <span class="hljs-string">'h'</span>, input : <span class="hljs-string">'ello'</span> });
        next();
      });
      it(<span class="hljs-string">'fail or succeed(d) abc'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        <span class="hljs-keyword">var</span> syntax = parser.alt(parser.fail(), parser.succeed(<span class="hljs-string">'d'</span>));
        expect(parser.parse(syntax)(<span class="hljs-string">"abc"</span>)).to.eql( { value : <span class="hljs-string">'d'</span>, input : <span class="hljs-string">'abc'</span> });
        next();
      });
      it(<span class="hljs-string">'fail or succeed'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        <span class="hljs-keyword">var</span> syntax = parser.alt(parser.fail(), parser.succeed(<span class="hljs-string">'a'</span>));
        expect(parser.parse(syntax)(<span class="hljs-string">"hello"</span>)).to.eql({ value : <span class="hljs-string">'a'</span>, input : <span class="hljs-string">'hello'</span> });
        next();
      });
      it(<span class="hljs-string">'fail or fail'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        <span class="hljs-keyword">var</span> syntax = parser.alt(parser.fail(), parser.fail());
        expect(parser.parse(syntax)(<span class="hljs-string">"hello"</span>)).to.eql( {});
        next();
      });
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>describe(‘digit’, function() {
 it(‘accepts digits’,function(next){
   expect(parser.parse(parser.many(parser.digit())(<strong>.op[“+”]))(“123”)).to.eql( { value : ‘123’, input : ‘’ });
   expect(parser.parse(parser.many1(parser.digit())(</strong>.op[“+”]))(“abcdef”)).to.eql( {});
   next();
 });
});
describe(‘lower’, function() {
 it(‘many lower’, function(next){
   expect(parser.parse(parser.many(parser.lower())(<strong>.op[“+”]))(“abc”)).to.eql( { value : ‘abc’, input : ‘’ } );
   expect(parser.parse(parser.many(parser.lower())(</strong>.op[“+”]))(“abcABC”)).to.eql( { value : ‘abc’, input : ‘ABC’ });
   next();
 });
});
describe(‘ident’, function() {
 it(‘ident’, function(next){
   expect(parser.parse(parser.ident())(“hello world”)).to.eql( { value : ‘hello’, input : ‘ world’ });
   next();
 });
});
describe(‘nat’, function() {
 it(‘nat’, function(next){
   var result = parser.parse(parser.nat())(“123 pounds”)
   expect(__.get(“value”)(result)).to.eql(123);
   //expect(parser.parse(parser.nat())(“123 pounds”)).to.eql( [ { value : 123, input : ‘ pounds’ } ]); // should succeed
   next();
 });
});
describe(‘token’, function() {
 it(‘identifier’, function(next){
   expect(parser.parse(parser.identifier())(“  abc   “)).to.eql( { value : ‘abc’, input : ‘’ });
   next();
 });
 it(‘natural’, function(next){
   expect(parser.parse(parser.natural())(“  234   “)).to.eql( { value : 234, input : ‘’ } );
   next();
 });
 it(‘symbol’, function(next){
   expect(parser.parse(parser.symbol(“pi”))(“  pi   “)).to.eql(  { value : ‘pi’, input : ‘’ } );
   expect(parser.parse(parser.symbol(“pi”))(“pi   “)).to.eql(  { value : ‘pi’, input : ‘’ } );
   expect(parser.parse(parser.symbol(“pi”))(“  pi”)).to.eql(  { value : ‘pi’, input : ‘’ } );
   next();
 });
});</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    describe(<span class="hljs-string">'satisfy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      it(<span class="hljs-string">'digit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        <span class="hljs-comment">/*
          #@range_begin(satisfy_digit) */</span>
        <span class="hljs-keyword">var</span> isDigit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>)</span>{
          <span class="hljs-keyword">if</span>(<span class="hljs-regexp">/\d/</span>.test(x)){
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        };
        <span class="hljs-keyword">var</span> digit = parser.satisfy(isDigit);
        expect(parser.parse(digit)(<span class="hljs-string">"123"</span>)).to.eql( { value : <span class="hljs-string">'1'</span>, input : <span class="hljs-string">'23'</span> } );
        expect(parser.parse(digit)(<span class="hljs-string">"abc"</span>)).to.eql( {});
        <span class="hljs-comment">/* #@range_end(satisfy_digit)
         */</span>
        next();
      });
      it(<span class="hljs-string">'char'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>)</span>{
        expect(parser.parse(parser.char(<span class="hljs-string">"a"</span>))(<span class="hljs-string">"abc"</span>)).to.eql( { value : <span class="hljs-string">'a'</span>, input : <span class="hljs-string">'bc'</span> });
        expect(parser.parse(parser.char(<span class="hljs-string">"a"</span>))(<span class="hljs-string">"123"</span>)).to.eql( {});
        next();
      });
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>describe(‘many’, function() {
 it(‘many digit 123abc’,function(next){
   /*</p>
<pre><code>#@range_begin(many_digit)
*/
</code></pre><p>   var isDigit = function(x){
     if(/\d/.test(x)){
       return true;
     } else {
       return false;
     }
   };
   var digit = parser.satisfy(isDigit);
   expect(parser.parse(parser.many(digit)(__.op[“+”]))(“123abc”)).to.eql({ value : ‘123’, input : ‘abc’ } );
   /*</p>
<pre><code>#@range_end(many_digit)
*/
</code></pre><p>   next();
 });
 it(‘many digit abcdef’,function(next){
   expect(parser.parse(parser.many(parser.digit())(<strong>.op[“+”]))(“abcdef”)).to.eql( { value : [  ], input : ‘abcdef’ });
   next();
 });
 it(‘many natural’,function(next){
   var natural = parser.token(parser.nat());
   expect(parser.parse(parser.many(natural)(</strong>.cons))(“12 23 “)).to.eql( { value : [12, 23], input : ‘’ });
   next();
 });
});
/<em> #@range_begin(natural_array) </em>/
describe(‘自然数の配列を認識する’, function() {
 var openBracket = parser.token(parser.char(“[“));
 var closeBracket = parser.token(parser.char(“]”));
 var natural = parser.token(parser.nat());</p>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p> var arrayParser = parser.seq(openBracket,function(<em>){
   return parser.seq(parser.many(natural)(__.cons),function(naturals){
     return parser.seq(closeBracket,function(</em>){
       if(__.isEmpty(naturals))
         return parser.succeed([]);
       else
         return parser.succeed(naturals);
     });
   });
 });
 it(‘[ ]’, function(next){
   expect(parser.parse(arrayParser)(“[   ]”)).to.eql(  { value : [ ], input : ‘’ } );
   next();
 });
 it(‘[ 12 23 45 ]’, function(next){
   expect(parser.parse(arrayParser)(“[ 12 23 45 ]”)).to.eql(  { value : [12, 23, 45 ], input : ‘’ } );
   next();
 });
});
/<em> #@range_end(natural_array) </em>/</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  });
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
